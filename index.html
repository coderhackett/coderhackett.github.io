<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>加班猿</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="加班猿">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="加班猿">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="hackett">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="加班猿" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">加班猿</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Git老鸟查询手册" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/11/10/Git%E8%80%81%E9%B8%9F%E6%9F%A5%E8%AF%A2%E6%89%8B%E5%86%8C/" class="article-date">
  <time datetime="2020-11-09T16:00:00.000Z" itemprop="datePublished">2020-11-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Git/">Git</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/11/10/Git%E8%80%81%E9%B8%9F%E6%9F%A5%E8%AF%A2%E6%89%8B%E5%86%8C/">Git老鸟查询手册</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://img-blog.csdnimg.cn/20201029203102512.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<div align = 'right'>作者：hackett</div>

<div align = 'right'>微信公众号：加班猿</div>



<h2 id="1-用户名，邮箱配置"><a href="#1-用户名，邮箱配置" class="headerlink" title="1.用户名，邮箱配置"></a>1.用户名，邮箱配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git config --global user.name <span class="hljs-string">&quot;用户名&quot;</span><br>git config --global user.email <span class="hljs-string">&quot;邮箱&quot;</span><br></code></pre></td></tr></table></figure>

<h2 id="2-创建仓库"><a href="#2-创建仓库" class="headerlink" title="2.创建仓库"></a>2.创建仓库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git init	<span class="hljs-comment">#当前目录创建仓库</span><br></code></pre></td></tr></table></figure>

<h2 id="3-添加文件到暂存区"><a href="#3-添加文件到暂存区" class="headerlink" title="3.添加文件到暂存区"></a>3.添加文件到暂存区</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git add readme.txt <span class="hljs-comment">#readme.txt为需要添加的文件</span><br></code></pre></td></tr></table></figure>

<h2 id="4-提交"><a href="#4-提交" class="headerlink" title="4.提交"></a>4.提交</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git commit -m <span class="hljs-string">&quot;add a readme file.&quot;</span><span class="hljs-comment"># -m 后面为提交记录</span><br></code></pre></td></tr></table></figure>
<h2 id="5-修正最后一次提交"><a href="#5-修正最后一次提交" class="headerlink" title="5.修正最后一次提交"></a>5.修正最后一次提交</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git --amend <span class="hljs-comment">#简单地来说，可以理解成对最后一次提交做修正。&lt;前提是当前最后一次提交没有`merge`&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="6-查看当前仓库状态"><a href="#6-查看当前仓库状态" class="headerlink" title="6.查看当前仓库状态"></a>6.查看当前仓库状态</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git status	<span class="hljs-comment">#当前仓库状态</span><br></code></pre></td></tr></table></figure>
<h2 id="7-查看文件不同之处"><a href="#7-查看文件不同之处" class="headerlink" title="7.查看文件不同之处"></a>7.查看文件不同之处</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git diff readme.txt	<span class="hljs-comment">#readme.txt为需要查看的文件</span><br></code></pre></td></tr></table></figure>
<h2 id="8-查看提交日志记录"><a href="#8-查看提交日志记录" class="headerlink" title="8.查看提交日志记录"></a>8.查看提交日志记录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">log</span> <br>git <span class="hljs-built_in">log</span> --pretty=oneline <span class="hljs-comment">#显示一行日志</span><br>git <span class="hljs-built_in">log</span> --graph --pretty=oneline --abbrev-commit<span class="hljs-comment">#第一个参数是图形查看 第二个是显示一行记录 第三个是简略形式显示commit</span><br></code></pre></td></tr></table></figure>
<h2 id="9-版本回退"><a href="#9-版本回退" class="headerlink" title="9.版本回退"></a>9.版本回退</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">git reset --hard HEAD^ <span class="hljs-comment">#回退到上一个版本  </span><br>git reset --hard HEAD^^ <span class="hljs-comment">#回退到上上个版本  </span><br>git reset --hard HEAD~100 <span class="hljs-comment">#回退到前100个版本  </span><br>git reset --hard 1094a <span class="hljs-comment">#回退到特定版本号的版本  </span><br></code></pre></td></tr></table></figure>
<h2 id="10-查看历史记录的版本号id"><a href="#10-查看历史记录的版本号id" class="headerlink" title="10.查看历史记录的版本号id"></a>10.查看历史记录的版本号id</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git reflog <span class="hljs-comment">#用来恢复本地错误操作很重要的一个命令</span><br></code></pre></td></tr></table></figure>
<h2 id="11-查看文件工作区和版本库的区别"><a href="#11-查看文件工作区和版本库的区别" class="headerlink" title="11.查看文件工作区和版本库的区别"></a>11.查看文件工作区和版本库的区别</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git diff HEAD -- readme.txt	<span class="hljs-comment">#readme.txt的区别</span><br></code></pre></td></tr></table></figure>
<h2 id="12-撤销工作区的修改-误删恢复"><a href="#12-撤销工作区的修改-误删恢复" class="headerlink" title="12.撤销工作区的修改(误删恢复)"></a>12.撤销工作区的修改(误删恢复)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout -- readme.txt	<span class="hljs-comment">#撤销工作区readme.txt的修改</span><br></code></pre></td></tr></table></figure>
<h2 id="13-撤销暂存区的修改-add后撤销"><a href="#13-撤销暂存区的修改-add后撤销" class="headerlink" title="13.撤销暂存区的修改(add后撤销)"></a>13.撤销暂存区的修改(add后撤销)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git reset HEAD readme.txt	<span class="hljs-comment">##撤销暂存区readme.txt的修改</span><br></code></pre></td></tr></table></figure>
<h2 id="14-删除文件"><a href="#14-删除文件" class="headerlink" title="14.删除文件"></a>14.删除文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git rm test.txt 	<span class="hljs-comment">#删除文件test.txt</span><br></code></pre></td></tr></table></figure>
<h2 id="15-关联远程仓库"><a href="#15-关联远程仓库" class="headerlink" title="15.关联远程仓库"></a>15.关联远程仓库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git remote add origin SSH链接 <span class="hljs-comment">#换成自己想要关联的链接（仓库名）</span><br>git remote rm origin <span class="hljs-comment">#删除关联</span><br></code></pre></td></tr></table></figure>
<h2 id="16-第一次推送"><a href="#16-第一次推送" class="headerlink" title="16.第一次推送"></a>16.第一次推送</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git push -u origin master	<br></code></pre></td></tr></table></figure>
<h2 id="17-日常推送"><a href="#17-日常推送" class="headerlink" title="17.日常推送"></a>17.日常推送</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git push origin master<br></code></pre></td></tr></table></figure>
<h2 id="18-克隆仓库"><a href="#18-克隆仓库" class="headerlink" title="18.克隆仓库"></a>18.克隆仓库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> SSH链接 <span class="hljs-comment">#换成自己想要克隆的链接（仓库名）</span><br></code></pre></td></tr></table></figure>
<h2 id="19-创建分支"><a href="#19-创建分支" class="headerlink" title="19.创建分支"></a>19.创建分支</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git branch dev	<span class="hljs-comment">#创建一个名为dev的分支</span><br></code></pre></td></tr></table></figure>
<h2 id="20-切换分支"><a href="#20-切换分支" class="headerlink" title="20.切换分支"></a>20.切换分支</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout master <span class="hljs-comment">#工作区已改变的恢复  </span><br>git switch master <span class="hljs-comment">#工作区内容不变</span><br></code></pre></td></tr></table></figure>
<h2 id="21-创建并切换到分支"><a href="#21-创建并切换到分支" class="headerlink" title="21.创建并切换到分支"></a>21.创建并切换到分支</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout -b dev<br>git switch -c dev <span class="hljs-comment">#新版本命令</span><br></code></pre></td></tr></table></figure>
<h2 id="22-查看分支"><a href="#22-查看分支" class="headerlink" title="22.查看分支"></a>22.查看分支</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git branch<br></code></pre></td></tr></table></figure>
<h2 id="23-合并指定分支到当前分支"><a href="#23-合并指定分支到当前分支" class="headerlink" title="23.合并指定分支到当前分支"></a>23.合并指定分支到当前分支</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git merge dev	<span class="hljs-comment">#合并dev分支	</span><br></code></pre></td></tr></table></figure>
<h2 id="24-删除分支"><a href="#24-删除分支" class="headerlink" title="24.删除分支"></a>24.删除分支</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git branch -d dev  <br>git branch -D feature-vulcan <span class="hljs-comment">#强制删除</span><br></code></pre></td></tr></table></figure>
<h2 id="25-查看分支的合并情况"><a href="#25-查看分支的合并情况" class="headerlink" title="25.查看分支的合并情况"></a>25.查看分支的合并情况</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">log</span> --graph --prett=oneline --abbrev-commit<br></code></pre></td></tr></table></figure>
<h2 id="26-禁用Fast-forward模式"><a href="#26-禁用Fast-forward模式" class="headerlink" title="26.禁用Fast forward模式"></a>26.禁用Fast forward模式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git merge --no-ff -m <span class="hljs-string">&quot;merge with no-ff&quot;</span> dev<br></code></pre></td></tr></table></figure>
<h2 id="27-保存当前的工作区"><a href="#27-保存当前的工作区" class="headerlink" title="27.保存当前的工作区"></a>27.保存当前的工作区</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git stash<br></code></pre></td></tr></table></figure>
<h2 id="28-查看保存记录"><a href="#28-查看保存记录" class="headerlink" title="28.查看保存记录"></a>28.查看保存记录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git stash list<br></code></pre></td></tr></table></figure>
<h2 id="29-保存记录操作"><a href="#29-保存记录操作" class="headerlink" title="29.保存记录操作"></a>29.保存记录操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">git stash apply <span class="hljs-comment">#恢复  </span><br>git stash pop <span class="hljs-comment">#恢复并删除  </span><br>git stash drop <span class="hljs-comment">#删除记录  </span><br>git stash apply stash@&#123;0&#125; <span class="hljs-comment">#应用保存的记录</span><br></code></pre></td></tr></table></figure>
<h2 id="30-合并修复的bug到分支"><a href="#30-合并修复的bug到分支" class="headerlink" title="30.合并修复的bug到分支"></a>30.合并修复的bug到分支</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git cherry-pick 4c805e2  <br></code></pre></td></tr></table></figure>
<h2 id="31-推送失败后，先合并"><a href="#31-推送失败后，先合并" class="headerlink" title="31.推送失败后，先合并"></a>31.推送失败后，先合并</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git pull  <br>git branch --set-upstream-to=origin/dev dev  <span class="hljs-comment">#pull失败提示no tracking information时使用  </span><br></code></pre></td></tr></table></figure>
<h2 id="32-打标签"><a href="#32-打标签" class="headerlink" title="32.打标签"></a>32.打标签</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git tag v1.0  <br>git tag v0.9 f52c633`<br>git tag v0.8 0a1a47 -m <span class="hljs-string">&quot;test tag&quot;</span> <br></code></pre></td></tr></table></figure>
<h2 id="33-列出所有标签"><a href="#33-列出所有标签" class="headerlink" title="33.列出所有标签"></a>33.列出所有标签</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git tag  <br></code></pre></td></tr></table></figure>
<h2 id="34-查看标签详情"><a href="#34-查看标签详情" class="headerlink" title="34.查看标签详情"></a>34.查看标签详情</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git show v0.9  <br></code></pre></td></tr></table></figure>
<h2 id="35-删除标签"><a href="#35-删除标签" class="headerlink" title="35.删除标签"></a>35.删除标签</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git tag -d v0.8  <br></code></pre></td></tr></table></figure>
<h2 id="36-推送标签"><a href="#36-推送标签" class="headerlink" title="36.推送标签"></a>36.推送标签</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git push origin v1.0  <br>git push origin --tags  <span class="hljs-comment">#推送全部标签</span><br></code></pre></td></tr></table></figure>
<h2 id="37-删除推送的标签"><a href="#37-删除推送的标签" class="headerlink" title="37.删除推送的标签"></a>37.删除推送的标签</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git tag -d v1.0 <br>git push origin :refs/tags/v1.0  <br></code></pre></td></tr></table></figure>

<p>如果你觉得文章还不错，记得”<strong>点赞关注</strong>“</p>
<p>关注我的微信公众号【 <strong>加班猿</strong> 】可以获取更多内容</p>
<p><img src="https://img-blog.csdnimg.cn/20201029203206698.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/11/10/Git%E8%80%81%E9%B8%9F%E6%9F%A5%E8%AF%A2%E6%89%8B%E5%86%8C/" data-id="ckhvya4zd0001bglr0xk58mp3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%80%BB%E7%BB%93/" rel="tag">总结</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Qt中的TCP服务端和客户端互发消息" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/11/04/Qt%E4%B8%AD%E7%9A%84TCP%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BA%92%E5%8F%91%E6%B6%88%E6%81%AF/" class="article-date">
  <time datetime="2020-11-03T16:00:00.000Z" itemprop="datePublished">2020-11-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Qt/">Qt</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/11/04/Qt%E4%B8%AD%E7%9A%84TCP%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BA%92%E5%8F%91%E6%B6%88%E6%81%AF/">Qt中的TCP服务端和客户端互发消息</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://img-blog.csdnimg.cn/20201014220601139.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<div align = 'right'>作者：hackett</div>

<div align = 'right'>微信公众号：加班猿</div>



<p>废话不多说，上演示效果</p>
<p><img src="https://gitee.com/coderhackett/typoraimg/raw/master/image/20201111204316.gif"></p>
<p>由于我们用到<strong>socket</strong>跟<strong>Lamda</strong>表达式，所以工程.pro文件需要添加对应的库</p>
<p><img src="https://gitee.com/coderhackett/typoraimg/raw/master/image/20201111195456.png" alt="image-20201111195456610"></p>
<p>为了方便，main.cpp中让程序显示两个Widget窗口,程序运行起来就可以测试</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++">ServerWidget w;<br>w.show();<br>ClientWidget w2;<br>w2.show();<br></code></pre></td></tr></table></figure>

<h2 id="一、服务端"><a href="#一、服务端" class="headerlink" title="一、服务端"></a>一、服务端</h2><p>服务端的UI界面布局：</p>
<p>2个PushButton（send，close）</p>
<p>2个textEdit（发送内容，接收内容）</p>
<p><img src="https://gitee.com/coderhackett/typoraimg/raw/master/image/20201111201341.png" alt="image-20201111201341091"></p>
<p>新建一个监听套接字，监听端口号为9999的IP，等待连接，有连接过来提示成功连接同时服务端读就绪</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c++"> <span class="hljs-comment">//监听套接字，指定父对象，让其自动回收空间</span><br>tcpServer = <span class="hljs-keyword">new</span> QTcpServer(<span class="hljs-keyword">this</span>);<br><br>tcpServer-&gt;listen(QHostAddress::Any, <span class="hljs-number">9999</span>);<br><br>setWindowTitle(<span class="hljs-string">&quot;服务器: 9999&quot;</span>);<br><br><span class="hljs-comment">//newConnection代表有新的连接</span><br>connect(tcpServer, &amp;QTcpServer::newConnection,<br>        [=]()<br>        &#123;<br>            <span class="hljs-comment">//取出建立好连接的套接字</span><br>            tcpSocket = tcpServer-&gt;nextPendingConnection();<br><br>            <span class="hljs-comment">//获取对方的IP和端口</span><br>            QString ip = tcpSocket-&gt;peerAddress().toString();<br>            quint16 port = tcpSocket-&gt;peerPort();<br>            QString temp = QString(<span class="hljs-string">&quot;[%1:%2]:成功连接&quot;</span>).arg(ip).arg(port);<br>            ui-&gt;textEditRead-&gt;setText(temp);<br><br>            <span class="hljs-comment">//readyRead代表读就绪</span><br>            connect(tcpSocket, &amp;QTcpSocket::readyRead,<br>                    [=]()<br>                    &#123;<br>                        <span class="hljs-comment">//从通信套接字中取出内容</span><br>                        QByteArray <span class="hljs-built_in">array</span> = tcpSocket-&gt;readAll();<br>                        ui-&gt;textEditRead-&gt;append(<span class="hljs-built_in">array</span>);<br>                    &#125;<br>                   );<br>        &#125;<br>       );<br></code></pre></td></tr></table></figure>

<h2 id="二、客户端"><a href="#二、客户端" class="headerlink" title="二、客户端"></a>二、客户端</h2><p>客户端的UI界面布局：</p>
<p>3个PushButton（connect，send，close）</p>
<p>2个lineEdit（端口号，IP）</p>
<p>2个textEdit（发送内容，接收内容）</p>
<p><img src="https://gitee.com/coderhackett/typoraimg/raw/master/image/20201111200014.png" alt="image-20201111200014145"></p>
<p><strong>客户端连接按钮主动与服务端建立连接</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ClientWidget::on_buttonConnect_clicked</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">//获取服务器ip和端口</span><br>    QString ip = ui-&gt;lineEditIP-&gt;text();<br>    qint16 port = ui-&gt;lineEditPort-&gt;text().toInt();<br><br>    <span class="hljs-comment">//主动和服务器建立连接</span><br>    tcpSocket-&gt;connectToHost(QHostAddress(ip), port);<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>连接成功后会触发connected，提示”成功和服务器建立好连接”同时客户端读就绪</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//分配空间，指定父对象</span><br>tcpSocket = <span class="hljs-keyword">new</span> QTcpSocket(<span class="hljs-keyword">this</span>);<br><br>setWindowTitle(<span class="hljs-string">&quot;客户端&quot;</span>);<br><br><br>connect(tcpSocket, &amp;QTcpSocket::connected,<br>        [=]()<br>        &#123;<br>            ui-&gt;textEditRead-&gt;setText(<span class="hljs-string">&quot;成功和服务器建立好连接&quot;</span>);<br>        &#125;<br>       );<br><br>connect(tcpSocket, &amp;QTcpSocket::readyRead,<br>        [=]()<br>        &#123;<br>            <span class="hljs-comment">//获取对方发送的内容</span><br>            QByteArray <span class="hljs-built_in">array</span> = tcpSocket-&gt;readAll();<br>            <span class="hljs-comment">//追加到编辑区中</span><br>            ui-&gt;textEditRead-&gt;append(<span class="hljs-built_in">array</span>);<br>        &#125;<br><br>       );<br></code></pre></td></tr></table></figure>

<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><h3 id="main-cpp"><a href="#main-cpp" class="headerlink" title="main.cpp"></a>main.cpp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;serverwidget.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QApplication&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clientwidget.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-function">QApplication <span class="hljs-title">a</span><span class="hljs-params">(argc, argv)</span></span>;<br>    ServerWidget w;<br>    w.show();<br><br>    ClientWidget w2;<br>    w2.show();<br><br>    <span class="hljs-keyword">return</span> a.exec();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="serverwidget-cpp"><a href="#serverwidget-cpp" class="headerlink" title="serverwidget.cpp"></a>serverwidget.cpp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;serverwidget.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;ui_serverwidget.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QDebug&gt;</span></span><br><br>ServerWidget::ServerWidget(QWidget *parent) :<br>    QWidget(parent),<br>    ui(<span class="hljs-keyword">new</span> Ui::ServerWidget)<br>&#123;<br>    ui-&gt;setupUi(<span class="hljs-keyword">this</span>);<br><br>    tcpServer = <span class="hljs-literal">NULL</span>;<br>    tcpSocket = <span class="hljs-literal">NULL</span>;<br><br>    <span class="hljs-comment">//监听套接字，指定父对象，让其自动回收空间</span><br>    tcpServer = <span class="hljs-keyword">new</span> QTcpServer(<span class="hljs-keyword">this</span>);<br><br>    tcpServer-&gt;listen(QHostAddress::Any, <span class="hljs-number">9999</span>);<br><br>    setWindowTitle(<span class="hljs-string">&quot;服务器: 9999&quot;</span>);<br><br>    <span class="hljs-comment">//newConnection代表有新的连接</span><br>    connect(tcpServer, &amp;QTcpServer::newConnection,<br>            [=]()<br>            &#123;<br>                <span class="hljs-comment">//取出建立好连接的套接字</span><br>                tcpSocket = tcpServer-&gt;nextPendingConnection();<br><br>                <span class="hljs-comment">//获取对方的IP和端口</span><br>                QString ip = tcpSocket-&gt;peerAddress().toString();<br>                quint16 port = tcpSocket-&gt;peerPort();<br>                QString temp = QString(<span class="hljs-string">&quot;[%1:%2]:成功连接&quot;</span>).arg(ip).arg(port);<br>                ui-&gt;textEditRead-&gt;setText(temp);<br><br>                <span class="hljs-comment">//readyRead代表读就绪</span><br>                connect(tcpSocket, &amp;QTcpSocket::readyRead,<br>                        [=]()<br>                        &#123;<br>                            <span class="hljs-comment">//从通信套接字中取出内容</span><br>                            QByteArray <span class="hljs-built_in">array</span> = tcpSocket-&gt;readAll();<br>                            ui-&gt;textEditRead-&gt;append(<span class="hljs-built_in">array</span>);<br>                        &#125;<br>                        );<br>            &#125;<br>            );<br><br>&#125;<br><br>ServerWidget::~ServerWidget()<br>&#123;<br>    <span class="hljs-keyword">delete</span> ui;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ServerWidget::on_buttonSend_clicked</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-literal">NULL</span> == tcpSocket)<br>    &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-comment">//获取编辑区内容</span><br>    QString str = ui-&gt;textEditWrite-&gt;toPlainText();<br>    <span class="hljs-comment">//给对方发送数据， 使用套接字是tcpSocket</span><br>    tcpSocket-&gt;write( str.toUtf8().data() );<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ServerWidget::on_buttonClose_clicked</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-literal">NULL</span> == tcpSocket)<br>    &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-comment">//主动和客户端端口连接</span><br>    tcpSocket-&gt;disconnectFromHost();<br>    tcpSocket-&gt;close();<br>    tcpSocket = <span class="hljs-literal">NULL</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="serverwidget-h"><a href="#serverwidget-h" class="headerlink" title="serverwidget.h"></a>serverwidget.h</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> SERVERWIDGET_H</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SERVERWIDGET_H</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QWidget&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QTcpServer&gt; //监听套接字</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QTcpSocket&gt; //通信套接字</span></span><br><br><span class="hljs-keyword">namespace</span> Ui &#123;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ServerWidget</span>;</span><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ServerWidget</span> :</span> <span class="hljs-keyword">public</span> QWidget<br>&#123;<br>    Q_OBJECT<br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">ServerWidget</span><span class="hljs-params">(QWidget *parent = <span class="hljs-number">0</span>)</span></span>;<br>    ~ServerWidget();<br><br><span class="hljs-keyword">private</span> slots:<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">on_buttonSend_clicked</span><span class="hljs-params">()</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">on_buttonClose_clicked</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-keyword">private</span>:<br>    Ui::ServerWidget *ui;<br><br>    QTcpServer *tcpServer; <span class="hljs-comment">//监听套接字</span><br>    QTcpSocket *tcpSocket; <span class="hljs-comment">//通信套接字</span><br><br>&#125;;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">// SERVERWIDGET_H</span></span><br></code></pre></td></tr></table></figure>

<h3 id="clientwidget-cpp"><a href="#clientwidget-cpp" class="headerlink" title="clientwidget.cpp"></a>clientwidget.cpp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clientwidget.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;ui_clientwidget.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QHostAddress&gt;</span></span><br><br>ClientWidget::ClientWidget(QWidget *parent) :<br>    QWidget(parent),<br>    ui(<span class="hljs-keyword">new</span> Ui::ClientWidget)<br>&#123;<br>    ui-&gt;setupUi(<span class="hljs-keyword">this</span>);<br><br>    tcpSocket = <span class="hljs-literal">NULL</span>;<br><br>    <span class="hljs-comment">//分配空间，指定父对象</span><br>    tcpSocket = <span class="hljs-keyword">new</span> QTcpSocket(<span class="hljs-keyword">this</span>);<br><br>    setWindowTitle(<span class="hljs-string">&quot;客户端&quot;</span>);<br><br><br>    connect(tcpSocket, &amp;QTcpSocket::connected,<br>            [=]()<br>            &#123;<br>                ui-&gt;textEditRead-&gt;setText(<span class="hljs-string">&quot;成功和服务器建立好连接&quot;</span>);<br>            &#125;<br>            );<br><br>    connect(tcpSocket, &amp;QTcpSocket::readyRead,<br>            [=]()<br>            &#123;<br>                <span class="hljs-comment">//获取对方发送的内容</span><br>                QByteArray <span class="hljs-built_in">array</span> = tcpSocket-&gt;readAll();<br>                <span class="hljs-comment">//追加到编辑区中</span><br>                ui-&gt;textEditRead-&gt;append(<span class="hljs-built_in">array</span>);<br>            &#125;<br><br>            );<br><br>&#125;<br><br>ClientWidget::~ClientWidget()<br>&#123;<br>    <span class="hljs-keyword">delete</span> ui;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ClientWidget::on_buttonConnect_clicked</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">//获取服务器ip和端口</span><br>    QString ip = ui-&gt;lineEditIP-&gt;text();<br>    qint16 port = ui-&gt;lineEditPort-&gt;text().toInt();<br><br>    <span class="hljs-comment">//主动和服务器建立连接</span><br>    tcpSocket-&gt;connectToHost(QHostAddress(ip), port);<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ClientWidget::on_buttonSend_clicked</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">//获取编辑框内容</span><br>    QString str = ui-&gt;textEditWrite-&gt;toPlainText();<br>    <span class="hljs-comment">//发送数据</span><br>    tcpSocket-&gt;write( str.toUtf8().data() );<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ClientWidget::on_buttonClose_clicked</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">//主动和对方断开连接</span><br>    tcpSocket-&gt;disconnectFromHost();<br>    tcpSocket-&gt;close();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="clientwidget-h"><a href="#clientwidget-h" class="headerlink" title="clientwidget.h"></a>clientwidget.h</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> CLIENTWIDGET_H</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CLIENTWIDGET_H</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QWidget&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QTcpSocket&gt; //通信套接字</span></span><br><br><span class="hljs-keyword">namespace</span> Ui &#123;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ClientWidget</span>;</span><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ClientWidget</span> :</span> <span class="hljs-keyword">public</span> QWidget<br>&#123;<br>    Q_OBJECT<br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">ClientWidget</span><span class="hljs-params">(QWidget *parent = <span class="hljs-number">0</span>)</span></span>;<br>    ~ClientWidget();<br><br><span class="hljs-keyword">private</span> slots:<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">on_buttonConnect_clicked</span><span class="hljs-params">()</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">on_buttonSend_clicked</span><span class="hljs-params">()</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">on_buttonClose_clicked</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-keyword">private</span>:<br>    Ui::ClientWidget *ui;<br><br>    QTcpSocket *tcpSocket; <span class="hljs-comment">//通信套接字</span><br>&#125;;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">// CLIENTWIDGET_H</span></span><br><br></code></pre></td></tr></table></figure>

<p>如果你觉得文章还不错，记得”<strong>点赞关注</strong>“</p>
<p>关注我的微信公众号【 <strong>加班猿</strong> 】可以获取更多内容</p>
<p><img src="https://img-blog.csdnimg.cn/20201028200900702.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/11/04/Qt%E4%B8%AD%E7%9A%84TCP%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BA%92%E5%8F%91%E6%B6%88%E6%81%AF/" data-id="ckhvya4zf0002bglr91lm6jh0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/UI/" rel="tag">UI</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Qt实现一个简单的计算器" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/11/01/Qt%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E8%AE%A1%E7%AE%97%E5%99%A8/" class="article-date">
  <time datetime="2020-10-31T16:00:00.000Z" itemprop="datePublished">2020-11-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Qt/">Qt</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/11/01/Qt%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E8%AE%A1%E7%AE%97%E5%99%A8/">Qt实现一个简单的计算器</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://img-blog.csdnimg.cn/20201029203102512.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<div align = 'right'>作者：hackett</div>

<div align = 'right'>微信公众号：加班猿</div>



<h2 id="一、UI界面版"><a href="#一、UI界面版" class="headerlink" title="一、UI界面版"></a>一、UI界面版</h2><p><strong>运行效果：输入num1和num2选择+-*/点击计算即可</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20201029203127425.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p><strong>UI界面设计：</strong></p>
<p>3个lineEdit（lineEditNum1，lineEditNum2，lineEditSum）</p>
<p>2个PushButton（buttonClear，ButtonCalc）</p>
<p>1个comboBox</p>
<p>1个label</p>
<p><strong>布局：</strong></p>
<p>3个lineEdit和1个comboBox、1个label水平布局</p>
<p>2个PushButton和一个弹簧水平布局</p>
<p>最后整体布局即可</p>
<p><img src="https://img-blog.csdnimg.cn/20201029203137294.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>main.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;mainwindow.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QApplication&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-function">QApplication <span class="hljs-title">a</span><span class="hljs-params">(argc, argv)</span></span>;<br>    MainWindow w;<br>    w.show();<br><br>    <span class="hljs-keyword">return</span> a.exec();<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>mainwindow.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;mainwindow.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;ui_mainwindow.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QDebug&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QMessageBox&gt;</span></span><br><br>MainWindow::MainWindow(QWidget *parent) :<br>    QMainWindow(parent),<br>    ui(<span class="hljs-keyword">new</span> Ui::MainWindow)<br>&#123;<br>    ui-&gt;setupUi(<span class="hljs-keyword">this</span>);<br>&#125;<br><br>MainWindow::~MainWindow()<br>&#123;<br>    <span class="hljs-keyword">delete</span> ui;<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">MainWindow::on_buttonCalc_clicked</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">double</span> num1 = ui-&gt;lineEditNum1-&gt;text().toDouble();<span class="hljs-comment">//获取num1的值</span><br>    <span class="hljs-keyword">double</span> num2 = ui-&gt;lineEditNum2-&gt;text().toDouble();<span class="hljs-comment">//获取num2的值</span><br>    <span class="hljs-keyword">uint8_t</span> index = ui-&gt;comboBox-&gt;currentIndex();   <span class="hljs-comment">//获取下拉框的下标0 +, 1 - ,2 *, 3 /</span><br>    <span class="hljs-keyword">double</span> result = <span class="hljs-number">0.0</span>;<br><br>    <span class="hljs-keyword">switch</span> (index) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>        result = num1 + num2;<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>        result = num1 - num2;<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>        result = num1 * num2;<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>        <span class="hljs-keyword">if</span>(num2 == <span class="hljs-number">0</span>)<br>        &#123;<br>            QMessageBox::about(<span class="hljs-keyword">this</span>,<span class="hljs-string">&quot;注意&quot;</span>,<span class="hljs-string">&quot;除数不能为0&quot;</span>);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        result = num1 / num2;<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>    ui-&gt;lineEditSum-&gt;setText(QString::number(result));<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">MainWindow::on_buttonClear_clicked</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    ui-&gt;lineEditNum1-&gt;clear();<br>    ui-&gt;lineEditNum2-&gt;clear();<br>    ui-&gt;lineEditSum-&gt;clear();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>mainwindow.h</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> MAINWINDOW_H</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAINWINDOW_H</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QMainWindow&gt;</span></span><br><br><span class="hljs-keyword">namespace</span> Ui &#123;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainWindow</span>;</span><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainWindow</span> :</span> <span class="hljs-keyword">public</span> QMainWindow<br>&#123;<br>    Q_OBJECT<br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">MainWindow</span><span class="hljs-params">(QWidget *parent = <span class="hljs-number">0</span>)</span></span>;<br>    ~MainWindow();<br><br><span class="hljs-keyword">private</span> slots:<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">on_buttonCalc_clicked</span><span class="hljs-params">()</span></span>;<span class="hljs-comment">//计算结果槽函数</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">on_buttonClear_clicked</span><span class="hljs-params">()</span></span>;<span class="hljs-comment">//清除输入框槽函数</span><br><br><span class="hljs-keyword">private</span>:<br>    Ui::MainWindow *ui;<br>&#125;;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">// MAINWINDOW_H</span></span><br><br></code></pre></td></tr></table></figure>

<h2 id="二、纯代码版"><a href="#二、纯代码版" class="headerlink" title="二、纯代码版"></a>二、纯代码版</h2><p><strong>注：只能两个数单独加减乘除，不能连续运算，按‘ = ’重新开始两个数运算</strong></p>
<p><img src="https://img-blog.csdnimg.cn/2020102920315122.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>main.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;calc.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QApplication&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-function">QApplication <span class="hljs-title">a</span><span class="hljs-params">(argc, argv)</span></span>;<br>    Calc w;<br>    w.show();<br><br>    <span class="hljs-keyword">return</span> a.exec();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>calc.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;calc.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QHBoxLayout&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QVBoxLayout&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QLineEdit&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QSizePolicy&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QDebug&gt;</span></span><br><br>Calc::Calc(QWidget *parent) :<br>    QWidget(parent)<br>&#123;<br>    <span class="hljs-comment">//获取字体QFont</span><br>    QFont font = <span class="hljs-keyword">this</span>-&gt;font();<br>    font.setPixelSize(<span class="hljs-number">30</span>);<br>    <span class="hljs-keyword">this</span>-&gt;setFont(font);<br><br>    <span class="hljs-comment">//保存键盘值</span><br>    QString keys=<span class="hljs-string">&quot;789-456*123/0.+=&quot;</span>;<br>    QVBoxLayout *vbox = <span class="hljs-keyword">new</span> QVBoxLayout();<br><br>    <span class="hljs-function">QSizePolicy <span class="hljs-title">qsPolicy</span><span class="hljs-params">(QSizePolicy::Expanding, QSizePolicy::Expanding)</span></span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">4</span>; i++)<br>    &#123;<br>        QHBoxLayout *hbox = <span class="hljs-keyword">new</span> QHBoxLayout();<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=<span class="hljs-number">0</span>; j&lt;<span class="hljs-number">4</span>; j++)<br>        &#123;<br>            buttons[i*<span class="hljs-number">4</span>+j] = <span class="hljs-keyword">new</span> QToolButton(<span class="hljs-keyword">this</span>);<br>            <span class="hljs-comment">//设置文本</span><br>            buttons[i*<span class="hljs-number">4</span>+j]-&gt;setText(keys.mid(i*<span class="hljs-number">4</span>+j, <span class="hljs-number">1</span>));<br>            hbox-&gt;addWidget(buttons[i*<span class="hljs-number">4</span>+j]);<br><br>            <span class="hljs-comment">//策略设置</span><br>            buttons[i*<span class="hljs-number">4</span>+j]-&gt;setSizePolicy(qsPolicy);<br><br>            <span class="hljs-comment">//把按钮触发信号关联槽函数</span><br>            connect(buttons[i*<span class="hljs-number">4</span>+j], SIGNAL(clicked(<span class="hljs-keyword">bool</span>)),<span class="hljs-keyword">this</span>, SLOT(buttons_chick()));<br>        &#125;<br>        <span class="hljs-comment">//把水平布局管理器添加到垂直布局管理器中</span><br>        vbox-&gt;addLayout(hbox);<br>    &#125;<br><br>    <span class="hljs-comment">//创建一个输入框</span><br>    edit = <span class="hljs-keyword">new</span> QLineEdit(<span class="hljs-keyword">this</span>);<br>    edit-&gt;setSizePolicy(qsPolicy);<br>    edit-&gt;setMaximumHeight(<span class="hljs-number">60</span>);<br>    edit-&gt;setAlignment(Qt::AlignRight);<br><br><br>    QVBoxLayout *allVbox = <span class="hljs-keyword">new</span> QVBoxLayout(<span class="hljs-keyword">this</span>);<br>    allVbox-&gt;addWidget(edit);<br>    allVbox-&gt;addLayout(vbox);<br><br><br>    <span class="hljs-comment">//初始化</span><br>    firstNumber.clear();<br>    secondNumber.clear();<br>    calcflag = <span class="hljs-number">0</span>;<br><br>&#125;<br>Calc::~Calc()<br>&#123;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Calc::input_data</span><span class="hljs-params">(QString str)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(calcflag == <span class="hljs-number">0</span>)<br>    &#123;<br>        firstNumber.append(str);<br>        edit-&gt;setText(firstNumber);<br>    &#125;<span class="hljs-keyword">else</span><br>    &#123;<br>        secondNumber.append(str);<br>        edit-&gt;setText(secondNumber);<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Calc::buttons_chick</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">//通过信号发送者获取按钮对象</span><br>    QToolButton *button = (QToolButton*)sender();<br>    <span class="hljs-comment">//qDebug()</span><br>    QString str = button-&gt;text();<br>    QString datastr = <span class="hljs-string">&quot;.0123456789&quot;</span>;<br>    QStringList typestr;<br>    typestr&lt;&lt;<span class="hljs-string">&quot;+&quot;</span>&lt;&lt;<span class="hljs-string">&quot;-&quot;</span>&lt;&lt;<span class="hljs-string">&quot;*&quot;</span>&lt;&lt;<span class="hljs-string">&quot;/&quot;</span>;<br>    <span class="hljs-keyword">if</span>(datastr.indexOf(str) &gt;= <span class="hljs-number">0</span>)<span class="hljs-comment">//获取按键值</span><br>    &#123;<br>        input_data(str);    <span class="hljs-comment">//输入数据</span><br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(typestr.indexOf(str)&gt;=<span class="hljs-number">0</span>)<br>    &#123;<br>        calcflag = typestr.indexOf(str)+<span class="hljs-number">1</span>;<span class="hljs-comment">//获取运算符号type</span><br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-comment">//=</span><br>    &#123;<br>        <span class="hljs-keyword">double</span> result = <span class="hljs-number">0.0</span>;<br>        <span class="hljs-keyword">switch</span> (calcflag) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>            result = firstNumber.toDouble()+secondNumber.toDouble();<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>            result = firstNumber.toDouble()-secondNumber.toDouble();<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>            result = firstNumber.toDouble()*secondNumber.toDouble();<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>            result = firstNumber.toDouble()/secondNumber.toDouble();<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        edit-&gt;setText(QString::number(result));<br>        calcflag = <span class="hljs-number">0</span>;<br>        firstNumber.clear();<br>        secondNumber.clear();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>calc.h</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> CALC_H</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CALC_H</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QWidget&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QToolButton&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QLineEdit&gt;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Calc</span> :</span> <span class="hljs-keyword">public</span> QWidget<br>&#123;<br>    Q_OBJECT<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">Calc</span><span class="hljs-params">(QWidget *parent = <span class="hljs-number">0</span>)</span></span>;<br>    ~Calc();<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">input_data</span><span class="hljs-params">(QString str)</span></span>;<br>    <br><span class="hljs-keyword">protected</span> slots:<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">buttons_chick</span><span class="hljs-params">()</span></span>;<span class="hljs-comment">//按键槽函数</span><br><br><span class="hljs-keyword">private</span>:<br>    <br>    QToolButton *buttons[<span class="hljs-number">16</span>];   <span class="hljs-comment">//按钮数组</span><br>    QLineEdit *edit;            <span class="hljs-comment">//输入框</span><br>    QString firstNumber;        <span class="hljs-comment">//记录输入第一个数值</span><br>    QString secondNumber;       <span class="hljs-comment">//记录输入第一个数值</span><br>    <span class="hljs-keyword">int</span> calcflag;               <span class="hljs-comment">//1-add， 2-sub, 3-mul, 4-div</span><br>&#125;;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">// CALC_H</span></span><br> <br></code></pre></td></tr></table></figure>

<p>如果你觉得文章还不错，记得”<strong>点赞关注</strong>“</p>
<p>关注我的微信公众号【 <strong>加班猿</strong> 】可以获取更多内容</p>
<p><img src="https://img-blog.csdnimg.cn/20201029203206698.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/11/01/Qt%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E8%AE%A1%E7%AE%97%E5%99%A8/" data-id="ckhvya4zi0004bglrdt3t5vox" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/UI/" rel="tag">UI</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Qt实现自定义图标功能" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/11/01/Qt%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9B%BE%E6%A0%87%E5%8A%9F%E8%83%BD/" class="article-date">
  <time datetime="2020-10-31T16:00:00.000Z" itemprop="datePublished">2020-11-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Qt/">Qt</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/11/01/Qt%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9B%BE%E6%A0%87%E5%8A%9F%E8%83%BD/">Qt实现自定义图标功能</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://img-blog.csdnimg.cn/20201029203102512.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<div align = 'right'>作者：hackett</div>

<div align = 'right'>微信公众号：加班猿</div>



<p>在上一节的基础上进行定义图标的功能</p>
<p>参考上一节的链接：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/hackettt/p/13916513.html">Qt无边框窗口拖拽和阴影</a></p>
<p>效果：要做的是应用的放大缩小、最小化功能，鼠标移动和点击图标变色</p>
<p><img src="https://gitee.com/hackett_h/typoraimg/raw/master/image/20201104193647.gif"></p>
<h2 id="准备工作："><a href="#准备工作：" class="headerlink" title="准备工作："></a>准备工作：</h2><h3 id="控件："><a href="#控件：" class="headerlink" title="控件："></a>控件：</h3><p>3个PushButton</p>
<p>1个Label</p>
<p>1个Frame</p>
<p><strong>注意：需要进行布局，如果不布局可能会出现不能放大缩小的情况</strong></p>
<p><img src="https://gitee.com/hackett_h/typoraimg/raw/master/image/20201104194259.png" alt="image-20201104194259480"></p>
<h3 id="准备图标嵌入控件"><a href="#准备图标嵌入控件" class="headerlink" title="准备图标嵌入控件"></a>准备图标嵌入控件</h3><p>可以上<a target="_blank" rel="noopener" href="https://www.iconfont.cn/">阿里巴巴矢量图标库</a>下载自己想要的图标，也可以去其他网站或者自己制作</p>
<p>我这里下载了三个图标</p>
<p><img src="https://gitee.com/hackett_h/typoraimg/raw/master/image/20201104195241.png" alt="image-20201104195241416"></p>
<h3 id="QSS样式表"><a href="#QSS样式表" class="headerlink" title="QSS样式表"></a>QSS样式表</h3><p>右键选择改变样式表，其他按键同理</p>
<p>添加颜色：</p>
<p>QPushButton为改变这个按钮的属性</p>
<p>QPushButton:hover为鼠标移动到按键的效果</p>
<p>QPushButton:pressed为鼠标按下按键的效果</p>
<p>添加资源：</p>
<p>可以选择我们资源里面的图片为按键填充图片</p>
<p><img src="https://gitee.com/hackett_h/typoraimg/raw/master/image/20201104201329.gif"></p>
<p>接下来就可以链接到槽函数做相应的处理即可</p>
<p><strong>放大缩小按钮需要做下margin值的设置</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Widget::on_buttonMax_clicked</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>-&gt;isMaximized())<span class="hljs-comment">//是否已经最大</span><br>    &#123;<br>        ui-&gt;vLayout-&gt;setMargin(<span class="hljs-number">9</span>);  <span class="hljs-comment">//对应widget布局的Margin值</span><br>        <span class="hljs-keyword">this</span>-&gt;showNormal();<br>    &#125;<span class="hljs-keyword">else</span><br>    &#123;<br>        ui-&gt;vLayout-&gt;setMargin(<span class="hljs-number">0</span>); <span class="hljs-comment">//全屏时widget布局的Margin值为0</span><br>        <span class="hljs-keyword">this</span>-&gt;showMaximized();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><img src="https://gitee.com/hackett_h/typoraimg/raw/master/image/20201104201038.png" alt="image-20201104201038634"></p>
<h2 id="源码："><a href="#源码：" class="headerlink" title="源码："></a>源码：</h2><p>main.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;widget.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QApplication&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-function">QApplication <span class="hljs-title">a</span><span class="hljs-params">(argc, argv)</span></span>;<br>    Widget w;<br>    w.show();<br><br>    <span class="hljs-keyword">return</span> a.exec();<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>widget.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;widget.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;ui_widget.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QMouseEvent&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QWidget&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QGraphicsDropShadowEffect&gt;</span></span><br><br>Widget::Widget(QWidget *parent) :<br>    QWidget(parent),<br>    ui(<span class="hljs-keyword">new</span> Ui::Widget)<br>&#123;<br>    ui-&gt;setupUi(<span class="hljs-keyword">this</span>);<br><br>    <span class="hljs-keyword">this</span>-&gt;setWindowFlags(Qt::FramelessWindowHint);<br><br>    QGraphicsDropShadowEffect *shadow = <span class="hljs-keyword">new</span> QGraphicsDropShadowEffect();<br><br>    shadow-&gt;setBlurRadius(<span class="hljs-number">5</span>);   <span class="hljs-comment">//边框圆角</span><br>    shadow-&gt;setColor(Qt::black);<span class="hljs-comment">//边框颜色</span><br>    shadow-&gt;setOffset(<span class="hljs-number">0</span>);       <span class="hljs-comment">//不偏移</span><br><br>    ui-&gt;shadowWidget-&gt;setGraphicsEffect(shadow);<br><br>    <span class="hljs-keyword">this</span>-&gt;setAttribute(Qt::WA_TranslucentBackground);   <span class="hljs-comment">//父窗口设置透明，只留下子窗口</span><br>&#125;<br><br>Widget::~Widget()<br>&#123;<br>    <span class="hljs-keyword">delete</span> ui;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Widget::mouseMoveEvent</span><span class="hljs-params">(QMouseEvent *event)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>-&gt;z == QPoint())<span class="hljs-comment">//判断鼠标移动 如果为空的话不移动</span><br>        <span class="hljs-keyword">return</span>;<br>    QPoint y = event-&gt;globalPos();<span class="hljs-comment">//鼠标相当于桌面左上角的位置，鼠标全局位置</span><br>    QPoint x = y - <span class="hljs-keyword">this</span>-&gt;z;<br>    <span class="hljs-keyword">this</span>-&gt;move(x);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Widget::mousePressEvent</span><span class="hljs-params">(QMouseEvent *event)</span></span><br><span class="hljs-function"></span>&#123;<br>    QPoint y = event-&gt;globalPos();<span class="hljs-comment">//鼠标相当于桌面左上角的位置，鼠标全局位置</span><br>    QPoint x = <span class="hljs-keyword">this</span>-&gt;geometry().topLeft();<span class="hljs-comment">//窗口左上角位于桌面左上角的位置，窗口位置</span><br>    <span class="hljs-keyword">this</span>-&gt;z = y - x; <span class="hljs-comment">//定值，不变</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Widget::mouseReleaseEvent</span><span class="hljs-params">(QMouseEvent *event)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">this</span>-&gt;z = QPoint(); <span class="hljs-comment">//鼠标松开获取当前的坐标</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Widget::on_buttonClose_clicked</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">this</span>-&gt;close();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Widget::on_buttonMax_clicked</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>-&gt;isMaximized())<span class="hljs-comment">//是否已经最大</span><br>    &#123;<br>        ui-&gt;vLayout-&gt;setMargin(<span class="hljs-number">9</span>);  <span class="hljs-comment">//对应widget布局的Margin值</span><br>        <span class="hljs-keyword">this</span>-&gt;showNormal();<br>    &#125;<span class="hljs-keyword">else</span><br>    &#123;<br>        ui-&gt;vLayout-&gt;setMargin(<span class="hljs-number">0</span>); <span class="hljs-comment">//全屏时widget布局的Margin值为0</span><br>        <span class="hljs-keyword">this</span>-&gt;showMaximized();<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Widget::on_buttonMin_clicked</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">this</span>-&gt;showMinimized();<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>widget.h</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> WIDGET_H</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> WIDGET_H</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QWidget&gt;</span></span><br><br><span class="hljs-keyword">namespace</span> Ui &#123;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Widget</span>;</span><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Widget</span> :</span> <span class="hljs-keyword">public</span> QWidget<br>&#123;<br>    Q_OBJECT<br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">Widget</span><span class="hljs-params">(QWidget *parent = <span class="hljs-number">0</span>)</span></span>;<br>    ~Widget();<br><br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">mouseMoveEvent</span><span class="hljs-params">(QMouseEvent *event)</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">mousePressEvent</span><span class="hljs-params">(QMouseEvent *event)</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">mouseReleaseEvent</span><span class="hljs-params">(QMouseEvent *event)</span></span>;<br><br><span class="hljs-keyword">private</span> slots:<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">on_buttonClose_clicked</span><span class="hljs-params">()</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">on_buttonMax_clicked</span><span class="hljs-params">()</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">on_buttonMin_clicked</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-keyword">private</span>:<br>    Ui::Widget *ui;<br>    QPoint z;<br>&#125;;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">// WIDGET_H</span></span><br></code></pre></td></tr></table></figure>

<p>如果你觉得文章还不错，记得”<strong>点赞关注</strong>“</p>
<p>关注我的微信公众号【 <strong>加班猿</strong> 】可以获取更多内容</p>
<p><img src="https://img-blog.csdnimg.cn/20201029203206698.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/11/01/Qt%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9B%BE%E6%A0%87%E5%8A%9F%E8%83%BD/" data-id="ckhvya4zj0006bglr6me30l4n" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/UI/" rel="tag">UI</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Qt无边框窗口拖拽和阴影" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/11/01/Qt%E6%97%A0%E8%BE%B9%E6%A1%86%E7%AA%97%E5%8F%A3%E6%8B%96%E6%8B%BD%E5%92%8C%E9%98%B4%E5%BD%B1/" class="article-date">
  <time datetime="2020-10-31T16:00:00.000Z" itemprop="datePublished">2020-11-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Qt/">Qt</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/11/01/Qt%E6%97%A0%E8%BE%B9%E6%A1%86%E7%AA%97%E5%8F%A3%E6%8B%96%E6%8B%BD%E5%92%8C%E9%98%B4%E5%BD%B1/">Qt无边框窗口拖拽和阴影</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://img-blog.csdnimg.cn/20201029203102512.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<div align = 'right'>作者：hackett</div>

<div align = 'right'>微信公众号：加班猿</div>



<h2 id="无边框窗口的实现"><a href="#无边框窗口的实现" class="headerlink" title="无边框窗口的实现"></a>无边框窗口的实现</h2><p>只需要一行代码即可实现</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">this</span>-&gt;setWindowFlags(Qt::FramelessWindowHint);<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/hackett_h/typoraimg/raw/master/image/20201102191116.png" alt="image-20201102191116019"></p>
<p>代码及运行效果：</p>
<p><img src="https://gitee.com/hackett_h/typoraimg/raw/master/image/20201102191341.png" alt="image-20201102191340908"></p>
<h2 id="无边框窗口能拖拽实现"><a href="#无边框窗口能拖拽实现" class="headerlink" title="无边框窗口能拖拽实现"></a>无边框窗口能拖拽实现</h2><p>先要去QWidget里面找到<strong>鼠标事件</strong>函数</p>
<p><img src="https://gitee.com/hackett_h/typoraimg/raw/master/image/20201102192216.png" alt="image-20201102192216514"></p>
<p>理一下<strong>坐标的位置</strong>情况：</p>
<p>左上角：屏幕的左上角</p>
<p>中间的窗口：程序的窗口</p>
<p>箭头：鼠标位置</p>
<p>坐标位置满足：<strong>x = y - z</strong></p>
<p><img src="https://gitee.com/hackett_h/typoraimg/raw/master/image/20201102193018.png" alt="image-20201102193018846"></p>
<p>在Designer里面拖一个Widget出来叫shadowWidget</p>
<p><img src="https://gitee.com/hackett_h/typoraimg/raw/master/image/20201102195257.png" alt="image-20201102195257871"></p>
<p>shadowWidget的颜色为灰色，我们选个自己喜欢的背景色方便查看</p>
<p><img src="https://gitee.com/hackett_h/typoraimg/raw/master/image/20201102200730.png" alt="image-20201102200730118"></p>
<p>接下来我们要重写鼠标事件函数才能让拖拽功能生效</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Widget::mouseMoveEvent</span><span class="hljs-params">(QMouseEvent *event)</span></span><br><span class="hljs-function"></span>&#123;<br>    QPoint y = event-&gt;globalPos();<span class="hljs-comment">//鼠标相当于桌面左上角的位置，鼠标全局位置</span><br>    QPoint x = y - <span class="hljs-keyword">this</span>-&gt;z;<br>    <span class="hljs-keyword">this</span>-&gt;move(x);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Widget::mousePressEvent</span><span class="hljs-params">(QMouseEvent *event)</span></span><br><span class="hljs-function"></span>&#123;<br>    QPoint y = event-&gt;globalPos();<span class="hljs-comment">//鼠标相当于桌面左上角的位置，鼠标全局位置</span><br>    QPoint x = <span class="hljs-keyword">this</span>-&gt;geometry().topLeft();<span class="hljs-comment">//窗口左上角位于桌面左上角的位置，窗口位置</span><br>    <span class="hljs-keyword">this</span>-&gt;z = y - x; <span class="hljs-comment">//定值，不变</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Widget::mouseReleaseEvent</span><span class="hljs-params">(QMouseEvent *event)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">this</span>-&gt;z = QPoint(); <span class="hljs-comment">//鼠标松开获取当前的坐标</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>最终效果变为鼠标可拖动的窗口：</p>
<p><img src="https://gitee.com/hackett_h/typoraimg/raw/master/image/20201102201327.png" alt="image-20201102201326910"></p>
<p>源码：</p>
<p>main.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;widget.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QApplication&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-function">QApplication <span class="hljs-title">a</span><span class="hljs-params">(argc, argv)</span></span>;<br>    Widget w;<br>    w.show();<br><br>    <span class="hljs-keyword">return</span> a.exec();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>widget.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;widget.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;ui_widget.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QMouseEvent&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QWidget&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QGraphicsDropShadowEffect&gt;</span></span><br><br>Widget::Widget(QWidget *parent) :<br>    QWidget(parent),<br>    ui(<span class="hljs-keyword">new</span> Ui::Widget)<br>&#123;<br>    ui-&gt;setupUi(<span class="hljs-keyword">this</span>);<br><br>    <span class="hljs-keyword">this</span>-&gt;setWindowFlags(Qt::FramelessWindowHint);<br><br>    QGraphicsDropShadowEffect *shadow = <span class="hljs-keyword">new</span> QGraphicsDropShadowEffect();<br><br>    shadow-&gt;setBlurRadius(<span class="hljs-number">5</span>);   <span class="hljs-comment">//边框圆角</span><br>    shadow-&gt;setColor(Qt::black);<span class="hljs-comment">//边框颜色</span><br>    shadow-&gt;setOffset(<span class="hljs-number">0</span>);       <span class="hljs-comment">//不偏移</span><br><br>    ui-&gt;shadowWidget-&gt;setGraphicsEffect(shadow);<br><br>    <span class="hljs-keyword">this</span>-&gt;setAttribute(Qt::WA_TranslucentBackground);   <span class="hljs-comment">//父窗口设置透明，只留下子窗口</span><br>&#125;<br><br>Widget::~Widget()<br>&#123;<br>    <span class="hljs-keyword">delete</span> ui;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Widget::mouseMoveEvent</span><span class="hljs-params">(QMouseEvent *event)</span></span><br><span class="hljs-function"></span>&#123;<br>    QPoint y = event-&gt;globalPos();<span class="hljs-comment">//鼠标相当于桌面左上角的位置，鼠标全局位置</span><br>    QPoint x = y - <span class="hljs-keyword">this</span>-&gt;z;<br>    <span class="hljs-keyword">this</span>-&gt;move(x);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Widget::mousePressEvent</span><span class="hljs-params">(QMouseEvent *event)</span></span><br><span class="hljs-function"></span>&#123;<br>    QPoint y = event-&gt;globalPos();<span class="hljs-comment">//鼠标相当于桌面左上角的位置，鼠标全局位置</span><br>    QPoint x = <span class="hljs-keyword">this</span>-&gt;geometry().topLeft();<span class="hljs-comment">//窗口左上角位于桌面左上角的位置，窗口位置</span><br>    <span class="hljs-keyword">this</span>-&gt;z = y - x; <span class="hljs-comment">//定值，不变</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Widget::mouseReleaseEvent</span><span class="hljs-params">(QMouseEvent *event)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">this</span>-&gt;z = QPoint(); <span class="hljs-comment">//鼠标松开获取当前的坐标</span><br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>widget.h</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> WIDGET_H</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> WIDGET_H</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QWidget&gt;</span></span><br><br><span class="hljs-keyword">namespace</span> Ui &#123;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Widget</span>;</span><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Widget</span> :</span> <span class="hljs-keyword">public</span> QWidget<br>&#123;<br>    Q_OBJECT<br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">Widget</span><span class="hljs-params">(QWidget *parent = <span class="hljs-number">0</span>)</span></span>;<br>    ~Widget();<br><br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">mouseMoveEvent</span><span class="hljs-params">(QMouseEvent *event)</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">mousePressEvent</span><span class="hljs-params">(QMouseEvent *event)</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">mouseReleaseEvent</span><span class="hljs-params">(QMouseEvent *event)</span></span>;<br><br><span class="hljs-keyword">private</span>:<br>    Ui::Widget *ui;<br>    QPoint z;<br>&#125;;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">// WIDGET_H</span></span><br></code></pre></td></tr></table></figure>

<p>如果你觉得文章还不错，记得”<strong>点赞关注</strong>“</p>
<p>关注我的微信公众号【 <strong>加班猿</strong> 】可以获取更多内容</p>
<p><img src="https://img-blog.csdnimg.cn/20201029203206698.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/11/01/Qt%E6%97%A0%E8%BE%B9%E6%A1%86%E7%AA%97%E5%8F%A3%E6%8B%96%E6%8B%BD%E5%92%8C%E9%98%B4%E5%BD%B1/" data-id="ckhvya4zk0007bglracdk9bro" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/UI/" rel="tag">UI</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Qt笔记总结" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/28/Qt%E7%AC%94%E8%AE%B0%E6%80%BB%E7%BB%93/" class="article-date">
  <time datetime="2020-10-27T16:00:00.000Z" itemprop="datePublished">2020-10-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Qt/">Qt</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/28/Qt%E7%AC%94%E8%AE%B0%E6%80%BB%E7%BB%93/">Qt笔记总结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://img-blog.csdnimg.cn/20201028200839229.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<div align = 'right'>作者：hackett</div>

<div align = 'right'>微信公众号：加班猿</div>



<h2 id="一、常用控件"><a href="#一、常用控件" class="headerlink" title="一、常用控件"></a>一、常用控件</h2><h3 id="按钮类"><a href="#按钮类" class="headerlink" title="按钮类"></a>按钮类</h3><p>QPushButton</p>
<p>QtoolButton</p>
<p>QRadioButton</p>
<h3 id="item"><a href="#item" class="headerlink" title="item"></a>item</h3><p>QListWidget</p>
<h3 id="容器类"><a href="#容器类" class="headerlink" title="容器类"></a>容器类</h3><p>QStackWidget</p>
<p>QWidget</p>
<p>QFrame</p>
<h3 id="编辑类"><a href="#编辑类" class="headerlink" title="编辑类"></a>编辑类</h3><p>QComboBox</p>
<p>QLineEdit</p>
<p>QTextEdit</p>
<h3 id="显示类"><a href="#显示类" class="headerlink" title="显示类"></a>显示类</h3><p>QLabel</p>
<p><strong>setOpenExternalLinks()设置为true自动打开，false要打开链接需要捕捉linkActivated()信号</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//显示普通文本字符串</span><br>QLable *label = <span class="hljs-keyword">new</span> QLable;<br>label-&gt;setText(“Hello, World!”);<br><span class="hljs-comment">//显示HTML格式的字符串</span><br>QLabel * label = <span class="hljs-keyword">new</span> QLabel(<span class="hljs-keyword">this</span>);<br>label -&gt;setText(<span class="hljs-string">&quot;Hello, World&quot;</span>);<br>label -&gt;setText(<span class="hljs-string">&quot;&lt;h1&gt;&lt;a href=\&quot;https://www.baidu.com\&quot;&gt;</span><br><span class="hljs-string">百度一下&lt;/a&gt;&lt;/h1&gt;&quot;</span>);<br>label -&gt;setOpenExternalLinks(<span class="hljs-literal">true</span>);<br></code></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c++">QLabel * label = <span class="hljs-keyword">new</span> QLabel(<span class="hljs-keyword">this</span>);<br>label -&gt;setText(<span class="hljs-string">&quot;Hello, World&quot;</span>);<br>label -&gt;setText(<span class="hljs-string">&quot;&lt;h1&gt;&lt;a href=\&quot;https://www.baidu.com\&quot;&gt;</span><br><span class="hljs-string">百度一下&lt;/a&gt;&lt;/h1&gt;&quot;</span>);<br><span class="hljs-comment">// label-&gt;setOpenExternalLinks(true);</span><br>connect(label, &amp;QLabel::linkActivated, <br><span class="hljs-keyword">this</span>, &amp;MyWidget::slotOpenUrl);<br><br><span class="hljs-comment">//槽函数	</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">MyWidget::slotOpenUrl</span><span class="hljs-params">(<span class="hljs-keyword">const</span> QString &amp;link)</span></span><br><span class="hljs-function"></span>&#123;<br>    QDesktopServices::openUrl(QUrl(link));<br>&#125;<br></code></pre></td></tr></table></figure>

<p>QProcessBar</p>
<p>QMessageBox</p>
<h2 id="二、信号与槽"><a href="#二、信号与槽" class="headerlink" title="二、信号与槽"></a>二、信号与槽</h2><h3 id="信号和槽"><a href="#信号和槽" class="headerlink" title="信号和槽"></a>信号和槽</h3><p>信号槽，实际就是观察者模式。<strong>当某个事件发生之后，它就会发出一个信号（signal）将想要处理的信号和自己的一个函数（称为槽（slot））绑定来处理这个信号。当信号发出时，被连接的槽函数会自动被回调。</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-number">1</span>、connect(sender, signal, receiver, slot);<br></code></pre></td></tr></table></figure>

<ul>
<li>sender：发送信号的对象</li>
<li>signal：发送对象发出的信号</li>
<li>receiver：接收信号的对象</li>
<li>slot：接收对象在接收到信号之后所需要调用的函数</li>
</ul>
<p>例如：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">/* &amp;b1: 信号发出者，指针类型</span><br><span class="hljs-comment">* &amp;QPushButton::pressed：处理的信号	(&amp;发送者的类名::信号名字)</span><br><span class="hljs-comment">* this: 信号接收者</span><br><span class="hljs-comment">* &amp;MainWidget::close：槽函数，信号处理函数 (&amp;接收的类名::槽函数名字)</span><br><span class="hljs-comment">*/</span><br>connect(&amp;b1, &amp;QPushButton::pressed, <span class="hljs-keyword">this</span>, &amp;MainWidget::close);<br></code></pre></td></tr></table></figure>

<h3 id="自定义信号槽"><a href="#自定义信号槽" class="headerlink" title="自定义信号槽"></a>自定义信号槽</h3><h4 id="自定义信号槽需要注意的事项"><a href="#自定义信号槽需要注意的事项" class="headerlink" title="自定义信号槽需要注意的事项"></a>自定义信号槽需要注意的事项</h4><ul>
<li><p><strong>发送者和接收者都需要是QObject的子类（当然，槽函数是全局函数、Lambda 表达式等无需接收者的时候除外）；</strong></p>
</li>
<li><p><strong>使用 signals 标记信号函数，信号是一个函数声明，返回 void，不需要实现函数代码；</strong></p>
</li>
<li><p><strong>槽函数是普通的成员函数，作为成员函数，会受到 public、private、protected 的影响；</strong></p>
</li>
<li><p><strong>使用 emit 在恰当的位置发送信号；</strong></p>
</li>
<li><p><strong>使用QObject::connect()函数连接信号和槽。</strong></p>
</li>
<li><p><strong>任何成员函数、static 函数、全局函数和 Lambda 表达式都可以作为槽函数</strong></p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">/* 自定义槽，普通函数的用法</span><br><span class="hljs-comment">* Qt5：任意的成员函数，普通全局函数，静态函数</span><br><span class="hljs-comment">* 槽函数需要和信号一致（参数，返回值）</span><br><span class="hljs-comment">* 由于信号都是没有返回值，所以，槽函数一定没有返回值</span><br><span class="hljs-comment">*/</span><br>connect(b2, &amp;QPushButton::released, <span class="hljs-keyword">this</span>, &amp;MainWidget::mySlot);<br></code></pre></td></tr></table></figure>

<h3 id="Lambda表达式"><a href="#Lambda表达式" class="headerlink" title="Lambda表达式"></a>Lambda表达式</h3><p>C++11中的Lambda表达式<strong>用于定义并创建匿名的函数对象</strong>。</p>
<p>基本构成：[函数对象参数](操作符重载函数参数)mutable或exception -&gt;返回值{函数体}</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/57ad00546224b5d0b2d1d004c4cb31e1.png"></p>
<p>1、函数对象参数：</p>
<p>[ ] 标识一个<strong>Lambda的开始</strong>，这部分必须存在，<strong>不能省略</strong>。</p>
<ul>
<li><p> 空，没有任何函数对象参数</p>
</li>
<li><p>=，<strong>值传递方式</strong>（作用范围：所有可见的局部变量以及所在类的this）</p>
</li>
<li><p>&amp;，<strong>引用传递方式</strong>（作用范围：所有可见的局部变量以及所在类的this）</p>
</li>
<li><p>this，函数体内可以可以使用<strong>Lambda所在类</strong>中的成员变量</p>
</li>
<li><p>a，把a按值进行传递（默认为const不可修改，可添加mutable修饰符修改）</p>
</li>
<li><p>&amp;b，把b按引用进行传递</p>
</li>
<li><p>&amp;，a，b，除a和b进行值传递，其他参数按引用进行传递</p>
</li>
</ul>
<p>2、操作符重载函数参数：</p>
<p>标识重载的()操作符的参数，没有参数时，这部分可以省略。</p>
<p>3、可修改标示符：</p>
<p>mutable声明，这部分可以省略。按值传递函数对象参数时，加上mutable修饰符后，可以修改按值传递进来的拷贝（注意是能修改拷贝，而不是值本身）。</p>
<p>4、错误抛出标示符：</p>
<p>exception声明，这部分也可以省略。exception声明用于指定函数抛出的异常，如抛出整数类型的异常，可以使用throw(int)</p>
<p>5、函数返回值：</p>
<p>-&gt;返回值类型，标识函数返回值的类型，当返回值为void，或者函数体中只有一处return的地方（此时编译器可以自动推断出返回值类型）时，这部分可以省略。</p>
<p>6、函数体：    </p>
<p>  {}，标识函数的实现，这部分<strong>不能省略</strong>，但函数体可以为空。</p>
<p>   ​     </p>
<h2 id="三、Qt窗口系统"><a href="#三、Qt窗口系统" class="headerlink" title="三、Qt窗口系统"></a>三、Qt窗口系统</h2><h3 id="1、坐标体系"><a href="#1、坐标体系" class="headerlink" title="1、坐标体系"></a>1、坐标体系</h3><p>以左上角为原点，X向右增加，Y向下增加。</p>
<p><img src="https://img-blog.csdnimg.cn/20201029110721546.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-7PAwd2gB-1603886732744)(https://raw.githubusercontent.com/CodingEmbedded/cloudimg/master/image/20201028185754.png)]"></p>
<h3 id="2、QWidget"><a href="#2、QWidget" class="headerlink" title="2、QWidget"></a>2、QWidget</h3><p>所有窗口及窗口控件都是从QWidget直接或间接派生出来的。</p>
<ol>
<li><p>对象模型</p>
<ul>
<li><p>Qt创建对象的时候会提供一个Parent对象指针</p>
<p>  <strong>在创建QObject对象时，可以提供一个其父对象，我们创建的这个QObject对象会自动添加到其父对象的children()列表。当父对象析构的时候，这个列表中的所有对象也会被析构。（注意，这里的父对象并不是继承意义上的父类！）</strong></p>
</li>
<li><p>QWidget是能够在屏幕上显示的一切组件的父类</p>
<p>  <strong>QWidget继承自QObject，因此也继承了这种对象树关系。一个孩子自动地成为父组件的一个子组件，也可以自己删除子对象，它们会自动从其父对象列表中删除。</strong></p>
</li>
<li><p>当一个QObject对象在堆上创建的时候，Qt 会同时为其创建一个对象树。不过，对象树中对象的顺序是没有定义的。这意味着，销毁这些对象的顺序也是未定义的</p>
</li>
<li><p>任何对象树中的 QObject对象 delete 的时候，如果这个对象有 parent，则自动将其从 parent 的children()列表中删除；如果有孩子，则自动 delete 每一个孩子。Qt 保证没有QObject会被 delete 两次，这是由析构顺序决定的。</p>
</li>
</ul>
</li>
</ol>
<h3 id="3、QMainWindow"><a href="#3、QMainWindow" class="headerlink" title="3、QMainWindow"></a>3、QMainWindow</h3><p>QMainWindow是一个为用户提供主窗口程序的类，包含<strong>一个菜单栏（menu bar）、多个工具栏(tool bars)、多个锚接部件(dock widgets)、一个状态栏(status bar)及一个中心部件(central widget)</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20201029110743123.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>1、菜单栏</p>
<ul>
<li><p>创建菜单栏，通过QMainWindow类的menubar() 函数获取主窗口菜单栏指针</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">QMenuBar *	<span class="hljs-title">menuBar</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span></span><br></code></pre></td></tr></table></figure>
</li>
<li><p>创建菜单，调用QMenu的成员函数addMenu() 来添加菜单</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">QAction* <span class="hljs-title">addMenu</span><span class="hljs-params">(QMenu * menu)</span></span><br><span class="hljs-function">QMenu* <span class="hljs-title">addMenu</span><span class="hljs-params">(<span class="hljs-keyword">const</span> QString &amp; title)</span></span><br><span class="hljs-function">QMenu* <span class="hljs-title">addMenu</span><span class="hljs-params">(<span class="hljs-keyword">const</span> QIcon &amp; icon, <span class="hljs-keyword">const</span> QString &amp; title)</span></span><br></code></pre></td></tr></table></figure>
</li>
<li><p>创建菜单项，调用QMenu的成员函数addAction() 来添加菜单项</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">QAction* <span class="hljs-title">activeAction</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span></span><br><span class="hljs-function">QAction* <span class="hljs-title">addAction</span><span class="hljs-params">(<span class="hljs-keyword">const</span> QString &amp; text)</span></span><br><span class="hljs-function">QAction* <span class="hljs-title">addAction</span><span class="hljs-params">(<span class="hljs-keyword">const</span> QIcon &amp; icon, <span class="hljs-keyword">const</span> QString &amp; text)</span></span><br><span class="hljs-function">QAction* <span class="hljs-title">addAction</span><span class="hljs-params">(<span class="hljs-keyword">const</span> QString &amp; text, <span class="hljs-keyword">const</span> QObject * receiver,</span></span><br><span class="hljs-function"><span class="hljs-params"> <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> * member, <span class="hljs-keyword">const</span> QKeySequence &amp; shortcut = <span class="hljs-number">0</span>)</span></span><br><span class="hljs-function">QAction* <span class="hljs-title">addAction</span><span class="hljs-params">(<span class="hljs-keyword">const</span> QIcon &amp; icon, <span class="hljs-keyword">const</span> QString &amp; text, </span></span><br><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span> QObject * receiver, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> * member, </span></span><br><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span> QKeySequence &amp; shortcut = <span class="hljs-number">0</span>)</span></span><br></code></pre></td></tr></table></figure>

</li>
</ul>
<p>2、工具栏</p>
<ul>
<li><p>直接调用QMainWindow类的addToolBar() 函数获取主窗口的工具条对象，每增加一个工具条都需要调用一次该函数。</p>
</li>
<li><p>n 插入属于工具条的动作，即在工具条上添加操作。通过QToolBar类的addAction() 函数添加。</p>
</li>
<li><p>n 工具条是一个可移动的窗口，它的停靠区域由QToolBar的allowAreas决定，包括：</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">/*</span><br><span class="hljs-comment">Qt::LeftToolBarArea		//停靠在左侧</span><br><span class="hljs-comment">Qt::RightToolBarArea		//停靠在右侧</span><br><span class="hljs-comment">Qt::TopToolBarArea		//停靠在顶部</span><br><span class="hljs-comment">Qt::BottomToolBarArea   	//停靠在底部</span><br><span class="hljs-comment">Qt::AllToolBarAreas		//以上四个位置都可停靠</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-comment">/*使用setAllowedAreas（）函数指定停靠区域*/</span><br>setAllowedAreas(Qt::LeftToolBarArea | Qt::RightToolBarArea);<br><span class="hljs-comment">/*使用setMoveable（）函数设定工具栏的可移动性*/</span><br>setMoveable(<span class="hljs-literal">false</span>);<span class="hljs-comment">//工具条不可移动, 只能停靠在初始化的位置上</span><br><br></code></pre></td></tr></table></figure>

</li>
</ul>
<p>3、状态栏</p>
<ul>
<li><p>派生自QWidget类，使用方法与QWidget类似，QStatusBar类常用成员函数：</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//添加小部件</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">addWidget</span><span class="hljs-params">(QWidget * widget, <span class="hljs-keyword">int</span> stretch = <span class="hljs-number">0</span>)</span></span><br><span class="hljs-function"><span class="hljs-comment">//插入小部件</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span>	<span class="hljs-title">insertWidget</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index, QWidget * widget, <span class="hljs-keyword">int</span> stretch = <span class="hljs-number">0</span>)</span></span><br><span class="hljs-function"><span class="hljs-comment">//删除小部件</span></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">removeWidget</span><span class="hljs-params">(QWidget * widget)</span></span><br></code></pre></td></tr></table></figure>



</li>
</ul>
<h3 id="4、对话框QDialog"><a href="#4、对话框QDialog" class="headerlink" title="4、对话框QDialog"></a>4、对话框QDialog</h3><p>Qt 中使用QDialog类实现对话框。</p>
<p><strong>对话框分为模态对话框和非模态对话框。</strong></p>
<ul>
<li><p>模态对话框，就是会阻塞同一应用程序中其它窗口的输入。</p>
<p>  模态对话框很常见，比如“打开文件”功能。你可以尝试一下记事本的打开文件，当打开文件对话框出现时，我们是不能对除此对话框之外的窗口部分进行操作的。</p>
</li>
<li><p>与此相反的是非模态对话框，例如查找对话框，我们可以在显示着查找对话框的同时，继续对记事本的内容进行编辑。</p>
</li>
</ul>
<p>1、标准对话框</p>
<p>Qt 的内置对话框大致分为以下几类：</p>
<ul>
<li><p>QColorDialog：    选择颜色；</p>
</li>
<li><p>QFileDialog：    选择文件或者目录；</p>
</li>
<li><p>QFontDialog：    选择字体；</p>
</li>
<li><p>QInputDialog：    允许用户输入一个值，并将其值返回；</p>
</li>
<li><p>QMessageBox：    模态对话框，用于显示信息、询问问题等；</p>
</li>
<li><p>QPageSetupDialog：  为打印机提供纸张相关的选项；</p>
</li>
<li><p>QPrintDialog：    打印机配置；</p>
</li>
<li><p>QPrintPreviewDialog：打印预览；</p>
</li>
<li><p>QProgressDialog：  显示操作过程。</p>
</li>
</ul>
<p>2、自定义消息框</p>
<p>Qt 支持模态对话框和非模态对话框。</p>
<p>模态与非模态的实现：</p>
<ul>
<li><p>使用QDialog::exec()实现应用程序级别的模态对话框</p>
</li>
<li><p>使用QDialog::open()实现窗口级别的模态对话框</p>
</li>
<li><p>使用QDialog::show()实现非模态对话框。</p>
</li>
</ul>
<p>3、模态对话框</p>
<p>下面的示例中，我们调用了exec()将对话框显示出来，因此这就是一个模态对话框。当对话框出现时，我们不能与主窗口进行任何交互，直到我们关闭了该对话框。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">MainWindow::open</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    QDialog dialog;<br>    dialog.setWindowTitle(tr(<span class="hljs-string">&quot;Hello, dialog!&quot;</span>));<br>    dialog.exec();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>4、非模态对话框</p>
<p>下面我们试着将exec()修改为show()，看看非模态对话框：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">MainWindow::open</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-function">QDialog <span class="hljs-title">dialog</span><span class="hljs-params">(<span class="hljs-keyword">this</span>)</span></span>;<br>    dialog.setWindowTitle(tr(<span class="hljs-string">&quot;Hello, dialog!&quot;</span>));<br>    dialog.show();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>是不是事与愿违？对话框竟然一闪而过！这是因为，<strong>show()函数不会阻塞当前线程，对话框会显示出来，然后函数立即返回，代码继续执行。</strong>注意，dialog 是建立在栈上的，show()函数返回，MainWindow::open()函数结束，dialog 超出作用域被析构，因此对话框消失了。知道了原因就好改了，我们将 dialog 改成堆上建立，当然就没有这个问题了：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">MainWindow::open</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    QDialog *dialog = <span class="hljs-keyword">new</span> QDialog;<br>    dialog-&gt;setWindowTitle(tr(<span class="hljs-string">&quot;Hello, dialog!&quot;</span>));<br>    dialog-&gt;show();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>如果你足够细心，应该发现上面的代码是有问题的：dialog 存在内存泄露！dialog 使用 new 在堆上分配空间，却一直没有 delete。解决方案也很简单：将 MainWindow 的指针赋给 dialog 即可。还记得我们前面说过的 Qt 的对象系统吗？</p>
<p>不过，这样做有一个问题：如果我们的对话框不是在一个界面类中出现呢？由于QWidget的 parent 必须是QWidget指针，那就限制了我们不能将一个普通的 C++ 类指针传给 Qt 对话框。另外，如果对内存占用有严格限制的话，当我们将主窗口作为 parent 时，主窗口不关闭，对话框就不会被销毁，所以会一直占用内存。在这种情景下，我们可以设置 dialog 的WindowAttribute：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">MainWindow::open</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    QDialog *dialog = <span class="hljs-keyword">new</span> QDialog;<br>    dialog-&gt;setAttribute(Qt::WA_DeleteOnClose);<br>    dialog-&gt;setWindowTitle(tr(<span class="hljs-string">&quot;Hello, dialog!&quot;</span>));<br>    dialog-&gt;show();<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>setAttribute()函数设置对话框关闭时，自动销毁对话框。</strong></p>
<p>1、消息对话框</p>
<p>QMessageBox用于显示消息提示。我们一般会使用其提供的几个 static 函数：</p>
<ul>
<li><p>显示关于对话框。</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">about</span><span class="hljs-params">(QWidget * parent, <span class="hljs-keyword">const</span> QString &amp; title, <span class="hljs-keyword">const</span> QString &amp; text)</span></span><br></code></pre></td></tr></table></figure>

<p>  这是一个最简单的对话框，其标题是 title，内容是 text，父窗口是 parent。对话框只有一个 OK 按钮。</p>
</li>
<li><p>显示关于 Qt 对话框。该对话框用于显示有关 Qt 的信息。</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">aboutQt</span><span class="hljs-params">(QWidget * parent, <span class="hljs-keyword">const</span> QString &amp; title = QString())</span></span><br></code></pre></td></tr></table></figure>
</li>
<li><p>显示严重错误对话框。</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">StandardButton <span class="hljs-title">critical</span><span class="hljs-params">(QWidget * parent, </span></span><br><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span> QString &amp; title, </span></span><br><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span> QString &amp; text, </span></span><br><span class="hljs-function"><span class="hljs-params">StandardButtons buttons = Ok, </span></span><br><span class="hljs-function"><span class="hljs-params">StandardButton defaultButton = NoButton)</span></span><br></code></pre></td></tr></table></figure>

<p>  这个对话框将显示一个红色的错误符号。我们可以通过 buttons 参数指明其显示的按钮。默认情况下只有一个 Ok 按钮，我们可以使用StandardButtons类型指定多种按钮。</p>
</li>
<li><p>与QMessageBox::critical()类似，不同之处在于这个对话框提供一个普通信息图标。</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">StandardButton <span class="hljs-title">information</span><span class="hljs-params">(QWidget * parent, </span></span><br><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span> QString &amp; title, </span></span><br><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span> QString &amp; text, </span></span><br><span class="hljs-function"><span class="hljs-params">StandardButtons buttons = Ok, </span></span><br><span class="hljs-function"><span class="hljs-params">StandardButton defaultButton = NoButton)</span></span><br></code></pre></td></tr></table></figure>
</li>
<li><p>与QMessageBox::critical()类似，不同之处在于这个对话框提供一个问号图标，并且其显示的按钮是“是”和“否”。</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">StandardButton <span class="hljs-title">question</span><span class="hljs-params">(QWidget * parent,</span></span><br><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span> QString &amp; title, </span></span><br><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span> QString &amp; text, </span></span><br><span class="hljs-function"><span class="hljs-params">StandardButtons buttons = StandardButtons( Yes | No ), </span></span><br><span class="hljs-function"><span class="hljs-params">StandardButton defaultButton = NoButton)</span></span><br></code></pre></td></tr></table></figure>
</li>
<li><p>与QMessageBox::critical()类似，不同之处在于这个对话框提供一个黄色叹号图标。</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">StandardButton <span class="hljs-title">warning</span><span class="hljs-params">(QWidget * parent, </span></span><br><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span> QString &amp; title, </span></span><br><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span> QString &amp; text, </span></span><br><span class="hljs-function"><span class="hljs-params">StandardButtons buttons = Ok, </span></span><br><span class="hljs-function"><span class="hljs-params">StandardButton defaultButton = NoButton)</span></span><br></code></pre></td></tr></table></figure>

</li>
</ul>
<p>2、标准文件对话框</p>
<p>QFileDialog，也就是文件对话框。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c++">openAction = <span class="hljs-keyword">new</span> QAction(QIcon(<span class="hljs-string">&quot;:/images/file-open&quot;</span>),<br> tr(<span class="hljs-string">&quot;&amp;Open...&quot;</span>), <span class="hljs-keyword">this</span>);<br>openAction-&gt;setShortcuts(QKeySequence::Open);<br>openAction-&gt;setStatusTip(tr(<span class="hljs-string">&quot;Open an existing file&quot;</span>));<br><br>saveAction = <span class="hljs-keyword">new</span> QAction(QIcon(<span class="hljs-string">&quot;:/images/file-save&quot;</span>), <br>tr(<span class="hljs-string">&quot;&amp;Save...&quot;</span>), <span class="hljs-keyword">this</span>);<br>saveAction-&gt;setShortcuts(QKeySequence::Save);<br>saveAction-&gt;setStatusTip(tr(<span class="hljs-string">&quot;Save a new file&quot;</span>));<br><br>QMenu *file = menuBar()-&gt;addMenu(tr(<span class="hljs-string">&quot;&amp;File&quot;</span>));<br>file-&gt;addAction(openAction);<br>file-&gt;addAction(saveAction);<br><br>QToolBar *toolBar = addToolBar(tr(<span class="hljs-string">&quot;&amp;File&quot;</span>));<br>toolBar-&gt;addAction(openAction);<br>toolBar-&gt;addAction(saveAction);<br><br>textEdit = <span class="hljs-keyword">new</span> QTextEdit(<span class="hljs-keyword">this</span>);<br>setCentralWidget(textEdit);<br></code></pre></td></tr></table></figure>

<p>使用connect()函数，为这两个QAction对象添加响应的动作：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++">connect(openAction, &amp;QAction::triggered, <br><span class="hljs-keyword">this</span>, &amp;MainWindow::openFile);<br>connect(saveAction, &amp;QAction::triggered, <br><span class="hljs-keyword">this</span>, &amp;MainWindow::saveFile);<br></code></pre></td></tr></table></figure>

<p>下面是最主要的openFile()和saveFile()这两个函数的代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//打开文件</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">MainWindow::openFile</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    QString path = QFileDialog::getOpenFileName(<span class="hljs-keyword">this</span>,<br>               tr(<span class="hljs-string">&quot;Open File&quot;</span>), <span class="hljs-string">&quot;.&quot;</span>, tr(<span class="hljs-string">&quot;Text Files(*.txt)&quot;</span>));<br>    <span class="hljs-keyword">if</span>(!path.isEmpty()) <br>&#123;<br>        <span class="hljs-function">QFile <span class="hljs-title">file</span><span class="hljs-params">(path)</span></span>;<br>        <span class="hljs-keyword">if</span> (!file.open(QIODevice::ReadOnly | QIODevice::Text)) <br>&#123;<br>            QMessageBox::warning(<span class="hljs-keyword">this</span>, tr(<span class="hljs-string">&quot;Read File&quot;</span>),<br>                         tr(<span class="hljs-string">&quot;Cannot open file:\n%1&quot;</span>).arg(path));<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-function">QTextStream <span class="hljs-title">in</span><span class="hljs-params">(&amp;file)</span></span>;<br>        textEdit-&gt;setText(in.readAll());<br>        file.close();<br>    &#125; <br><span class="hljs-keyword">else</span> <br>&#123;<br>        QMessageBox::warning(<span class="hljs-keyword">this</span>, tr(<span class="hljs-string">&quot;Path&quot;</span>),<br>                             tr(<span class="hljs-string">&quot;You did not select any file.&quot;</span>));<br>     &#125;<br>&#125;<br><br><span class="hljs-comment">//保存文件</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">MainWindow::saveFile</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    QString path = QFileDialog::getSaveFileName(<span class="hljs-keyword">this</span>,<br>               tr(<span class="hljs-string">&quot;Open File&quot;</span>), <span class="hljs-string">&quot;.&quot;</span>, tr(<span class="hljs-string">&quot;Text Files(*.txt)&quot;</span>));<br>    <span class="hljs-keyword">if</span>(!path.isEmpty()) <br>&#123;<br>        <span class="hljs-function">QFile <span class="hljs-title">file</span><span class="hljs-params">(path)</span></span>;<br>        <span class="hljs-keyword">if</span> (!file.open(QIODevice::WriteOnly | QIODevice::Text)) <br>&#123;<br>            QMessageBox::warning(<span class="hljs-keyword">this</span>, tr(<span class="hljs-string">&quot;Write File&quot;</span>),<br>                         tr(<span class="hljs-string">&quot;Cannot open file:\n%1&quot;</span>).arg(path));<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-function">QTextStream <span class="hljs-title">out</span><span class="hljs-params">(&amp;file)</span></span>;<br>        out &lt;&lt; textEdit-&gt;toPlainText();<br>        file.close();<br>    &#125; <br><span class="hljs-keyword">else</span> <br>&#123;<br>        QMessageBox::warning(<span class="hljs-keyword">this</span>, tr(<span class="hljs-string">&quot;Path&quot;</span>),<br>                             tr(<span class="hljs-string">&quot;You did not select any file.&quot;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>QFileDialog::getOpenFileName()来获取需要打开的文件的路径。这个函数原型如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">QString <span class="hljs-title">getOpenFileName</span><span class="hljs-params">(QWidget * parent = <span class="hljs-number">0</span>,</span></span><br><span class="hljs-function"><span class="hljs-params">                        <span class="hljs-keyword">const</span> QString &amp; caption = QString(),</span></span><br><span class="hljs-function"><span class="hljs-params">                        <span class="hljs-keyword">const</span> QString &amp; dir = QString(),</span></span><br><span class="hljs-function"><span class="hljs-params">                        <span class="hljs-keyword">const</span> QString &amp; filter = QString(),</span></span><br><span class="hljs-function"><span class="hljs-params">                        QString * selectedFilter = <span class="hljs-number">0</span>,</span></span><br><span class="hljs-function"><span class="hljs-params">                        Options options = <span class="hljs-number">0</span>)</span></span><br></code></pre></td></tr></table></figure>

<p>六个参数分别是：</p>
<ul>
<li><p>parent：父窗口</p>
</li>
<li><p>caption：对话框标题</p>
</li>
<li><p>dir：对话框打开时的默认目录</p>
<p>  “.” 代表程序运行目录</p>
<p>  “/” 代表当前盘符的根目录（特指 Windows 平台；Linux 平台当然就是根目录），这个参数也可以是平台相关的，比如“C:\”等</p>
</li>
<li><p>filter：过滤器。</p>
<p>  我们使用文件对话框可以浏览很多类型的文件，但是，很多时候我们仅希望打开特定类型的文件</p>
</li>
<li><p>selectedFilter：默认选择的过滤器</p>
</li>
<li><p>options：对话框的一些参数设定</p>
<p>  比如只显示文件夹等等，它的取值是enum QFileDialog::Option，每个选项可以使用 | 运算组合起来</p>
</li>
</ul>
<h2 id="四、布局管理器"><a href="#四、布局管理器" class="headerlink" title="四、布局管理器"></a>四、布局管理器</h2><p>Qt提供了两种组件定位机制：<strong>绝对定位和布局定位。</strong></p>
<h3 id="绝对定位"><a href="#绝对定位" class="headerlink" title="绝对定位"></a>绝对定位</h3><p>绝对定位就是一种最原始的定位方法：给出这个组件的坐标和长宽值。</p>
<p>如果用户改变了窗口大小，比如点击最大化按钮或者使用鼠标拖动窗口边缘，采用绝对定位的组件是不会有任何响应的。</p>
<h3 id="布局定位"><a href="#布局定位" class="headerlink" title="布局定位"></a>布局定位</h3><p>只要把组件放入某一种布局，布局由专门的布局管理器进行管理。当需要调整大小或者位置的时候，Qt 使用对应的布局管理器进行调整。</p>
<p>Qt 提供的布局中以下三种是我们最常用的：</p>
<ol>
<li>QHBoxLayout：按照水平方向从左到右布局；</li>
<li>QVBoxLayout：按照竖直方向从上到下布局；</li>
<li>QGridLayout：在一个网格中进行布局，类似于 HTML 的 table；</li>
</ol>
<h3 id="自定义控件"><a href="#自定义控件" class="headerlink" title="自定义控件"></a>自定义控件</h3><p>UI的控件和自定义控件的父类（基类）要一样</p>
<p>选中UI控件 -&gt; 提升</p>
<h2 id="五、消息机制和事件"><a href="#五、消息机制和事件" class="headerlink" title="五、消息机制和事件"></a>五、消息机制和事件</h2><h3 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h3><p><strong>Qt 中所有事件类都继承于QEvent</strong></p>
<p><strong>event()函数并不直接处理事件，而是按照事件对象的类型分派给特定的事件处理函数</strong>（event handler）</p>
<p>在所有组件的父类QWidget中，定义了很多事件处理的回调函数，如：</p>
<ul>
<li><p>keyPressEvent()</p>
</li>
<li><p>keyReleaseEvent()</p>
</li>
<li><p>mouseDoubleClickEvent()</p>
</li>
<li><p>mouseMoveEvent()</p>
</li>
<li><p>mousePressEvent()</p>
</li>
<li><p>mouseReleaseEvent() 等。</p>
</li>
</ul>
<p>这些函数都是 protected virtual 的，也就是说我们可以在<strong>子类中重新实现</strong>这些函数。下面来看一个例子：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EventLabel</span> :</span> <span class="hljs-keyword">public</span> QLabel<br>&#123;<br><span class="hljs-keyword">protected</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mouseMoveEvent</span><span class="hljs-params">(QMouseEvent *event)</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mousePressEvent</span><span class="hljs-params">(QMouseEvent *event)</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mouseReleaseEvent</span><span class="hljs-params">(QMouseEvent *event)</span></span>;<br>&#125;;<br> <br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">EventLabel::mouseMoveEvent</span><span class="hljs-params">(QMouseEvent *event)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">this</span>-&gt;setText(QString(<span class="hljs-string">&quot;&lt;center&gt;&lt;h1&gt;Move: (%1, %2)</span><br><span class="hljs-string">&lt;/h1&gt;&lt;/center&gt;&quot;</span>).arg(QString::number(event-&gt;x()),<br>            QString::number(event-&gt;y())));<br>&#125;<br> <br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">EventLabel::mousePressEvent</span><span class="hljs-params">(QMouseEvent *event)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">this</span>-&gt;setText(QString(<span class="hljs-string">&quot;&lt;center&gt;&lt;h1&gt;Press:(%1, %2)</span><br><span class="hljs-string">&lt;/h1&gt;&lt;/center&gt;&quot;</span>).arg(QString::number(event-&gt;x()),<br>                QString::number(event-&gt;y())));<br>&#125;<br> <br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">EventLabel::mouseReleaseEvent</span><span class="hljs-params">(QMouseEvent *event)</span></span><br><span class="hljs-function"></span>&#123;<br>    QString msg;<br>    msg.<span class="hljs-built_in">sprintf</span>(<span class="hljs-string">&quot;&lt;center&gt;&lt;h1&gt;Release: (%d, %d)&lt;/h1&gt;&lt;/center&gt;&quot;</span>,<br>                event-&gt;x(), event-&gt;y());<br>    <span class="hljs-keyword">this</span>-&gt;setText(msg);<br>&#125;<br> <br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-function">QApplication <span class="hljs-title">a</span><span class="hljs-params">(argc, argv)</span></span>;<br> <br>    EventLabel *label = <span class="hljs-keyword">new</span> EventLabel;<br>    label-&gt;setWindowTitle(<span class="hljs-string">&quot;MouseEvent Demo&quot;</span>);<br>    label-&gt;resize(<span class="hljs-number">300</span>, <span class="hljs-number">200</span>);<br>    label-&gt;show();<br> <br>    <span class="hljs-keyword">return</span> a.exec();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>EventLabel继承了QLabel，重写了mousePressEvent()、mouseMoveEvent()和MouseReleaseEvent()三个函数。在鼠标按下（press）、鼠标移动（move）和鼠标释放（release）的时候，把当前鼠标的坐标值显示在这个Label上面。</p>
<p>运行上面的代码，当我们点击了一下鼠标之后，label 上将显示鼠标当前坐标值。</p>
<p>为什么要点击鼠标之后才能在mouseMoveEvent()函数中显示鼠标坐标值？</p>
<p><strong>这是因为QWidget中有一个mouseTracking属性，该属性用于设置是否追踪鼠标。只有鼠标被追踪时，mouseMoveEvent()才会发出。如果mouseTracking是 false（默认即是），组件在至少一次鼠标点击之后，才能够被追踪，也就是能够发出mouseMoveEvent()事件。如果mouseTracking为 true，则mouseMoveEvent()直接可以被发出。</strong></p>
<p>在构造函数里面设置label-&gt;setMouseTracking(true);即可</p>
<h3 id="event"><a href="#event" class="headerlink" title="event()"></a>event()</h3><p><strong>event()函数主要用于事件的分发</strong></p>
<p>例如，我们希望在一个QWidget组件中监听 tab 键的按下，那么就可以继承QWidget，并重写它的event()函数，来达到这个目的：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">CustomWidget::event</span><span class="hljs-params">(QEvent *e)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (e-&gt;type() == QEvent::KeyPress) &#123;<br>        QKeyEvent *keyEvent = <span class="hljs-keyword">static_cast</span>&lt;QKeyEvent *&gt;(e);<br>        <span class="hljs-keyword">if</span> (keyEvent-&gt;key() == Qt::Key_Tab) &#123;<br>            qDebug() &lt;&lt; <span class="hljs-string">&quot;You press tab.&quot;</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> QWidget::event(e);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>CustomWidget是一个普通的QWidget子类。我们重写了它的event()函数，这个函数有一个QEvent对象作为参数，也就是需要转发的事件对象。函数返回值是 bool 类型:</p>
<ul>
<li> <strong>如果传入的事件已被识别并且处理，则需要返回 true，否则返回 false。如果返回值是 true，那么 Qt 会认为这个事件已经处理完毕，不会再将这个事件发送给其它对象，而是会继续处理事件队列中的下一事件</strong></li>
<li> <strong>在event()函数中，调用事件对象的accept()和ignore()函数是没有作用的，不会影响到事件的传播</strong></li>
</ul>
<p><strong>event()函数中实际是通过事件处理器来响应一个具体的事件。这相当于event()函数将具体事件的处理“委托”给具体的事件处理器。而这些事件处理器是 protected virtual 的，因此，我们重写了某一个事件处理器，即可让 Qt 调用我们自己实现的版本</strong></p>
<h3 id="事件过滤器"><a href="#事件过滤器" class="headerlink" title="事件过滤器"></a>事件过滤器</h3><p>有时候，对象需要查看、甚至要拦截发送到另外对象的事件。</p>
<p>QObject有一个eventFilter()函数，用于建立事件过滤器。函数原型如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">QObject::eventFilter</span> <span class="hljs-params">( QObject * watched, QEvent * event )</span></span>;<br></code></pre></td></tr></table></figure>

<p>这个函数返回一个 bool 类型，如果你想将参数 event 过滤出来，比如，<strong>不想让它继续转发，就返回 true，否则返回 false。</strong>事件过滤器的调用时间是目标对象（也就是参数里面的watched对象）接收到事件对象之前。也就是说，如果你在事件过滤器中停止了某个事件，那么，watched对象以及以后所有的事件过滤器根本不会知道这么一个事件。</p>
<p>上面QWidget组件中event()函数监听 tab 键的按下修改为使用<strong>事件过滤器的版本</strong>：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">FilterObject::eventFilter</span><span class="hljs-params">(QObject *object, QEvent *event)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (object == target &amp;&amp; event-&gt;type() == QEvent::KeyPress) <br>&#123;<br>        QKeyEvent *keyEvent = <span class="hljs-keyword">static_cast</span>&lt;QKeyEvent *&gt;(event);<br>        <span class="hljs-keyword">if</span> (keyEvent-&gt;key() == Qt::Key_Tab) &#123;<br>            qDebug() &lt;&lt; <span class="hljs-string">&quot;You press tab.&quot;</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><font color = red size = 4><strong>注意:事件过滤器和被安装过滤器的组件必须在同一线程，否则，过滤器将不起作用。另外，如果在安装过滤器之后，这两个组件到了不同的线程，那么，只有等到二者重新回到同一线程的时候过滤器才会有效。</strong></font></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><strong>Qt</strong> <strong>的事件处理，实际上是有五个层次：</strong></p>
<ol>
<li>重写paintEvent()、mousePressEvent()等事件处理函数。这是最普通、最简单的形式，同时功能也最简单。</li>
<li>重写event()函数。event()函数是所有对象的事件入口，QObject和QWidget中的实现，默认是把事件传递给特定的事件处理函数。</li>
<li>重写event()函数。event()函数是所有对象的事件入口，QObject和QWidget中的实现，默认是把事件传递给特定的事件处理函数。</li>
<li>在QCoreApplication::instance()上面安装事件过滤器。该过滤器将过滤所有对象的所有事件，因此和notify()函数一样强大，但是它更灵活，因为可以安装多个过滤器。全局的事件过滤器可以看到 disabled 组件上面发出的鼠标事件。全局过滤器有一个问题：只能用在主线程。</li>
<li>重写QCoreApplication::notify()函数。这是最强大的，和全局事件过滤器一样提供完全控制，并且不受线程的限制。但是全局范围内只能有一个被使用（因为QCoreApplication是单例的）。</li>
</ol>
<h2 id="六、绘图和绘图设备"><a href="#六、绘图和绘图设备" class="headerlink" title="六、绘图和绘图设备"></a>六、绘图和绘图设备</h2><h3 id="QPainter"><a href="#QPainter" class="headerlink" title="QPainter"></a>QPainter</h3><p><strong>QPainter</strong>用来执行绘制的操作；<strong>QPaintDevice</strong>是一个二维空间的抽象，<strong>QPaintEngine</strong>提供了画笔（QPainter）在不同的设备上进行绘制的统一的接口</p>
<p><img src="https://img-blog.csdnimg.cn/20201029110808861.png#pic_center" alt="在这里插入图片描述"></p>
<p>上面的示意图告诉我们，<font color = red size = 4><strong>Qt 的绘图系统实际上是，使用QPainter在QPainterDevice上进行绘制，它们之间使用QPaintEngine进行通讯（也就是翻译QPainter的指令）。</strong></font></p>
<p>下面我们通过一个实例来介绍QPainter的使用：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PaintedWidget</span> :</span> <span class="hljs-keyword">public</span> QWidget<br>&#123;<br>    Q_OBJECT<br><span class="hljs-keyword">public</span>:<br>    PaintedWidget(QWidget *parent = <span class="hljs-number">0</span>);<br><span class="hljs-keyword">protected</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">paintEvent</span><span class="hljs-params">(QPaintEvent *)</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>注意我们重写了QWidget的paintEvent()函数。接下来就是PaintedWidget的源代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c++">PaintedWidget::PaintedWidget(QWidget *parent) :<br>    QWidget(parent)<br>&#123;<br>    resize(<span class="hljs-number">800</span>, <span class="hljs-number">600</span>);<br>    setWindowTitle(tr(<span class="hljs-string">&quot;Paint Demo&quot;</span>));<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">PaintedWidget::paintEvent</span><span class="hljs-params">(QPaintEvent *)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-function">QPainter <span class="hljs-title">painter</span><span class="hljs-params">(<span class="hljs-keyword">this</span>)</span></span>;<br>    painter.drawLine(<span class="hljs-number">80</span>, <span class="hljs-number">100</span>, <span class="hljs-number">650</span>, <span class="hljs-number">500</span>);<br>    painter.setPen(Qt::red);<br>    painter.drawRect(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">100</span>, <span class="hljs-number">400</span>);<br>    painter.setPen(QPen(Qt::green, <span class="hljs-number">5</span>));<br>    painter.setBrush(Qt::blue);<br>    painter.drawEllipse(<span class="hljs-number">50</span>, <span class="hljs-number">150</span>, <span class="hljs-number">400</span>, <span class="hljs-number">200</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>构造函数中，我们仅仅设置了窗口的大小和标题。而paintEvent()函数则是绘制的代码。</p>
<h3 id="绘图设备"><a href="#绘图设备" class="headerlink" title="绘图设备"></a>绘图设备</h3><p><strong>绘图设备是指继承QPainterDevice的子类。</strong></p>
<p>QBitmap是QPixmap的一个子类，它的色深限定为1，可以使用 QPixmap的isQBitmap()函数来确定这个QPixmap是不是一个QBitmap。</p>
<p>QPixmap：和平台无关，针对屏幕进行了优化了，不能对图片进行修改</p>
<p>QImage：和平台无关，在线程中绘图，可以对图片进行优化</p>
<p>QPicture：保存绘图的状态（二进制文件）</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-number">1</span>、QPixmap -&gt; QImage<br><br>QPixmap a；<br><br>a.toImage();<br><br><span class="hljs-number">2</span>、QImage -&gt; QPixmap<br><br>QImage b;<br><br>QPixmap::fromImage(b);<br><br><span class="hljs-number">3</span>、QPainter<br><br>QPainter p;<br><br>QPicture pic;<br><br>p.begin(&amp;pic);<br><br><span class="hljs-comment">//绘图动作</span><br><br>p.end();<br><br>pic.save(<span class="hljs-string">&quot;路径&quot;</span>);<br><br><span class="hljs-number">4</span>、加载图片<br><br>QPicture temp;<br><br>temp.load(<span class="hljs-string">&quot;路径&quot;</span>);<br></code></pre></td></tr></table></figure>



<h3 id="不规则窗口"><a href="#不规则窗口" class="headerlink" title="不规则窗口"></a>不规则窗口</h3><p>1、给窗口画一张背景图</p>
<p>2、去表框</p>
<p>3、设定属性（背景透明）</p>
<p>4、移动坐标是<strong>相对于屏幕</strong>而言</p>
<h2 id="七、文件系统"><a href="#七、文件系统" class="headerlink" title="七、文件系统"></a>七、文件系统</h2><p> I/O 设备的类图（Qt5）：</p>
<p><img src="https://img-blog.csdnimg.cn/20201029110820891.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<ul>
<li>QIODevice：所有 I/O 设备类的父类，提供了字节块读写的通用操作以及基本接口；</li>
<li>QFileDevice：Qt5新增加的类，提供了有关文件操作的通用实现。</li>
<li>QFlie：访问本地文件或者嵌入资源；</li>
<li>QTemporaryFile：创建和访问本地文件系统的临时文件；</li>
<li>QBuffer：读写QbyteArray, 内存文件；</li>
<li>QProcess：运行外部程序，处理进程间通讯；</li>
<li>QAbstractSocket：所有套接字类的父类；</li>
<li>QTcpSocket：TCP协议网络数据传输；</li>
<li>QUdpSocket：传输 UDP 报文；</li>
<li>QSslSocket：使用 SSL/TLS 传输数据；</li>
</ul>
<p><strong>QFile提供了从文件中读取和写入数据的能力。</strong></p>
<p><strong>我们通常会将文件路径作为参数传给QFile的构造函数。不过也可以在创建好对象最后，使用setFileName()来修改</strong></p>
<p><strong>我们可以使用QDataStream或QTextStream类来读写文件，也可以使用QIODevice类提供的read()、readLine()、readAll()以及write()这样的函数。</strong>值得注意的是，<strong>有关文件本身的信息，比如文件名、文件所在目录的名字等，则是通过QFileInfo获取</strong>。</p>
<p>QFileInfo有很多类型的函数，举一些常用例子。比如：</p>
<ul>
<li>isDir()检查该文件是否是目录；</li>
<li>isExecutable()  检查该文件是否是可执行文件等。</li>
<li>baseName()  可以直接获得文件名；</li>
<li>completeBaseName()  获取完整的文件名</li>
<li>suffix()  则直接获取文件后缀名。</li>
<li>completeSuffix()  获取完整的文件后缀</li>
</ul>
<h3 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-number">1</span>、QFile file;<br><br>file.setFileName();<br><br>file.open();<br><br>file.write();<br><br>file.read();<br><br>file.close();<br><br><span class="hljs-number">2</span>、QFileInfo info;<br><br>info.size();<br><br>info.fileName();<br><br><br><br>QDataStream：二进制方式<br><br>QTextStream：文本方式（指定编码）<br><br>QBuffer：内存文件（内容放在内存）<br></code></pre></td></tr></table></figure>

<h2 id="八、Socket通信"><a href="#八、Socket通信" class="headerlink" title="八、Socket通信"></a>八、Socket通信</h2><p>Qt中提供的所有的Socket类都是非阻塞的。</p>
<p>Qt中常用的用于socket通信的套接字类:</p>
<ul>
<li><p>QTcpServer 用于TCP通信, 作为服务器端套接字使用</p>
</li>
<li><p>QTcpSocket 用于TCP通信，作为客户端套接字使用。</p>
</li>
<li><p>QUdpSocket 用于UDP通信，服务器，客户端均使用此套接字。</p>
</li>
</ul>
<h3 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h3><p>在Qt中实现TCP服务器端通信的流程:</p>
<ol>
<li><p>创建套接字</p>
</li>
<li><p>将套接字设置为监听模式</p>
</li>
<li><p>等待并接受客户端请求</p>
<p> 可以通过QTcpServer提供的void <strong>newConnection()**</strong>信号*<em>来检测是否有连接请求，如果有可以在对应的槽函数中调用nextPendingConnection函数获取到客户端的Socket信息（返回值为QTcpSocket</em>类型指针），通过此套接字与客户端之间进行通信。</p>
</li>
<li><p>接收或者向客户端发送数据</p>
<p>接收数据：使用read（）或者readAll（）函数</p>
<p>发送数据：使用write（）函数</p>
</li>
</ol>
<p>在Qt中实现TCP/IP客户端通信的流程:</p>
<ol>
<li><p>创建套接字</p>
</li>
<li><p>连接服务器</p>
<p> 可以使用QTcpSocket类的<strong>connectToHost（）</strong>函数来连接服务器。</p>
</li>
<li><p>向服务器发送或者接受数据</p>
</li>
</ol>
<p>下面例子为简单的TCP/IP通信的实现例子:</p>
<h4 id="TCP服务端"><a href="#TCP服务端" class="headerlink" title="TCP服务端"></a>TCP服务端</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//---------- tcpserver.h ------------</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TCPServer</span> :</span> <span class="hljs-keyword">public</span> QMainWindow<br>&#123;<br>    Q_OBJECT<br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">TCPServer</span><span class="hljs-params">(QWidget *parent = <span class="hljs-number">0</span>)</span></span>;<br>    ~TCPServer();<br><br><span class="hljs-keyword">public</span> slots:<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">slotNewConnection</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">slotReadyRead</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-keyword">private</span>:<br>    Ui::TCPServer *ui;<br>    <span class="hljs-comment">// 负责监听的套接字</span><br>    QTcpServer* m_server;<br>    <span class="hljs-comment">// 负责通信的套接字</span><br>    QTcpSocket* m_client;<br>&#125;;<br><br><span class="hljs-comment">//---------- tcpserver.cpp ------------</span><br>TCPServer::TCPServer(QWidget *parent) :<br>    QMainWindow(parent),<br>    ui(<span class="hljs-keyword">new</span> Ui::TCPServer),<br>    m_server(<span class="hljs-literal">NULL</span>),<br>    m_client(<span class="hljs-literal">NULL</span>)<br>&#123;<br>    ui-&gt;setupUi(<span class="hljs-keyword">this</span>);<br><br>    <span class="hljs-comment">//创建套接字对象</span><br>    m_server = <span class="hljs-keyword">new</span> QTcpServer(<span class="hljs-keyword">this</span>);<br>    <span class="hljs-comment">//将套接字设置为监听模式</span><br>    m_server-&gt;listen(QHostAddress::Any, <span class="hljs-number">9999</span>);<br><br>    <span class="hljs-comment">//通过信号接收客户端请求</span><br>    connect(m_server, &amp;QTcpServer::newConnection, <br><span class="hljs-keyword">this</span>, &amp;TCPServer::slotNewConnection);<br>&#125;<br><br>TCPServer::~TCPServer()<br>&#123;<br>    <span class="hljs-keyword">delete</span> ui;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">TCPServer::slotNewConnection</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(m_client == <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        <span class="hljs-comment">//处理客户端的连接请求</span><br>        m_client = m_server-&gt;nextPendingConnection();<br>        <span class="hljs-comment">//发送数据</span><br>        m_client-&gt;write(<span class="hljs-string">&quot;服务器连接成功!!!&quot;</span>);<br>        <span class="hljs-comment">//连接信号, 接收客户端数据</span><br>        connect(m_client, &amp;QTcpSocket::readyRead, <br><span class="hljs-keyword">this</span>, &amp;TCPServer::slotReadyRead);<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">TCPServer::slotReadyRead</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">//接收数据</span><br>    QByteArray <span class="hljs-built_in">array</span> = m_client-&gt;readAll();<br>    QMessageBox::information(<span class="hljs-keyword">this</span>, <span class="hljs-string">&quot;Client Message&quot;</span>, <span class="hljs-built_in">array</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="TCP客户端"><a href="#TCP客户端" class="headerlink" title="TCP客户端"></a>TCP客户端</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//------------- tcpclient.h ------------</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TCPClient</span> :</span> <span class="hljs-keyword">public</span> QMainWindow<br>&#123;<br>    Q_OBJECT<br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">TCPClient</span><span class="hljs-params">(QWidget *parent = <span class="hljs-number">0</span>)</span></span>;<br>    ~TCPClient();<br><br><span class="hljs-keyword">public</span> slots:<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">slotReadyRead</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">slotSendMsg</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-keyword">private</span>:<br>    Ui::TCPClient *ui;<br>    QTcpSocket* m_client;<br>&#125;;<br><br><span class="hljs-comment">//------------- tcpclient.cpp --------------</span><br>TCPClient::TCPClient(QWidget *parent) :<br>    QMainWindow(parent),<br>    ui(<span class="hljs-keyword">new</span> Ui::TCPClient)<br>&#123;<br>    ui-&gt;setupUi(<span class="hljs-keyword">this</span>);<br>    <span class="hljs-comment">//创建套接字</span><br>    m_client = <span class="hljs-keyword">new</span> QTcpSocket(<span class="hljs-keyword">this</span>);<br>    <span class="hljs-comment">//连接服务器</span><br>    m_client-&gt;connectToHost(QHostAddress(<span class="hljs-string">&quot;127.0.0.1&quot;</span>), <span class="hljs-number">9999</span>);<br><br>    <span class="hljs-comment">//通过信号接收服务器数据</span><br>    connect(m_client, &amp;QTcpSocket::readyRead, <br><span class="hljs-keyword">this</span>, &amp;TCPClient::slotReadyRead);<br>    <span class="hljs-comment">//发送按钮</span><br>    connect(ui-&gt;btnSend, &amp;QPushButton::clicked, <br><span class="hljs-keyword">this</span>, &amp;TCPClient::slotSendMsg);<br>&#125;<br><br>TCPClient::~TCPClient()<br>&#123;<br>    <span class="hljs-keyword">delete</span> ui;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">TCPClient::slotReadyRead</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>	 <span class="hljs-comment">//接收数据</span><br>    QByteArray <span class="hljs-built_in">array</span> = m_client-&gt;readAll();<br>    QMessageBox::information(<span class="hljs-keyword">this</span>, <span class="hljs-string">&quot;Server Message&quot;</span>, <span class="hljs-built_in">array</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">TCPClient::slotSendMsg</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    QString text = ui-&gt;textEdit-&gt;toPlainText();<br>	 <span class="hljs-comment">//发送数据</span><br>    m_client-&gt;write(text.toUtf8());<br>    ui-&gt;textEdit-&gt;clear();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h3><p><strong>在UDP方式下，客户端并不与服务器建立连接，它只负责调用发送函数向服务器发送数据</strong>。类似的<strong>服务器也不从客户端接收连接，只负责调用接收函数，等待来自客户端的数据的到达</strong>。</p>
<p>在UDP通信中，服务器端和客户端的概念已经显得有些淡化，两部分做的工作都大致相同：</p>
<ol>
<li><p> 创建套接字</p>
</li>
<li><p>绑定套接字</p>
<p> 在UDP中如果需要<strong>接收数据</strong>则<strong>需要对套接字进行绑定</strong>，只发送数据则不需要对套接字进行绑定。</p>
<p> 通过调用bind（）函数将套接字绑定到指定端口上。</p>
</li>
<li><p>接收或者发送数据</p>
</li>
</ol>
<ul>
<li>接收数据：使用readDatagram()接收数据,函数声明如下:</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">qint64 <span class="hljs-title">readDatagram</span><span class="hljs-params">(<span class="hljs-keyword">char</span> * data, qint64 maxSize, QHostAddress * address = <span class="hljs-number">0</span>, quint16 * port = <span class="hljs-number">0</span>)</span></span><br></code></pre></td></tr></table></figure>

<p>​    参数:</p>
<p> data: 接收数据的缓存地址</p>
<p> maxSize: 缓存接收的最大字节数</p>
<p> address: 数据发送方的地址（一般使用提供的默认值）</p>
<p> port: 数据发送方的端口号（一般使用提供的默认值）</p>
<p>使用<strong>pendingDatagramSize()可以获取到将要接收的数据的大小</strong>，根据该函数返回值来准备对应大小的内存空间存放将要接收的数据。</p>
<ul>
<li>发送数据: 使用writeDatagram()函数发送数据，函数声明如下：</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">qint64 <span class="hljs-title">writeDatagram</span><span class="hljs-params">(<span class="hljs-keyword">const</span> QByteArray &amp; datagram, <span class="hljs-keyword">const</span> QHostAddress &amp; host, quint16 port)</span></span><br></code></pre></td></tr></table></figure>

<p>​    参数：</p>
<p> datagram：要发送的字符串</p>
<p> host：数据接收方的地址</p>
<p> port：数据接收方的端口号</p>
<h4 id="广播"><a href="#广播" class="headerlink" title="广播"></a>广播</h4><p>在使用QUdpSocket类的writeDatagram()函数发送数据的时候，其中第二个参数host应该指定为广播地址：QHostAddress：：Broadcast此设置相当于QHostAddress(“255.255.255.255”)</p>
<p>使用UDP广播的的特点：</p>
<ul>
<li><p>使用UDP进行广播，局域网内的其他的UDP用户全部可以收到广播的消息</p>
</li>
<li><p>UDP广播只能在局域网范围内使用</p>
</li>
</ul>
<h4 id="组播"><a href="#组播" class="headerlink" title="组播"></a>组播</h4><p>在使用QUdpSocket类的writeDatagram()函数发送数据的时候，其中第二个参数host应该指定为组播地址，关于组播地址的分类：</p>
<ul>
<li><p>224.0.0.0～224.0.0.255为预留的组播地址（永久组地址），地址224.0.0.0保留不做分配，其它地址供路由协议使用；</p>
</li>
<li><p>224.0.1.0～224.0.1.255是公用组播地址，可以用于Internet；</p>
</li>
<li><p>224.0.2.0～238.255.255.255为用户可用的组播地址（临时组地址），全网范围内有效；</p>
</li>
<li><p>239.0.0.0～239.255.255.255为本地管理组播地址，仅在特定的本地范围内有效。</p>
</li>
</ul>
<p>注册加入到组播地址需要使用QUdpSocket类的成员函数：</p>
<p>bool  joinMulticastGroup(const QHostAddress &amp; groupAddress)</p>
<h3 id="TCP-和-UDP的区别"><a href="#TCP-和-UDP的区别" class="headerlink" title="TCP 和 UDP的区别"></a>TCP 和 UDP的区别</h3><table>
<thead>
<tr>
<th></th>
<th><strong>TCP</strong></th>
<th align="center"><strong>UDP</strong></th>
</tr>
</thead>
<tbody><tr>
<td>是否连接</td>
<td>面向连接</td>
<td align="center">无连接</td>
</tr>
<tr>
<td>传输方式</td>
<td>基于流</td>
<td align="center">基于数据报</td>
</tr>
<tr>
<td>传输可靠性</td>
<td>可靠</td>
<td align="center">不可靠</td>
</tr>
<tr>
<td>传输效率</td>
<td>效率低</td>
<td align="center">效率高</td>
</tr>
<tr>
<td>能否广播</td>
<td>不能</td>
<td align="center">能</td>
</tr>
</tbody></table>
<h2 id="九、多线程的使用"><a href="#九、多线程的使用" class="headerlink" title="九、多线程的使用"></a>九、多线程的使用</h2><p><strong>在次线程中处理的业务放在独立的模块（类）中，由主线程创建完该对象后，将其移交给指定的线程，且可以将多个类似的对象移交给同一个线程。</strong></p>
<p>例子中，信号由主线程的QTimer对象发出，之后Qt会将关联的事件放到worker所属线程的事件队列。由于队列连接的作用，在不同线程间连接信号和槽是很安全的。</p>
<p>示例代码如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Worker</span> :</span> <span class="hljs-keyword">public</span> QObject<br>&#123;<br>    Q_OBJECT<br><span class="hljs-keyword">private</span> slots:<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onTimeout</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        qDebug()&lt;&lt;<span class="hljs-string">&quot;Worker::onTimeout get called from?: &quot;</span><br>&lt;&lt;QThread::currentThreadId();<br>    &#125;<br>&#125;;<br>    <br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-function">QApplication <span class="hljs-title">a</span><span class="hljs-params">(argc, argv)</span></span>;<br>    qDebug()&lt;&lt;<span class="hljs-string">&quot;From main thread: &quot;</span>&lt;&lt;QThread::currentThreadId();<br>  <br>    QThread t;<br>    QTimer timer;<br>    Worker worker;<br>  <br>    QObject::connect(&amp;timer, SIGNAL(timeout()), <br>&amp;worker, SLOT(onTimeout()));<br>		 <span class="hljs-comment">// 启动定时器</span><br>    timer.start(<span class="hljs-number">1000</span>);<br>  	 <span class="hljs-comment">// 将类对象移交个线程</span><br>    worker.moveToThread(&amp;t);<br>    <span class="hljs-comment">// 启动线程</span><br>    t.start();<br>  <br>    <span class="hljs-keyword">return</span> a.exec();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>关于Qobject类的connect函数最后一个参数，连接类型：</p>
<ul>
<li><p>自动连接(AutoConnection)，默认的连接方式。</p>
<p>如果信号与槽，也就是发送者与接受者在同一线程，等同于直接连接；</p>
<p>如果发送者与接受者处在不同线程，等同于队列连接。</p>
</li>
<li><p>直接连接(DirectConnection)</p>
</li>
</ul>
<p>当信号发射时，槽函数立即直接调用。<strong>无论槽函数所属对象在哪个线程，槽函数总在发送者所在线程执行。</strong></p>
<ul>
<li>队列连接(QueuedConnection)</li>
</ul>
<p>当控制权回到接受者所在线程的事件循环时，槽函数被调用。<strong>槽函数在接受者所在线程执行。</strong></p>
<p><strong>总结：</strong></p>
<p>* <strong>队列连接：槽函数在接受者所在线程执行</strong>。</p>
<p>* <strong>直接连接：槽函数在发送者所在线程执行</strong>。</p>
<p>*<strong>自动连接：二者不在同一线程时，等同于队列连接</strong></p>
<p><strong>多线程使用过程中注意事项：</strong></p>
<ul>
<li><p><strong>线程不能操作UI对象（从Qwidget直接或间接派生的窗口对象）</strong></p>
</li>
<li><p><strong>需要移动到子线程中处理的模块类，创建的对象的时候不能指定父对象。</strong></p>
</li>
</ul>
<h2 id="十、Qt数据库操作"><a href="#十、Qt数据库操作" class="headerlink" title="十、Qt数据库操作"></a>十、Qt数据库操作</h2><h3 id="一、操作数据库"><a href="#一、操作数据库" class="headerlink" title="一、操作数据库"></a>一、操作数据库</h3><p><strong>Qt 提供了 QtSql 模块来提供平台独立的基于 SQL 的数据库操作。</strong></p>
<p><strong>Qt 使用QSqlDatabase表示一个数据库连接。</strong></p>
<p>可以通过：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//打印Qt支持的数据库驱动</span><br>qDebug() &lt;&lt; QSqlDatabase::drivers();<br></code></pre></td></tr></table></figure>

<p>找到系统中所有可用的数据库驱动的名字列表。</p>
<p>封装一个连接数据库的函数：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">connect</span><span class="hljs-params">(<span class="hljs-keyword">const</span> QString &amp;dbName)</span></span><br><span class="hljs-function"></span>&#123;<br>    QSqlDatabase db = QSqlDatabase::addDatabase(<span class="hljs-string">&quot;QSQLITE&quot;</span>);<br><span class="hljs-comment">//    db.setHostName(&quot;host&quot;);</span><br><span class="hljs-comment">//    db.setDatabaseName(&quot;dbname&quot;);</span><br><span class="hljs-comment">//    db.setUserName(&quot;username&quot;);</span><br><span class="hljs-comment">//    db.setPassword(&quot;password&quot;);</span><br>    db.setDatabaseName(dbName);<br>    <span class="hljs-keyword">if</span> (!db.open()) &#123;<br>        QMessageBox::critical(<span class="hljs-number">0</span>, QObject::tr(<span class="hljs-string">&quot;Database Error&quot;</span>),<br>                              db.lastError().text());<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>创建数据库表student后，插入数据，然后将其独取出来：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">if</span> (connect(<span class="hljs-string">&quot;demo.db&quot;</span>)) <br>&#123;<br>    QSqlQuery query;<br>    query.prepare(<span class="hljs-string">&quot;INSERT INTO student (name, age) VALUES (?, ?)&quot;</span>);<br>    QVariantList names;<br>    names &lt;&lt; <span class="hljs-string">&quot;Tom&quot;</span> &lt;&lt; <span class="hljs-string">&quot;Jack&quot;</span> &lt;&lt; <span class="hljs-string">&quot;Jane&quot;</span> &lt;&lt; <span class="hljs-string">&quot;Jerry&quot;</span>;<br>    query.addBindValue(names);<br>    QVariantList ages;<br>    ages &lt;&lt; <span class="hljs-number">20</span> &lt;&lt; <span class="hljs-number">23</span> &lt;&lt; <span class="hljs-number">22</span> &lt;&lt; <span class="hljs-number">25</span>;<br>    query.addBindValue(ages);<br>    <span class="hljs-keyword">if</span> (!query.execBatch()) &#123;<br>        QMessageBox::critical(<span class="hljs-number">0</span>, QObject::tr(<span class="hljs-string">&quot;Database Error&quot;</span>),<br>                              query.lastError().text());<br>    &#125;<br> <br>    query.exec(<span class="hljs-string">&quot;SELECT name, age FROM student&quot;</span>);<br>    <span class="hljs-keyword">while</span> (query.next()) &#123;<br>        QString name = query.value(<span class="hljs-number">0</span>).toString();<br>        <span class="hljs-keyword">int</span> age = query.value(<span class="hljs-number">1</span>).toInt();<br>        qDebug() &lt;&lt; name &lt;&lt; <span class="hljs-string">&quot;: &quot;</span> &lt;&lt; age;<br>    &#125;<br>&#125; <br><span class="hljs-keyword">else</span> <br>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>插入多条数据，此时可以使用QSqlQuery::exec()函数一条一条插入数据，但是这里我们选择了另外一种方法：批量执行。首先，我们使用<strong>QSqlQuery::prepare()函数对这条 SQL 语句进行预处理，问号 ? 相当于占位符，预示着以后我们可以使用实际数据替换这些位置。</strong></p>
<p>在上面的代码中，我们使用一个字符串列表 names 替换掉第一个问号的位置，一个整型列表 ages 替换掉第二个问号的位置，利用<strong>QSqlQuery::addBindValue()我们将实际数据绑定到这个预处理的 SQL 语句上</strong>。需要注意的是，names 和 ages 这两个列表里面的数据需要一一对应。然后我们调用<strong>QSqlQuery::execBatch()批量执行 SQL，之后结束该对象。</strong>这样，插入操作便完成了。</p>
<h3 id="二、使用模型操作数据库"><a href="#二、使用模型操作数据库" class="headerlink" title="二、使用模型操作数据库"></a>二、使用模型操作数据库</h3><p><strong>基于QSqlTableModel 的模型处理更为高级，如果对 SQL 语句不熟悉，并且不需要很多复杂的查询，这种QSqlTableModel模型基本可以满足一般的需求。</strong></p>
<h4 id="1、查询操作"><a href="#1、查询操作" class="headerlink" title="1、查询操作"></a>1、查询操作</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">if</span> (connect(<span class="hljs-string">&quot;demo.db&quot;</span>)) <br>&#123;<br>    QSqlTableModel model;<br>    model.setTable(<span class="hljs-string">&quot;student&quot;</span>);<br>    model.setFilter(<span class="hljs-string">&quot;age &gt; 20 and age &lt; 25&quot;</span>);<br>    <span class="hljs-keyword">if</span> (model.select()) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; model.rowCount(); ++i) &#123;<br>            QSqlRecord record = model.record(i);<br>            QString name = record.value(<span class="hljs-string">&quot;name&quot;</span>).toString();<br>            <span class="hljs-keyword">int</span> age = record.value(<span class="hljs-string">&quot;age&quot;</span>).toInt();<br>            qDebug() &lt;&lt; name &lt;&lt; <span class="hljs-string">&quot;: &quot;</span> &lt;&lt; age;<br>        &#125;<br>    &#125;<br>&#125; <br><span class="hljs-keyword">else</span> <br>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><p>setTable()函数设置所需要操作的表格；</p>
</li>
<li><p>setFilter()函数则是添加过滤器，也就是 WHERE 语句所需要的部分。</p>
<p>  例如上面代码中的操作实际相当于 SQL 语句:</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++">SELECT * FROM student WHERE age &gt; <span class="hljs-number">20</span> <span class="hljs-keyword">and</span> age &lt; <span class="hljs-number">25</span><br></code></pre></td></tr></table></figure>

</li>
</ul>
<p><strong>注意：我们使用QSqlTableModel只能进行 SELECT * 的查询，不能只查询其中某些列的数据。</strong></p>
<h4 id="2、插入操作"><a href="#2、插入操作" class="headerlink" title="2、插入操作"></a>2、插入操作</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++">QSqlTableModel model;<br>model.setTable(<span class="hljs-string">&quot;student&quot;</span>);<br><span class="hljs-keyword">int</span> row = <span class="hljs-number">0</span>;<br>model.insertRows(row, <span class="hljs-number">1</span>);<br>model.setData(model.index(row, <span class="hljs-number">1</span>), <span class="hljs-string">&quot;Cheng&quot;</span>);<br>model.setData(model.index(row, <span class="hljs-number">2</span>), <span class="hljs-number">24</span>);<br>model.submitAll();<br></code></pre></td></tr></table></figure>

<p>model.insertRows(row, 1);说明我们想在索引 0 的位置插入 1 行新的数据。使用<strong>setData()函数则开始准备实际需要插入的数据</strong>。最后，调用<strong>submitAll()函数提交所有修改</strong>。</p>
<p>例如上面代码中的操作实际相当于 SQL 语句:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++">INSERT INTO student (name, age) VALUES (&#x27;Cheng&#x27;, 24)<br></code></pre></td></tr></table></figure>

<h4 id="3、更新操作"><a href="#3、更新操作" class="headerlink" title="3、更新操作"></a>3、更新操作</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++">QSqlTableModel model;<br>model.setTable(<span class="hljs-string">&quot;student&quot;</span>);<br>model.setFilter(<span class="hljs-string">&quot;age = 25&quot;</span>);<br><span class="hljs-keyword">if</span> (model.select()) &#123;<br>    <span class="hljs-keyword">if</span> (model.rowCount() == <span class="hljs-number">1</span>) &#123;<br>        QSqlRecord record = model.record(<span class="hljs-number">0</span>);<br>        record.setValue(<span class="hljs-string">&quot;age&quot;</span>, <span class="hljs-number">26</span>);<br>        model.setRecord(<span class="hljs-number">0</span>, record);<br>        model.submitAll();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>找到 age = 25 的记录，然后将 age 重新设置为 26，存入相同的位置（在这里都是索引 0 的位置），提交之后完成一次更新</p>
<p>例如上面代码中的操作实际相当于 SQL 语句:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++">UPDATE student SET age = <span class="hljs-number">26</span> WHERE age = <span class="hljs-number">25</span><br></code></pre></td></tr></table></figure>

<h4 id="4、删除操作"><a href="#4、删除操作" class="headerlink" title="4、删除操作"></a>4、删除操作</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c++">QSqlTableModel model;<br>model.setTable(<span class="hljs-string">&quot;student&quot;</span>);<br>model.setFilter(<span class="hljs-string">&quot;age = 25&quot;</span>);<br><span class="hljs-keyword">if</span> (model.select()) &#123;<br>    <span class="hljs-keyword">if</span> (model.rowCount() == <span class="hljs-number">1</span>) &#123;<br>        model.removeRows(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>);<br>        model.submitAll();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>removeRows()函数可以一次删除多行。</p>
<p>例如上面代码中的操作实际相当于 SQL 语句:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++">DELETE FROM student WHERE age = <span class="hljs-number">25</span><br></code></pre></td></tr></table></figure>



<p>如果你觉得文章还不错，记得”<strong>点赞关注</strong>“</p>
<p>关注我的微信公众号【 <strong>加班猿</strong> 】可以获取更多内容</p>
<p><img src="https://img-blog.csdnimg.cn/20201028200900702.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/10/28/Qt%E7%AC%94%E8%AE%B0%E6%80%BB%E7%BB%93/" data-id="ckhvya4zz0014bglr9bonbq9a" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%80%BB%E7%BB%93/" rel="tag">总结</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-LCD1602单片机驱动程序(STC51STM32)详解" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/20/LCD1602%E5%8D%95%E7%89%87%E6%9C%BA%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F(STC51STM32)%E8%AF%A6%E8%A7%A3/" class="article-date">
  <time datetime="2020-10-19T16:00:00.000Z" itemprop="datePublished">2020-10-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%8D%95%E7%89%87%E6%9C%BA/">单片机</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/20/LCD1602%E5%8D%95%E7%89%87%E6%9C%BA%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F(STC51STM32)%E8%AF%A6%E8%A7%A3/">LCD1602单片机(STC51/STM32)驱动程序详解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://img-blog.csdnimg.cn/20201017112100801.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<div align = 'right'>作者：hackett</div>

<div align = 'right'>微信公众号：加班猿</div>

<h2 id="一、LCD1602简介"><a href="#一、LCD1602简介" class="headerlink" title="一、LCD1602简介"></a>一、LCD1602简介</h2><p>LCD1602液晶显示器是广泛使用的一种字符型液晶显示模块。它是由字符型液晶显示屏（LCD）、控制驱动主电路HD44780及其扩展驱动电路HD44100，以及少量电阻、电容元件和结构件等装配在PCB板上而组成。</p>
<p>LCD1602应用很广泛，无论是各大电子公司的产品上还是各大高校电赛的比赛作品上都能看到它的身影，下面来细说一下怎么驱动这块1602液晶屏。</p>
<h2 id="二、LCD1602引脚"><a href="#二、LCD1602引脚" class="headerlink" title="二、LCD1602引脚"></a>二、LCD1602引脚</h2><p><img src="https://img-blog.csdnimg.cn/20201017111623780.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<div align = 'center'>图1：引脚说明</div>

<p><img src="https://img-blog.csdnimg.cn/20201017111639139.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<div align = 'center'>图2：原理图</div>

<p>一、我们<strong>重点关注</strong>几个引脚：</p>
<ol>
<li>液晶显示偏压：<strong>VL</strong>对应原理图<strong>V0</strong>引脚，作用是调整1602的<strong>显示对比度</strong>，可外接电位器进行调节对比度，上图原理图<strong>接地</strong>引脚电压为0这时候对比度最高。</li>
<li>数据/命令选择端：<strong>RS</strong>对应原理图<strong>RES</strong>引脚，引脚高电平：进行<strong>数据字节</strong>传输，引脚低电平：进行<strong>命令字节</strong>传输。</li>
<li>读/写选择端：<strong>R/W</strong>对应原理图<strong>R/W</strong>引脚，引脚高电平：对1602进行<strong>读数据</strong>，引脚低电平：对1602进行<strong>写数据</strong>，一般应用都是<strong>直接拉低只进行写数据</strong>。</li>
<li>使能信号：<strong>E</strong>对应原理图<strong>E</strong>引脚，该引脚<strong>上升沿代表对1602开始数据传输，下降沿代表数据传输结束</strong>。</li>
<li>背光控制：原理图K+引脚，该<strong>引脚高电平：背光关闭，引脚低电平：背光打开。</strong></li>
</ol>
<p>二、我们只需要写数据给1602显示，只看写操作时序：</p>
<p>2写指令跟4写数据对比可看出<strong>RW读写引脚为低电平，E为高电平，D0~D7为传输的数据是命令/数据，RS数据/命令选择端（高：数据 ， 低：命令）。</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20201017111743758.png#pic_center" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20201017111752112.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>三、常用的写指令如下，其他指令可去查1602的datasheet：</p>
<p><img src="https://img-blog.csdnimg.cn/20201017111806871.png#pic_center" alt="在这里插入图片描述"></p>
<p>四、数据写入CGRAM指令：</p>
<p><strong>此指令可以自定义显示一个字符，我们写地址的丝毫应该是0x40+Address</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20201017111853950.png#pic_center" alt="在这里插入图片描述"></p>
<h2 id="三、LCD1602驱动-11脚"><a href="#三、LCD1602驱动-11脚" class="headerlink" title="三、LCD1602驱动(11脚)"></a>三、LCD1602驱动(11脚)</h2><p>51单片机跟STM32单片机的驱动基本一致<strong>主要是引脚的配置不怎么一样，特别注意STM32驱动写指令/数据GPIO_Write(GPIOA,(GPIO_ReadOutputData(GPIOA) &amp; 0xff00) | cmd/data)为对电平的读取再写数据，其他均与51驱动一致。</strong></p>
<h3 id="1、51单片机：LCD1602-h"><a href="#1、51单片机：LCD1602-h" class="headerlink" title="1、51单片机：LCD1602.h"></a>1、51单片机：LCD1602.h</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> __LCD1602_H</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __LCD1602_H</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LCD1602_BKL_ON		0	<span class="hljs-comment">//背光开</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LCD1602_BKL_OFF		1	<span class="hljs-comment">//背光关</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LCD1602_DB P2			<span class="hljs-comment">//数据端口  D0~D7</span></span><br>sbit LCD_RES = P4^<span class="hljs-number">1</span>;			<span class="hljs-comment">//1602的数据/指令选择控制线</span><br>sbit LCD_EN = P4^<span class="hljs-number">2</span>;				<span class="hljs-comment">//1602的使能控制线</span><br>sbit Lcd1602_light = P0^<span class="hljs-number">2</span>;      <span class="hljs-comment">//背光引脚</span><br><br><span class="hljs-comment">/*****************************************************************************/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_Init</span><span class="hljs-params">()</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_Clear</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_write_cmd</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> cmd)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_write_data</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> date)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_wtire_CGRAM</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_SetCursor</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> x,<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> y)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_ShowChar</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> xpos,<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> ypos,<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> xsz)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_ShowStr</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> xpos,<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> ypos,<span class="hljs-keyword">char</span> *p)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_ShowNum</span><span class="hljs-params">(<span class="hljs-keyword">char</span> x, <span class="hljs-keyword">char</span> y, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> num)</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_BKLSet</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> val)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> <span class="hljs-title">LCD1602_BKLGet</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Delay_ms</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> nms)</span></span>;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br></code></pre></td></tr></table></figure>

<h3 id="2、51单片机：LCD1602-c"><a href="#2、51单片机：LCD1602-c" class="headerlink" title="2、51单片机：LCD1602.c"></a>2、51单片机：LCD1602.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;LCD1602.h&quot;</span></span><br><br><span class="hljs-comment">/******************************************************************************</span><br><span class="hljs-comment"> * 函数名称:void Delay_ms(unsigned int nms)				      	*</span><br><span class="hljs-comment"> * 函数功能:写命令函数							 					      		*</span><br><span class="hljs-comment"> * 输入参数: //nms为要延时的ms数										   			*</span><br><span class="hljs-comment"> * 返回值  :无														          	*</span><br><span class="hljs-comment"> * 其他说明:	 				 				     			  				*</span><br><span class="hljs-comment"> ******************************************************************************/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Delay_ms</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> nms)</span>		<span class="hljs-comment">//@11.0592MHz</span></span><br><span class="hljs-function"></span>&#123;<br>	<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> i, j;	<span class="hljs-comment">//用单片机小工具根据自己的单片机类型及晶振直接生成对应的延时函数即可</span><br>	<span class="hljs-keyword">while</span>(nms--)<br>	&#123;<br>		i = <span class="hljs-number">15</span>;<br>		j = <span class="hljs-number">90</span>;<br>		<span class="hljs-keyword">do</span><br>		&#123;<br>			<span class="hljs-keyword">while</span> (--j);<br>		&#125; <span class="hljs-keyword">while</span> (--i);<br>	&#125;<br>&#125;<br><span class="hljs-comment">/******************************************************************************</span><br><span class="hljs-comment"> * 函数名称:void LCD1602_write_cmd(unsigned char cmd)				      	*</span><br><span class="hljs-comment"> * 函数功能:写命令函数							 					      		*</span><br><span class="hljs-comment"> * 输入参数:	cmd 命令											   			*</span><br><span class="hljs-comment"> * 返回值  :无														          	*</span><br><span class="hljs-comment"> * 其他说明:	 				 				     			  				*</span><br><span class="hljs-comment"> ******************************************************************************/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_write_cmd</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> cmd)</span>	</span><br><span class="hljs-function"></span>&#123;<br>	LCD1602_DB=cmd;<br>	LCD_RES=<span class="hljs-number">0</span>;<br>	LCD_EN=<span class="hljs-number">1</span>;<br>	Delay_ms(<span class="hljs-number">10</span>);	<br>	LCD_EN=<span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-comment">/******************************************************************************</span><br><span class="hljs-comment"> * 函数名称:void LCD1602_write_data(unsigned char date)				      		*</span><br><span class="hljs-comment"> * 函数功能:写数据函数							 					      		*</span><br><span class="hljs-comment"> * 输入参数:	date 数据										      			*</span><br><span class="hljs-comment"> * 返回值  :无														          *</span><br><span class="hljs-comment"> * 其他说明:	 				 				     			  				*</span><br><span class="hljs-comment"> ******************************************************************************/</span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_write_data</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> date)</span>	</span><br><span class="hljs-function"></span>&#123;<br>	LCD1602_DB=date;<br>	LCD_RES=<span class="hljs-number">1</span>;<br>	LCD_EN=<span class="hljs-number">1</span>;<br>	Delay_ms(<span class="hljs-number">10</span>);<br>	LCD_EN=<span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-comment">/******************************************************************************</span><br><span class="hljs-comment"> * 函数名称:void LCD1602_Init(void)				                    			*</span><br><span class="hljs-comment"> * 函数功能:1602初始化函数							 					      *</span><br><span class="hljs-comment"> * 输入参数:	无										      					*</span><br><span class="hljs-comment"> * 返回值  :无														          *</span><br><span class="hljs-comment"> * 其他说明:	 				 				     			  				*</span><br><span class="hljs-comment"> ******************************************************************************/</span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_Init</span><span class="hljs-params">()</span>	</span><br><span class="hljs-function"></span>&#123;<br>	LCD1602_BKLSet(LCD1602_BKL_ON);	<span class="hljs-comment">//背光开启</span><br>	LCD1602_write_cmd(<span class="hljs-number">0x01</span>); 	<span class="hljs-comment">//显示清屏</span><br>	LCD1602_write_cmd(<span class="hljs-number">0x38</span>);	<span class="hljs-comment">//显示模式设置</span><br>	LCD1602_write_cmd(<span class="hljs-number">0x0C</span>);	<span class="hljs-comment">//显示开及光标设置</span><br>	LCD1602_write_cmd(<span class="hljs-number">0x06</span>);	<span class="hljs-comment">//显示光标移动位置</span><br>&#125;<br><span class="hljs-comment">/******************************************************************************</span><br><span class="hljs-comment"> * 函数名称:void LCD1602_Clear(void)				                    	*</span><br><span class="hljs-comment"> * 函数功能:1602清屏函数							 					      *</span><br><span class="hljs-comment"> * 输入参数:	无										      				*</span><br><span class="hljs-comment"> * 返回值  :无														          *</span><br><span class="hljs-comment"> * 其他说明:	 				 				     			  				*</span><br><span class="hljs-comment"> ******************************************************************************/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_Clear</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>	LCD1602_write_cmd(<span class="hljs-number">0x01</span>);<br>&#125;<br><br><span class="hljs-comment">/******************************************************************************</span><br><span class="hljs-comment"> * 函数名称:void LCD1602_BKLSet(unsigned char val)				              *</span><br><span class="hljs-comment"> * 函数功能:打开1602背光函数							 					      *</span><br><span class="hljs-comment"> * 输入参数:	LCD1602_BKL_ON 开LCD1602_BKL_OFF 关							*			 </span><br><span class="hljs-comment"> * 返回值  :无														          *</span><br><span class="hljs-comment"> * 其他说明:	 				 				     			  				*</span><br><span class="hljs-comment"> ******************************************************************************/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_BKLSet</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> val)</span></span><br><span class="hljs-function"></span>&#123;<br>	Lcd1602_light = val;<br>&#125;<br><span class="hljs-comment">/******************************************************************************</span><br><span class="hljs-comment"> * 函数名称:unsigned char LCD1602_BKLGet()				                    *</span><br><span class="hljs-comment"> * 函数功能:获取1602背光函数							 					      *</span><br><span class="hljs-comment"> * 输入参数:无									      							*</span><br><span class="hljs-comment"> * 返回值  :	0 开1 关															*</span><br><span class="hljs-comment"> * 其他说明:	 				 				     			  				*</span><br><span class="hljs-comment"> ******************************************************************************/</span><br><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> <span class="hljs-title">LCD1602_BKLGet</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>	<span class="hljs-keyword">return</span> Lcd1602_light;<br>&#125;<br><span class="hljs-comment">/******************************************************************************</span><br><span class="hljs-comment"> * 函数名称:void LCD1602_SetCursor(unsigned char x,unsigned char y)			*</span><br><span class="hljs-comment"> * 函数功能:设置1602位置函数							 					      *</span><br><span class="hljs-comment"> * 输入参数:x 横坐标 y 纵坐标									      				*</span><br><span class="hljs-comment"> * 返回值  :	无														          *</span><br><span class="hljs-comment"> * 其他说明:	 				 				     			  				*</span><br><span class="hljs-comment"> ******************************************************************************/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_SetCursor</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> x,<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> y)</span></span><br><span class="hljs-function"></span>&#123;<br>	<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> addr;<br>	<span class="hljs-keyword">if</span>(y==<span class="hljs-number">0</span>)<br>		addr=<span class="hljs-number">0x00</span>+x;<br>	<span class="hljs-keyword">else</span><br>		addr=<span class="hljs-number">0x40</span>+x;<br>	LCD1602_write_cmd(addr | <span class="hljs-number">0x80</span>);<br>&#125;<br><span class="hljs-comment">/******************************************************************************</span><br><span class="hljs-comment"> * 函数名称:void LCD1602_ShowNum(char x, char y, unsigned int num)			 *</span><br><span class="hljs-comment"> * 函数功能:指定位置显示数字函数							 					      *</span><br><span class="hljs-comment"> * 输入参数:x 横坐标 y 纵坐标		num 数字							      *</span><br><span class="hljs-comment"> * 返回值  :	无														          *</span><br><span class="hljs-comment"> * 其他说明:	 				 				     			  *</span><br><span class="hljs-comment"> ******************************************************************************/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_ShowNum</span><span class="hljs-params">(<span class="hljs-keyword">char</span> x, <span class="hljs-keyword">char</span> y, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> num)</span></span><br><span class="hljs-function"></span>&#123;<br>	<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> i,j,k,l,n;<br>	i=num/<span class="hljs-number">10000</span>;<br>	j=(num<span class="hljs-number">-10000</span>*i)/<span class="hljs-number">1000</span>;<br>	k=(num<span class="hljs-number">-10000</span>*i<span class="hljs-number">-1000</span>*j)/<span class="hljs-number">100</span>;<br>	l=(num<span class="hljs-number">-10000</span>*i<span class="hljs-number">-1000</span>*j<span class="hljs-number">-100</span>*k)/<span class="hljs-number">10</span>;<br>	n=num%<span class="hljs-number">10</span>;<br>	LCD1602_SetCursor(x,y);<br>	<span class="hljs-keyword">if</span>(i!=<span class="hljs-number">0</span>)LCD1602_write_data(i+<span class="hljs-number">0x30</span>);<br>	<span class="hljs-keyword">if</span>((i!=<span class="hljs-number">0</span>)||(j!=<span class="hljs-number">0</span>))LCD1602_write_data(j+<span class="hljs-number">0x30</span>);<br>	<span class="hljs-keyword">if</span>((i!=<span class="hljs-number">0</span>)||(j!=<span class="hljs-number">0</span>)||(k!=<span class="hljs-number">0</span>))LCD1602_write_data(k+<span class="hljs-number">0x30</span>);<br>	<span class="hljs-keyword">if</span>((i!=<span class="hljs-number">0</span>)||(j!=<span class="hljs-number">0</span>)||(k!=<span class="hljs-number">0</span>)||(l!=<span class="hljs-number">0</span>))LCD1602_write_data(l+<span class="hljs-number">0x30</span>);<br>	LCD1602_write_data(n+<span class="hljs-number">0x30</span>);<br>&#125;<br><span class="hljs-comment">/******************************************************************************</span><br><span class="hljs-comment"> * 函数名称:void LCD1602_ShowChar(unsigned char xpos,unsigned char ypos,char xsz)  *</span><br><span class="hljs-comment"> * 函数功能:指定位置显示字符函数							 					      *</span><br><span class="hljs-comment"> * 输入参数:xpos 横坐标 ypos 纵坐标		xsz 字符							      *</span><br><span class="hljs-comment"> * 返回值  :	无														          *</span><br><span class="hljs-comment"> * 其他说明:	 				 				     			  *</span><br><span class="hljs-comment"> ******************************************************************************/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_ShowChar</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> xpos,<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> ypos,<span class="hljs-keyword">char</span> xsz)</span>	</span><br><span class="hljs-function"></span>&#123;<br>	ypos%=<span class="hljs-number">2</span>;<br>	<span class="hljs-keyword">if</span>(ypos==<span class="hljs-number">0</span>)<br>	&#123;<br>		LCD1602_write_cmd(<span class="hljs-number">0x80</span>+xpos);<br>	&#125;<br>	<span class="hljs-keyword">else</span><br>	&#123;<br>		LCD1602_write_cmd(<span class="hljs-number">0x80</span>+<span class="hljs-number">0x40</span>+xpos);<br>	&#125;<br>	LCD1602_write_data(xsz);<br>&#125;<br><span class="hljs-comment">/******************************************************************************</span><br><span class="hljs-comment"> * 函数名称:void LCD1602_ShowStr(unsigned char xpos,unsigned char ypos,char *p) *</span><br><span class="hljs-comment"> * 函数功能:指定位置显示字符串函数							 					      *</span><br><span class="hljs-comment"> * 输入参数:xpos 横坐标 ypos 纵坐标		*p 字符串							      *</span><br><span class="hljs-comment"> * 返回值  :	无														          *</span><br><span class="hljs-comment"> * 其他说明:	 				 				     			  *</span><br><span class="hljs-comment"> ******************************************************************************/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_ShowStr</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> xpos,<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> ypos,<span class="hljs-keyword">char</span> *p)</span></span><br><span class="hljs-function"></span>&#123;<br>	<span class="hljs-keyword">if</span>(ypos&gt;<span class="hljs-number">1</span>)<span class="hljs-keyword">return</span>;<br>	<span class="hljs-keyword">while</span>(*p!=<span class="hljs-string">&#x27;\0&#x27;</span>)<br>	&#123;<br>		LCD1602_ShowChar(xpos++,ypos,*p++);<br>		<span class="hljs-keyword">if</span>(*p==<span class="hljs-string">&#x27;\n&#x27;</span>)<br>		&#123;<br>			xpos=<span class="hljs-number">0</span>;<br>			ypos++;<br>			p++;<br>		&#125;<br>	&#125;<br>&#125;<br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> code code_Y[<span class="hljs-number">8</span>]=&#123;<span class="hljs-number">0x11</span>,<span class="hljs-number">0x0A</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>&#125;;<span class="hljs-comment">//类似Y的字模</span><br><span class="hljs-comment">/******************************************************************************</span><br><span class="hljs-comment"> * 函数名称:void LCD1602_wtire_CGRAM(void) *</span><br><span class="hljs-comment"> * 函数功能:自定义显示字符函数							 					      *</span><br><span class="hljs-comment"> * 输入参数:   无							      *</span><br><span class="hljs-comment"> * 返回值  :	无														          *</span><br><span class="hljs-comment"> * 其他说明:	 				 				     			  *</span><br><span class="hljs-comment"> ******************************************************************************/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_wtire_CGRAM</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> num;<br>    LCD1602_write_cmd(<span class="hljs-number">0x40</span>);    <span class="hljs-comment">//对CGRAM第一个自定义字符操作，若是第二个则为0x48，</span><br>    							<span class="hljs-comment">//其次类推（上面有对顶的关系）</span><br>    <span class="hljs-keyword">for</span>(num=<span class="hljs-number">0</span>;num&lt;<span class="hljs-number">8</span>;num++)<br>    &#123;<br>       LCD1602_write_data(code_Y[num]);<br>    &#125; <br>    LCD1602_write_cmd(<span class="hljs-number">0x80</span>);    <span class="hljs-comment">//规定显示在第一行第一个位置 </span><br>    LCD1602_write_data(<span class="hljs-number">0x00</span>);   <span class="hljs-comment">//显示第一个自定义字符 （0x40对应第一个：0x00）</span><br><br>&#125;<br><span class="hljs-comment">/********************************************************************/</span><br><br><br></code></pre></td></tr></table></figure>

<h3 id="3、STM32：LCD1602-h"><a href="#3、STM32：LCD1602-h" class="headerlink" title="3、STM32：LCD1602.h"></a>3、STM32：LCD1602.h</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> __LCD1602_H</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __LCD1602_H </span><br><br><span class="hljs-comment">/***************************根据自己的硬件引脚做修改*****************************/</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LCD_RS_Set()	GPIO_SetBits( GPIOB, GPIO_Pin_12 )<span class="hljs-comment">//1602的数据/指令选择控制线</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LCD_RS_Clr()	GPIO_ResetBits( GPIOB, GPIO_Pin_12 )</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LCD_RW_Set()	GPIO_SetBits( GPIOB, GPIO_Pin_13 )<span class="hljs-comment">//1602的读写控制线</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LCD_RW_Clr()	GPIO_ResetBits( GPIOB, GPIO_Pin_13 )</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LCD_EN_Set()	GPIO_SetBits( GPIOB, GPIO_Pin_14 )<span class="hljs-comment">//1602的使能控制线</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LCD_EN_Clr()	GPIO_ResetBits( GPIOB, GPIO_Pin_14 )</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DATAOUT( x ) GPIO_Write( GPIOA, x )	<span class="hljs-comment">//1602的8条数据控制线</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">GPIO_Configuration</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_Init</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_Wait_Ready</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_Write_Cmd</span><span class="hljs-params">( u8 cmd )</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_Write_Dat</span><span class="hljs-params">( u8 data )</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_ClearScreen</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_Set_Cursor</span><span class="hljs-params">( u8 x, u8 y )</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_Show_Str</span><span class="hljs-params">( u8 x, u8 y, u8 *str )</span></span>;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br></code></pre></td></tr></table></figure>

<h3 id="4、STM32：LCD1602-c"><a href="#4、STM32：LCD1602-c" class="headerlink" title="4、STM32：LCD1602.c"></a>4、STM32：LCD1602.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span>  <span class="hljs-meta-string">&quot;LCD1602.h&quot;</span></span><br><span class="hljs-comment">/******************************************************************************</span><br><span class="hljs-comment"> * 函数名称:void GPIO_Configuration()				      		*</span><br><span class="hljs-comment"> * 函数功能:LCD1602引脚初始化						 					      		*</span><br><span class="hljs-comment"> * 输入参数:无									      			*</span><br><span class="hljs-comment"> * 返回值  :无														          *</span><br><span class="hljs-comment"> * 其他说明:	 				 				     			  				*</span><br><span class="hljs-comment"> ******************************************************************************/</span><br><span class="hljs-comment">/*******************根据自己的硬件引脚做修改*****************************************/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">GPIO_Configuration</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>	GPIO_InitTypeDef GPIO_InitStructure;<br>	RCC_APB2PeriphClockCmd( RCC_APB2Periph_GPIOA | RCC_APB2Periph_GPIOB, ENABLE );<br>	GPIO_InitStructure.GPIO_Pin	= GPIO_Pin_12 | GPIO_Pin_13 | GPIO_Pin_14;<br>	GPIO_InitStructure.GPIO_Speed	= GPIO_Speed_50MHz;<span class="hljs-comment">//选择工作频率</span><br>	GPIO_InitStructure.GPIO_Mode	= GPIO_Mode_Out_PP;<span class="hljs-comment">//设置工作模式</span><br>	GPIO_Init( GPIOB, &amp;GPIO_InitStructure );<br><br>	GPIO_InitStructure.GPIO_Pin	= GPIO_Pin_0 | GPIO_Pin_1 | GPIO_Pin_2 | GPIO_Pin_3 | 									  GPIO_Pin_4 | GPIO_Pin_5 | GPIO_Pin_6 | GPIO_Pin_7;<br>	GPIO_InitStructure.GPIO_Mode	= GPIO_Mode_Out_PP;<span class="hljs-comment">//设置工作模式</span><br>	GPIO_InitStructure.GPIO_Speed	= GPIO_Speed_50MHz;<span class="hljs-comment">//选择工作频率</span><br>	GPIO_Init( GPIOA, &amp;GPIO_InitStructure );<br>&#125;<br><span class="hljs-comment">/******************************************************************************</span><br><span class="hljs-comment"> * 函数名称:void LCD1602_Init()				      		*</span><br><span class="hljs-comment"> * 函数功能:LCD1602初始化						 					      		*</span><br><span class="hljs-comment"> * 输入参数:无									      			*</span><br><span class="hljs-comment"> * 返回值  :无														          *</span><br><span class="hljs-comment"> * 其他说明:	 				 				     			  				*</span><br><span class="hljs-comment"> ******************************************************************************/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_Init</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>	GPIO_Configuration();			<span class="hljs-comment">//初始化引脚</span><br><br>	LCD1602_Write_Cmd( <span class="hljs-number">0x38</span> );      <span class="hljs-comment">//显示模式设置</span><br>	delay_ms( <span class="hljs-number">5</span> );<br>	LCD1602_Write_Cmd( <span class="hljs-number">0x0c</span> );      <span class="hljs-comment">//显示开及光标设置</span><br>	delay_ms( <span class="hljs-number">5</span> );<br>	LCD1602_Write_Cmd( <span class="hljs-number">0x06</span> );      <span class="hljs-comment">//显示光标移动位置</span><br>	delay_ms( <span class="hljs-number">5</span> );<br>	LCD1602_Write_Cmd( <span class="hljs-number">0x01</span> );      <span class="hljs-comment">//显示清屏</span><br>	delay_ms( <span class="hljs-number">5</span> );	<br>&#125;<br><span class="hljs-comment">/******************************************************************************</span><br><span class="hljs-comment"> * 函数名称:void LCD1602_Write_Cmd(u8 cmd)				      		*</span><br><span class="hljs-comment"> * 函数功能:写命令函数							 					      		*</span><br><span class="hljs-comment"> * 输入参数:	cmd 命令										      			*</span><br><span class="hljs-comment"> * 返回值  :无														          *</span><br><span class="hljs-comment"> * 其他说明:	 				 				     			  				*</span><br><span class="hljs-comment"> ******************************************************************************/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_Write_Cmd</span><span class="hljs-params">( u8 cmd )</span></span><br><span class="hljs-function"></span>&#123;<br>	LCD_RS_Clr();<br>	LCD_RW_Clr();<br>	LCD_EN_Set();<br><br>	GPIO_Write( GPIOA, (GPIO_ReadOutputData( GPIOA ) &amp; <span class="hljs-number">0xff00</span>) | cmd );<span class="hljs-comment">//对电平的读取</span><br><br>	DATAOUT( cmd );<br>	delay_ms( <span class="hljs-number">5</span> );<br>	LCD_EN_Clr();<br>&#125;<br><br><span class="hljs-comment">/******************************************************************************</span><br><span class="hljs-comment"> * 函数名称:void LCD1602_Write_Dat(u8 date)				      		*</span><br><span class="hljs-comment"> * 函数功能:写数据函数							 					      		*</span><br><span class="hljs-comment"> * 输入参数:	date 数据										      			*</span><br><span class="hljs-comment"> * 返回值  :无														          *</span><br><span class="hljs-comment"> * 其他说明:	 				 				     			  				*</span><br><span class="hljs-comment"> ******************************************************************************/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_Write_Dat</span><span class="hljs-params">( u8 data )</span></span><br><span class="hljs-function"></span>&#123;<br>	LCD_RS_Set();<br>	LCD_RW_Clr();<br>	LCD_EN_Set();<br><br>	GPIO_Write( GPIOA, (GPIO_ReadOutputData( GPIOA ) &amp; <span class="hljs-number">0xff00</span>) | data );<span class="hljs-comment">//对电平的读取</span><br><br>	delay_ms( <span class="hljs-number">5</span> );<br>	LCD_EN_Clr();<br>&#125;<br><br><span class="hljs-comment">/******************************************************************************</span><br><span class="hljs-comment"> * 函数名称:void LCD1602_ClearScreen()				      		*</span><br><span class="hljs-comment"> * 函数功能:1602清屏函数							 					      		*</span><br><span class="hljs-comment"> * 输入参数:无										      			*</span><br><span class="hljs-comment"> * 返回值  :无														          *</span><br><span class="hljs-comment"> * 其他说明:	 				 				     			  				*</span><br><span class="hljs-comment"> ******************************************************************************/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_ClearScreen</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>	LCD1602_Write_Cmd( <span class="hljs-number">0x01</span> );<br>&#125;<br><br><span class="hljs-comment">/******************************************************************************</span><br><span class="hljs-comment"> * 函数名称:void LCD1602_Set_Cursor(u8 x, u8 y)				      		*</span><br><span class="hljs-comment"> * 函数功能:设置1602位置函数							 					      *</span><br><span class="hljs-comment"> * 输入参数:x 横坐标 y 纵坐标									      				*</span><br><span class="hljs-comment"> * 返回值  :无														          *</span><br><span class="hljs-comment"> * 其他说明:	 				 				     			  				*</span><br><span class="hljs-comment"> ******************************************************************************/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_Set_Cursor</span><span class="hljs-params">( u8 x, u8 y )</span></span><br><span class="hljs-function"></span>&#123;<br>	u8 addr;<br><br>	<span class="hljs-keyword">if</span> ( y == <span class="hljs-number">0</span> )<br>		addr = <span class="hljs-number">0x00</span> + x;<br>	<span class="hljs-keyword">else</span><br>		addr = <span class="hljs-number">0x40</span> + x;<br>	LCD1602_Write_Cmd( addr | <span class="hljs-number">0x80</span> );<br>&#125;<br><br><span class="hljs-comment">/******************************************************************************</span><br><span class="hljs-comment"> * 函数名称:void LCD1602_Show_Str( u8 x, u8 y, u8 *str )				      		*</span><br><span class="hljs-comment"> * 函数功能:指定位置显示字符串函数							 					      *</span><br><span class="hljs-comment"> * 输入参数:x 横坐标 y 纵坐标		*str 字符串							      *</span><br><span class="hljs-comment"> * 返回值  :	无													          *</span><br><span class="hljs-comment"> * 其他说明:	 				 				     			  				*</span><br><span class="hljs-comment"> ******************************************************************************/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_Show_Str</span><span class="hljs-params">( u8 x, u8 y, u8 *str )</span></span><br><span class="hljs-function"></span>&#123;<br>	LCD1602_Set_Cursor( x, y );<br>	<span class="hljs-keyword">while</span> ( *str != <span class="hljs-string">&#x27;\0&#x27;</span> )<br>	&#123;<br>		LCD1602_Write_Dat( *str++ );<br>	&#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<h2 id="四、LCD1602-STM32驱动-6线"><a href="#四、LCD1602-STM32驱动-6线" class="headerlink" title="四、LCD1602 STM32驱动(6线)"></a>四、LCD1602 STM32驱动(6线)</h2><p>LCD1602 的接口形式是并行的，它有 8 条数据线、3 条控制线。这样就需要 11 条线来控制它的正常工作。虽然它还可以工作在 4 位数据线的形式，最精简的形式是 6 条线。</p>
<p>我们可以用74HC595 进行串－并转换，<strong>74HC595 是“串入并出”的移位寄存器芯片，它需要用 3 条线控制数据的输入，才能正常的输出 8 位数据</strong>，总共6条线即可进行LCD1602的控制。</p>
<p>这里<strong>多用了一块芯片但是省了5个IO口</strong>，对于某些项目单片机引脚不够用的情况下可以应用上。</p>
<p>原理图如下：<img src="https://img-blog.csdnimg.cn/20201017111936155.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/2020101711194443.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h3 id="1、STM32：LCD1602-h"><a href="#1、STM32：LCD1602-h" class="headerlink" title="1、STM32：LCD1602.h"></a>1、STM32：LCD1602.h</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> __LCD1602_H</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __LCD1602_H		</span><br>	 <br><span class="hljs-comment">//1602液晶指令/数据或选择引脚</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LCD_RS_PORT   	GPIOB</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LCD_RS_PIN 		GPIO_Pin_10</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span>  LCD_RS_0   	GPIO_ResetBits(LCD_RS_PORT, LCD_RS_PIN)</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span>  LCD_RS_1   	GPIO_SetBits(LCD_RS_PORT, LCD_RS_PIN)</span><br><br><br><span class="hljs-comment">//1602液晶使能引脚</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LCD_EN_PORT   	GPIOB</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LCD_EN_PIN 		GPIO_Pin_11					<span class="hljs-comment">//PB11</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span>  LCD_EN_0   	GPIO_ResetBits(LCD_EN_PORT, LCD_EN_PIN)</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span>  LCD_EN_1   	GPIO_SetBits(LCD_EN_PORT, LCD_EN_PIN)</span><br><br><span class="hljs-comment">//1602液晶数据端口	</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MOSIO PBout(0)	</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> R_CLK PCout(5)</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> S_CLK PCout(4)</span><br><br><span class="hljs-comment">/*********************函数声明*****************/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_Clear</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_ShowStr</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> xpos,<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> ypos,<span class="hljs-keyword">char</span> *p)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_BKLSet</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> on)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> <span class="hljs-title">LCD1602_BKLGet</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_ShowLineStr</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> xpos,<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> ypos,<span class="hljs-keyword">char</span> *p)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_ShowState</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> Signal, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> GprsState)</span></span>;<br><span class="hljs-comment">/**********************************************/</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span>  </span><br><br></code></pre></td></tr></table></figure>



<h3 id="2、STM32：LCD1602-c"><a href="#2、STM32：LCD1602-c" class="headerlink" title="2、STM32：LCD1602.c"></a>2、STM32：LCD1602.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;LCD1602.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;delay.h&quot;</span><span class="hljs-comment">//程序中的延时函数根据自己32单片机来就行	</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">hc595SendData</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> sendVal)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> i;<br>    <span class="hljs-comment">//从CPU中向595一位一位发送，595一位一位接收</span><br>    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++)<br>    &#123;<br>        <span class="hljs-keyword">if</span>((sendVal &lt;&lt; i) &amp; <span class="hljs-number">0x80</span>)<br>            MOSIO = <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">else</span> MOSIO = <span class="hljs-number">0</span>;<br>        S_CLK = <span class="hljs-number">0</span>;<br>        S_CLK = <span class="hljs-number">1</span>;<br><br>    &#125;<br>    <span class="hljs-comment">//CPU发送完后，R_CLK将数据并行输出，</span><br>    <span class="hljs-comment">//实现了只占用CPU一个输出口就可以输出8bit数据</span><br>    R_CLK = <span class="hljs-number">0</span>;<br>    R_CLK = <span class="hljs-number">1</span>;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_write_com</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> com)</span>	</span><br><span class="hljs-function"></span>&#123;<br>	hc595SendData(com);<br>	LCD_RS_0;<br>	LCD_EN_0;<br>	delay_ms(<span class="hljs-number">10</span>);	<br>	LCD_EN_1;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_write_data</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> date)</span>	</span><br><span class="hljs-function"></span>&#123;<br>	hc595SendData(date);<br>	LCD_RS_1;<br>	LCD_EN_0;<br>	delay_ms(<span class="hljs-number">10</span>);<br>	LCD_EN_1;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>	</span><br><span class="hljs-function"></span>&#123;<br>	 GPIO_InitTypeDef  GPIO_InitStructure;<br> <br>	RCC_APB2PeriphClockCmd(	RCC_APB2Periph_GPIOB | RCC_APB2Periph_GPIOC, ENABLE );<br>	<br>	GPIO_InitStructure.GPIO_Mode=GPIO_Mode_Out_PP;  <span class="hljs-comment">//推挽输出</span><br>	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;<br>	GPIO_InitStructure.GPIO_Pin =  LCD_RS_PIN | LCD_EN_PIN | GPIO_Pin_0;<br>	GPIO_Init(GPIOB, &amp;GPIO_InitStructure);	<br><br>	GPIO_InitStructure.GPIO_Mode=GPIO_Mode_Out_PP;  <span class="hljs-comment">//推挽输出</span><br>	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;<br>	GPIO_InitStructure.GPIO_Pin =   GPIO_Pin_4 | GPIO_Pin_5;		      <br>	GPIO_Init(GPIOC, &amp;GPIO_InitStructure);	<br>	<br>	LCD1602_write_com(<span class="hljs-number">0x01</span>); <br>	LCD1602_write_com(<span class="hljs-number">0x38</span>);<br>	LCD1602_write_com(<span class="hljs-number">0x0C</span>);<span class="hljs-comment">//开显示，不需要光标	</span><br>	LCD1602_write_com(<span class="hljs-number">0x06</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_Clear</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>	LCD1602_write_com(<span class="hljs-number">0x01</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_ShowChar</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> xpos,<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> ypos,<span class="hljs-keyword">char</span> xsz)</span>	</span><br><span class="hljs-function"></span>&#123;<br>	ypos%=<span class="hljs-number">2</span>;<br>	<span class="hljs-keyword">if</span>(ypos==<span class="hljs-number">0</span>)<br>	&#123;<br>		LCD1602_write_com(<span class="hljs-number">0x80</span>+xpos);<br>	&#125;<br>	<span class="hljs-keyword">else</span><br>	&#123;<br>		LCD1602_write_com(<span class="hljs-number">0x80</span>+<span class="hljs-number">0x40</span>+xpos);<br>	&#125;<br>	LCD1602_write_data(xsz);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_ShowLineStr</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> xpos,<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> ypos,<span class="hljs-keyword">char</span> *p)</span></span><br><span class="hljs-function"></span>&#123;<br>	<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> i=<span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">if</span>(ypos&gt;<span class="hljs-number">1</span> || xpos&gt;=<span class="hljs-number">16</span>)<span class="hljs-keyword">return</span>;<br>	<span class="hljs-keyword">while</span>(*p!=<span class="hljs-string">&#x27;\0&#x27;</span> &amp;&amp; i&lt;<span class="hljs-number">16</span> &amp;&amp; xpos&lt;<span class="hljs-number">16</span>)<br>	&#123;<br>		i++;<br>		LCD1602_ShowChar(xpos++,ypos,*p++);<br>		delay_us(<span class="hljs-number">500</span>);<br>	&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD1602_ShowStr</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> xpos,<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> ypos,<span class="hljs-keyword">char</span> *p)</span></span><br><span class="hljs-function"></span>&#123;<br>	<span class="hljs-keyword">if</span>(ypos&gt;<span class="hljs-number">1</span>)<span class="hljs-keyword">return</span>;<br>	<span class="hljs-keyword">while</span>(*p!=<span class="hljs-string">&#x27;\0&#x27;</span>)<br>	&#123;<br>		LCD1602_ShowChar(xpos++,ypos,*p++);<br>		<span class="hljs-keyword">if</span>(*p==<span class="hljs-string">&#x27;\n&#x27;</span>)<span class="hljs-comment">//当检测到换行符时，进行换行检测</span><br>		&#123;<br>			xpos=<span class="hljs-number">0</span>;<br>			ypos++;<br>			p++;<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>如果你觉得文章还不错，记得”<strong>点赞关注</strong>“</p>
<p>关注我的微信公众号【 <strong>加班猿</strong> 】可以获取更多内容</p>
<p><img src="https://img-blog.csdnimg.cn/20201017112132917.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/10/20/LCD1602%E5%8D%95%E7%89%87%E6%9C%BA%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F(STC51STM32)%E8%AF%A6%E8%A7%A3/" data-id="ckhvya4zv000tbglr7l4c5iuu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%A9%B1%E5%8A%A8/" rel="tag">驱动</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Git的简明使用教程" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/05/Git%E7%9A%84%E7%AE%80%E6%98%8E%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/" class="article-date">
  <time datetime="2020-10-04T16:00:00.000Z" itemprop="datePublished">2020-10-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Git/">Git</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/05/Git%E7%9A%84%E7%AE%80%E6%98%8E%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/">Git的简明使用教程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://img-blog.csdnimg.cn/20201014220601139.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<div align = 'right'>作者：hackett</div>

<div align = 'right'>微信公众号：加班猿</div>

<p>Git是一个免费的开源 分布式版本控制系统，旨在快速高效地处理从小型到大型项目的所有内容。Git易于学习， 占地面积小，具有闪电般的快速性能。它具有Subversion，CVS，Perforce和ClearCase之类的SCM工具，具有廉价的本地分支，方便的暂存区域和 多个工作流等功能。–《<a target="_blank" rel="noopener" href="https://git-scm.com/">Git官网</a>》</p>
<p>依稀还记得当初写论文的时候，保存的论文文档是这样子的，代码文件夹是这样的。根据需求删除或修改一些东西后另存为另一个文件，过一段时间后，想找回被删除的文字/代码，但是不知道保存在哪个文件里去了，想保留最新的一个把其他都删除掉，又怕哪天会用上不敢删除，真的烦人，这个时候就轮到我们强大的Git出场了，顺便记录一下自己从<a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/896043488029600">廖雪峰的官方网站Git教程</a>的学习。</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/bef9a93e6039da70fc3f78db5cabcefc.png" alt="img"></p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/7d2b24243c40e091b365671a54d44ba4.png" alt="img"></p>
<h1 id="我工作中常用的指令"><a href="#我工作中常用的指令" class="headerlink" title="我工作中常用的指令"></a>我工作中常用的指令</h1><p>1、如果你没有项目的代码，组长一般都会给你一个链接，这时候你就可以用git命令<font color = red size = 4><code>git clone</code></font>下来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">git clone  https:&#x2F;&#x2F;github.com&#x2F;CodingEmbedded&#x2F;mygit.git<br></code></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20201014222104920.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>2、接到主管的需求（此刻的我是想拿我的ZFB收款码出来的），一般来说都是新建一个分支的去开发的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">git check -b 分支名<br></code></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20201014223036742.png#pic_center" alt="在这里插入图片描述"><br>3、此时就可以愉快地写bug了,有时候同事/主管问你改了什么问题，你改了挺多不记得可以先<font color = red size = 4><code>status</code></font>再<font color = red size = 4><code>diff</code></font>一下可以看到我们修改了那些文件增删了那些内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">git status<br>git diff<br></code></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/2020101423032456.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>4、写好之后就可以先<font color = red size = 4><code>git add</code></font>再<font color = red size = 4><code>git commit</code></font>进行本地代码的提交</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">git add<br>git commit -m &quot;message&quot;<br></code></pre></td></tr></table></figure>


<p>5、提交到远程仓库需要用<font color = red size = 4><code>push</code></font></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">git push<br></code></pre></td></tr></table></figure>

<p>6、假如在你写的时候有人提交了代码，这时候你需要<font color = red size = 4><code>pull</code></font>最新的代码下来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">git pull<br></code></pre></td></tr></table></figure>
<p>如果没有冲突就可以提交代码（有冲突的话就按照Git提示做修改再提交）</p>
<p>7、你的代码有一个致命bug，并且已经提交到了远程仓库，版本回退的方法：<br>先用下面命令找到要回退的版本的commit_id：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">git reflog<br></code></pre></td></tr></table></figure>
<p>然后回退版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">git reset --hard commit_id<br></code></pre></td></tr></table></figure>
<p>最后强制推送到远程分支：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">git push -f<br></code></pre></td></tr></table></figure>
<p>可以看到<strong>图1</strong>是提交了一个记录为“add or del”，<strong>图2图3</strong>为回退版本操作，<strong>图4图5</strong>对比可以看出git已经回退了</p>
<center>图1</center>

<p><img src="https://img-blog.csdnimg.cn/20201014233850337.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<center>图2</center>

<p><img src="https://img-blog.csdnimg.cn/20201014233904472.png#pic_center" alt="在这里插入图片描述"></p>
<center>图3</center>

<p><img src="https://img-blog.csdnimg.cn/20201014233919767.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<center>图4</center>

<p><img src="https://img-blog.csdnimg.cn/20201014234446419.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<center>图5</center>

<p><img src="https://img-blog.csdnimg.cn/20201014234653420.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h2 id="一、创建版本库"><a href="#一、创建版本库" class="headerlink" title="一、创建版本库"></a>一、创建版本库</h2><p>1、新建一个空目录(如下我是<font color = red size = 4><code>E</code></font>盘 –&gt; <font color = red size = 4><code>code</code></font>目录下新建一个<font color = red size = 4><code>test</code></font>版本库)</p>
<p>2、通过<font color = red size = 4><code>git init</code></font>命令把这个目录变成Git可以管理的仓库</p>
<p>3、<font color = red size = 4><code>ls -ah</code></font>查看<font color = red size = 4><code>.git</code></font>&gt;目录和<font color = red size = 4><code>./</code></font>&gt;<font color = red size = 4><code>../</code></font>&gt;，那是因为<font color = red size = 4><code>.git</code></font>这个目录默认是隐藏的。<img src="https://img-blog.csdnimg.cn/img_convert/2a89b1a344fe4903932aff01352ce736.png" alt="img"></p>
<h2 id="二、添加文件到仓库"><a href="#二、添加文件到仓库" class="headerlink" title="二、添加文件到仓库"></a>二、添加文件到仓库</h2><p>1、编写一个文件 text.txt</p>
<p>2、使用命令<font color = red size = 4><code>git add  &lt;file&gt;</code></font>，可反复多次使用，添加多个文件，添加全部文件使用<font color = red size = 4><code>git add -A</code></font></p>
<p>3、使用命令<font color = red size = 4><code>git commit -m &lt;message&gt;</code></font>，完成，<font color = red size = 4><code>message</code></font>为提交的文本信息</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/52b373c8a5bbaf4a1b1e50252b0d402b.png" alt="img"></p>
<h2 id="三、查看工作状态和修改的文件"><a href="#三、查看工作状态和修改的文件" class="headerlink" title="三、查看工作状态和修改的文件"></a>三、查看工作状态和修改的文件</h2><p>1、要随时掌握工作区的状态，使用<font color = red size = 4><code>git status</code></font>命令。</p>
<p>2、如果<font color = red size = 4><code>git status</code></font>告诉你有文件被修改过，用<font color = red size = 4><code>git diff</code></font>可以查看修改内容。</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/f9d6df6cefc446fd74c405d791eeb86c.png" alt="img"></p>
<h2 id="四、git的版本回退"><a href="#四、git的版本回退" class="headerlink" title="四、git的版本回退"></a>四、git的版本回退</h2><p>1、版本回退前，用<font color = red size = 4><code>git log</code></font>可以查看提交历史，以便确定要回退到哪个版本。</p>
<p>2、HEAD指向的版本就是当前版本，因此，Git允许我们在版本的历史之间回退，使用命令</p>
<p><font color = red size = 4><code>git reset --hard commit_id</code></font>。</p>
<p>3、Git必须知道当前版本是哪个版本，在Git中，用HEAD表示当前版本上一个版本就是<font color = red size = 4><code>HEAD^</code></font>，上上一个版本就是<font color = red size = 4><code>HEAD^^</code></font>，当然往上100个版本写100个^比较容易数不过来，所以写成<font color = red size = 4><code>HEAD~100</code></font>。</p>
<p>4、要重返未来，用<font color = red size = 4><code>git reflog</code></font>查看命令历史，以便确定要回到未来的哪个版本。使用命令<font color = red size = 4><code>git reset --hard commit_id</code></font>。</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/061d6a6694f862a09e7652f891550fd4.png" alt="img"></p>
<h2 id="五、暂存区"><a href="#五、暂存区" class="headerlink" title="五、暂存区"></a>五、暂存区</h2><p> 提交一个readme.txt的过程</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/bbb5e931a8b878cf4c0aa610964049e8.png" alt="img"></p>
<h2 id="六、管理修改"><a href="#六、管理修改" class="headerlink" title="六、管理修改"></a>六、管理修改</h2><p>Git是如何跟踪修改的，每次修改，如果不用<font color = red size = 4><code>git add</code></font>到暂存区，那就不会加入到<font color = red size = 4><code>commit</code></font>中。</p>
<h2 id="七、撤销修改"><a href="#七、撤销修改" class="headerlink" title="七、撤销修改"></a>七、撤销修改</h2><p>场景1：当你改乱了工作区某个文件的内容，想直接丢弃工作区的修改时，用命令<font color = red size = 4><code>git checkout -- file</code></font>。</p>
<p>场景2：当你不但改乱了工作区某个文件的内容，还添加到了暂存区时，想丢弃修改，分两步，第一步用命令<font color = red size = 4><code>git reset HEAD &lt;file&gt;</code></font>，就回到了场景1，第二步按场景1操作。</p>
<p>场景3：已经提交了不合适的修改到版本库时，想要撤销本次提交，参考四、git的版本回退一节（用git log查看命令历史，以便确定要回到未来的哪个版本。使用命令<font color = red size = 4><code>git reset --hard commit_id</code></font>），不过前提是没有推送到远程库。</p>
<h2 id="八、删除文件"><a href="#八、删除文件" class="headerlink" title="八、删除文件"></a>八、删除文件</h2><p>命令<font color = red size = 4><code>git rm</code></font>用于删除一个文件。如果一个文件已经被提交到版本库，那么你永远不用担心误删，但是要小心，你只能恢复文件到最新版本，你会丢失<font color = red size = 4><code>*最近一次提交后你修改的内容*</code></font>。</p>
<p><font color = red size = 4><code>git checkout -- &lt;file&gt;</code></font>其实是用版本库里的版本替换工作区的版本，无论工作区是修改还是删除，都可以“一键还原”。</p>
<h2 id="九、添加远程库"><a href="#九、添加远程库" class="headerlink" title="九、添加远程库"></a>九、添加远程库</h2><p>第一步：在git下创建<font color = red size = 4><code>SSH Key</code></font>。在用户主目录下，看看有没有.ssh目录，如果有，再看看这个目录下有没有<font color = red size = 4><code>id_rsa</code></font>和<font color = red size = 4><code>id_rsa.pub</code></font>这两个文件，如果已经有了，可直接跳到下一步。如果没有，打开Shell（Windows下打开Git Bash），创建SSH Key：</p>
<p><font color = red size = 4><code>$ssh-keygen -t rsa -C &quot;youremail@example.com&quot;</code></font> </p>
<p>你需要把邮件地址换成你自己的邮件地址，然后一路回车，使用默认值即可，由于这个Key也不是用于军事目的，所以也无需设置密码。</p>
<p>如果一切顺利的话，可以在用户主目录里找到.ssh目录，里面有<font color = red size = 4><code>id_rsa</code></font>和<font color = red size = 4><code>id_rsa.pub</code></font>两个文件，这两个就是SSH Key的秘钥对，<font color = red size = 4><code>id_rsa</code></font>是私钥，不能泄露出去，<font color = red size = 4><code>id_rsa.pub</code></font>是公钥，可以放心地告诉任何人。</p>
<p>第二步：登陆GitHub，打开“Settings”，点<font color = red size = 4><code>“SSH and GPG keys”</code></font>，填上任意Title，在Key文本框里粘贴id_rsa.pub文件的内容,点<font color = red size = 4><code>“Add Key”</code></font>，你就应该看到已经添加的Key：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/225d0dfd5250083799787e900b526bd8.png" alt="img">    第二步：创建一个GitHub账号，添加一个空的仓库。首先，登陆GitHub，然后，在右上角找到“new repository”按钮，创建一个新的仓库：在Repository name填入仓库名，其他保持默认设置，点击“Create repository”按钮，就成功地创建了一个新的Git仓库：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/5c8df56f54d84a0ba2ce65dbeaf8ac51.png" alt="img">    目前，在GitHub上的这个仓库还是空的，GitHub告诉我们，可以从这个仓库克隆出新的仓库，也可以把一个已有的本地仓库与之关联，然后，把本地仓库的内容推送到GitHub仓库。</p>
<p>现在，我们根据GitHub的提示，在本地的仓库下运行命令：<font color = red size = 4><code>git remote add origin + ssh链接</code></font></p>
<p>使用命令<font color = red size = 4><code>git push -u origin master</code></font>将内容推送上去。</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/178a7efd8092aaf235075741df407a5c.png" alt="img"></p>
<p>注意：检查git的配置文件的邮箱还有用户名还有URL是否正确。才能进行下一步操作。</p>
<p>要关联一个远程库，使用命令<font color = red size = 4><code>git remote add origin git@server-name:path/repo-name.git</code></font>；关联后，使用命令<font color = red size = 4><code>git push -u origin master</code></font>第一次推送master分支的所有内容；此后，每次本地提交后，只要有必要，就可以使用命令<font color = red size = 4><code>git push origin master</code></font>推送最新修改</p>
<h2 id="十、从远程库克隆"><a href="#十、从远程库克隆" class="headerlink" title="十、从远程库克隆"></a>十、从远程库克隆</h2><p>要克隆一个仓库，首先必须知道仓库的地址，然后使用<font color = red size = 4><code>git clone+ ssh链接</code></font>命令克隆。</p>
<p>Git支持多种协议，包括https，但通过ssh支持的原生git协议速度最快。</p>
<h2 id="十一、创建与分支（Git鼓励大量使用分支）"><a href="#十一、创建与分支（Git鼓励大量使用分支）" class="headerlink" title="十一、创建与分支（Git鼓励大量使用分支）"></a>十一、创建与分支（Git鼓励大量使用分支）</h2><p>查看分支：<font color = red size = 4><code>git branch</code></font></p>
<p>创建分支：<font color = red size = 4><code>git branch &lt;name&gt;</code></font></p>
<p>切换分支：<font color = red size = 4><code>git checkout &lt;name&gt;</code></font></p>
<p>创建+切换分支：<font color = red size = 4><code>git checkout -b &lt;name&gt;</code></font></p>
<p>合并某分支到当前分支：<font color = red size = 4><code>git merge &lt;name&gt;</code></font></p>
<p>删除分支：<font color = red size = 4><code>git branch -d &lt;name&gt; </code></font></p>
<h2 id="十二、解决冲突"><a href="#十二、解决冲突" class="headerlink" title="十二、解决冲突"></a>十二、解决冲突</h2><p>当Git无法自动合并分支时，就必须首先解决冲突。解决冲突后，再提交，合并完成。解决冲突就是把Git合并失败的文件手动编辑为我们希望的内容，再提交。用<font color = red size = 4><code>git log --graph</code></font>命令可以看到分支合并图。</p>
<h2 id="十三、分支管理策略"><a href="#十三、分支管理策略" class="headerlink" title="十三、分支管理策略"></a>十三、分支管理策略</h2><p>准备合并dev分支，请注意<font color = red size = 4><code>--no-ff</code></font>参数，表示<font color = red size = 4><code>禁用Fast forward </code></font>，<font color = red size = 4><code>git merge --no-ff -m &quot;merge with no-ff&quot; dev</code></font> 因为本次合并要创建一个新的commit，所以加上-m参数，把commit描述写进去。</p>
<h2 id="十四、bug分支"><a href="#十四、bug分支" class="headerlink" title="十四、bug分支"></a>十四、bug分支</h2><p>修复bug时，我们会通过创建新的bug分支进行修复，然后合并，最后删除；当手头工作没有完成时，先把工作现场<font color = red size = 4><code>git stash</code></font>一下，然后去修复bug，修复后，再<font color = red size = 4><code>git stash pop</code></font>，回到工作现场。</p>
<h2 id="十五、feature分支"><a href="#十五、feature分支" class="headerlink" title="十五、feature分支"></a>十五、feature分支</h2><p>开发一个<font color = red size = 4><code>新feature</code></font>，最好新建一个分支；如果要丢弃一 个没有被合并过的分支，可以通过<font color = red size = 4><code>git branch -D &lt;name&gt;</code></font>强行删除。</p>
<h2 id="十六、多人协作"><a href="#十六、多人协作" class="headerlink" title="十六、多人协作"></a>十六、多人协作</h2><p>查看远程库信息，使用<font color = red size = 4><code>git remote -v</code></font>；</p>
<p>本地新建的分支如果不推送到远程，对其他人就是不可见的；</p>
<p>从本地推送分支，使用<font color = red size = 4><code>git push origin branch-name</code></font>，如果推送失败，先用<font color = red size = 4><code>git pull</code></font>抓取远程的新提交；</p>
<p>在本地创建和远程分支对应的分支，使用<font color = red size = 4><code>git checkout -b branch-name origin/branch-name</code></font>，本地和远程分支的名称最好一致；</p>
<p>建立本地分支和远程分支的关联，使用<font color = red size = 4><code>git branch --set-upstream branch-name origin/branch-name</code></font>；</p>
<p>从远程抓取分支，使用<font color = red size = 4><code>git pull</code></font>，如果有冲突，要先处理冲突。</p>
<h2 id="十七、创建标签"><a href="#十七、创建标签" class="headerlink" title="十七、创建标签"></a>十七、创建标签</h2><p>命令<font color = red size = 4><code>git tag &lt;tagname&gt;</code></font>用于新建一个标签，默认为HEAD，也可以指定一个<font color = red size = 4><code>commit id</code></font>；</p>
<p>命令<font color = red size = 4><code>git tag -a &lt;tagname&gt; -m &quot;blablabla...&quot;</code></font>可以指定标签信息；</p>
<p>命令<font color = red size = 4><code>git tag</code></font>可以查看所有标签</p>
<p>用命令<font color = red size = 4><code>git show &lt;tagname&gt;</code></font>可以看到说明文字 </p>
<p>注意：标签总是和某个<font color = red size = 4><code>commit</code></font>挂钩。如果这个<font color = red size = 4><code>commit</code></font>既出现在<font color = red size = 4><code>master</code></font>分支，又出现在<font color = red size = 4><code>dev</code></font>分支，那么在这两个分支上都可以看到这个标签。</p>
<h2 id="十八、操作标签"><a href="#十八、操作标签" class="headerlink" title="十八、操作标签"></a>十八、操作标签</h2><p>命令<font color = red size = 4><code>git push origin &lt;tagname&gt;</code></font>可以推送一个本地标签；</p>
<p>命令<font color = red size = 4><code>git push origin --tags</code></font>可以推送全部未推送过的本地标签；</p>
<p>命令<font color = red size = 4><code>git tag -d &lt;tagname&gt;</code></font>可以删除一个本地标签；</p>
<p>命令<font color = red size = 4><code>git push origin :refs/tags/&lt;tagname&gt;</code></font>可以删除一个远程标签。<br><strong>最后总结一下Git的常用命令:</strong></p>
<ul>
<li><p><code>mkdir</code> XX (创建一个空目录 XX指目录名)</p>
</li>
<li><p><code>pwd</code> 显示当前目录的路径。</p>
</li>
<li><p><code>git init</code> 把当前的目录变成可以管理的git仓库，生成隐藏.git文件。</p>
</li>
<li><p><code>git add XX</code> 把xx文件添加到暂存区去。</p>
</li>
<li><p><code>git commit –m “XX”</code> 提交文件 XX是提交的注释。</p>
</li>
<li><p><code>git status</code> 查看仓库状态</p>
</li>
<li><p><code>git diff XX</code> 查看XX文件修改了那些内容</p>
</li>
<li><p><code>git log</code> 查看历史记录</p>
</li>
<li><p>git reset –hard HEAD^或者git reset –hard HEAD~</p>
<p>回退到上一个版本(使用<code>git reset –hard commit_id</code>回退到commit_id的指定版本 )</p>
</li>
<li><p><code>cat XX</code> 查看XX文件内容</p>
</li>
<li><p><code>git reflog</code> 查看历史记录的版本号id</p>
</li>
<li><p><code>git checkout -- XX</code> 把XX文件在工作区的修改全部撤销。</p>
</li>
<li><p><code>git rm XX</code> 删除XX文件</p>
</li>
<li><p><code>git remote add origin + SSH链接</code>关联一个远程库</p>
</li>
<li><p><code>git push –u</code>(第一次要用-u 以后不需要) <code>origin maste</code>r 把当前master分支推送到远程库</p>
</li>
<li><p><code>git clone + SSH链接</code> 从远程库中克隆</p>
</li>
<li><p><code>git checkout –b dev</code> 创建dev分支 并切换到dev分支上</p>
</li>
<li><p><code>git branch</code> 查看当前所有的分支</p>
</li>
<li><p><code>git checkout master</code> 切换回master分支</p>
</li>
<li><p><code>git merge dev</code> 在当前的分支上合并dev分支</p>
</li>
<li><p><code>git branch –d dev</code> 删除dev分支</p>
</li>
<li><p><code>git branch name</code> 创建分支</p>
</li>
<li><p><code>git fecth</code> 手动拉取远程仓库更新的信息</p>
</li>
<li><p><code>git stash</code> 把当前的工作隐藏起来 等以后恢复现场后继续工作</p>
</li>
<li><p><code>git stash list</code> 查看所有被隐藏的文件列表</p>
</li>
<li><p><code>git stash apply</code> 恢复被隐藏的文件，但是内容不删除</p>
</li>
<li><p><code>git stash drop</code> 删除文件</p>
</li>
<li><p><code>git stash pop</code> 恢复文件的同时 也删除文件</p>
</li>
<li><p><code>git remote</code> 查看远程库的信息</p>
</li>
<li><p><code>git remote –v</code> 查看远程库的详细信息</p>
</li>
<li><p><code>git push -u origin/master</code> Git将会强制提交到<code>master</code>分支上</p>
</li>
<li><p><code>git --amend</code> 简单地来说，可以理解成对最后一次提交做修正。&lt;前提是当前最后一次提交没有<code>merge</code>&gt;</p>
</li>
</ul>
<p><strong>参考文献</strong></p>
<ol>
<li>Git教程 - 廖雪峰的官方网站<br><a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/896043488029600">https://www.liaoxuefeng.com/wiki/896043488029600</a></li>
</ol>
<p>如果你觉得文章还不错，记得”<strong>点赞关注</strong>“</p>
<p>关注我的微信公众号【 <strong>加班猿</strong> 】可以获取更多内容<br><img src="https://img-blog.csdnimg.cn/202010151010560.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/10/05/Git%E7%9A%84%E7%AE%80%E6%98%8E%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/" data-id="ckhvya4zu000rbglrfvyu7qoj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/work/" rel="tag">work</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-TCP IP基础" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/03/TCP%20IP%E5%9F%BA%E7%A1%80/" class="article-date">
  <time datetime="2020-10-02T16:00:00.000Z" itemprop="datePublished">2020-10-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/">网络通信</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/03/TCP%20IP%E5%9F%BA%E7%A1%80/">小白看了也能懂的TCP/IP基础</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://img-blog.csdnimg.cn/20201014220601139.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<div align = 'right'>作者：hackett</div>

<div align = 'right'>微信公众号：加班猿</div>

<p>TCP/IP(Transmission Control Protocol/Internet Protocol)传输控制协议/网际协议）是指能够在多个不同网络间实现信息传输的协议簇。TCP/IP协议不仅仅指的是TCP 和IP两个协议，而是指一个由FTP、SMTP、TCP、UDP、IP等协议构成的协议簇， 只是因为在TCP/IP协议中TCP协议和IP协议最具代表性，所以被称TCP/IP协议。——《<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/TCP/IP%E5%8D%8F%E8%AE%AE">百度百科</a>》</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/5afd1f6344900dc1d1278fe69d218eb8.png" alt="img"></p>
<p>经典的OSI七层模型，TCP/IP被分为4层，每层的协议的工作方式不一样，所封装的上层数据的方式也不一样。</p>
<h2><center>一、IP地址</center></h2>

<p>1、Windows下“win+r”弹出打开程序或资源的窗口，输入“cmd”后回车，用命令<strong>ipconfig</strong>即可查看电脑的IP地址（我用的是WiFi，所以看的是无线局域WLAN）</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/2e95dc7b566f0c25fc5160a040d8367e.png" alt="img"></p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/a3f0ef82b6ccd369196e52273dee0082.png" alt="img"></p>
<p>2、Linux下在终端输入 <strong>ifconfig -a</strong> 命令查看自己的IP地址</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/679159adeb0193825be47c17809b055b.png" alt="img"></p>
<h2><center>二、域名</center></h2>
12位数字组成的IP地址难记，IP地址还有一个别名称作**域名**，IP地址和域名是一一对应的常见的域名后缀有com、net、org。一般来说.com是商业机构用的，.net网络服务供应商使用，.org是一些组织使用，现在没有什么限制。

<p>1、我们可以打开<a target="_blank" rel="noopener" href="https://wanwang.aliyun.com/">阿里云万网域名官网</a></p>
<p><img src="https://img-blog.csdnimg.cn/20201014214958569.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>2、我们查下hackett这个名字的域名后缀为wiki是否已经被注册，可以看到hackett.wiki这个域名已经被注册了，想要注册只能选其他域名后缀或其他名字注册。</p>
<p><img src="https://img-blog.csdnimg.cn/2020101421501478.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>3、这是我自己19年底注册的域名hackett.wiki域名。</p>
<p><img src="https://img-blog.csdnimg.cn/20201014215025751.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h2><center>三、MAC地址</center></h2>


<p>MAC地址用于在网络中唯一标示一个网卡，一台设备若有一或多个网卡，则每个网卡都需要并会有一个唯一的MAC地址，由网络设备制造商生产时写在硬件内部。MAC地址是<strong>6Byte</strong>（48位）通常表示为12个16进制数，每2个16进制数之间用冒号隔开，如18：56：80：FA：DC：E1就是一个MAC地址</p>
<p>Windows下用ipconfig -all查看</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/4faf9a0e750657e510273734c5fdbb73.png" alt="img"></p>
<p>Linux下在终端输入ifconfig命令查看</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/ffe2ca1167f46757a72027964413b1c1.png" alt="img"></p>
<h2><center>四、端口号</center></h2>


<p>IP地址是用来查找和发现网络中的地址的，端口号是用来进行程序相互通信的（打个比方：IP地址是一栋楼，端口就是进出这栋楼的入口），一个端口<strong>16Byte</strong>，即2^16=65536个，<strong>1~1023</strong>为公认的端口绑定了某些服务协议，不能随便分配，从<strong>1024—49151</strong>是被注册的端口，也成为“用户端口”，其他的为<strong>临时端口</strong>。</p>
<p>常用的有：</p>
<ul>
<li>FTP : 21</li>
<li>TELNET : 23</li>
<li>SMTP : 25</li>
<li>DNS : 53</li>
<li>TFTP : 69</li>
<li>HTTP : 80</li>
<li>SNMP : 161</li>
<li>SSH :22</li>
</ul>
<h2><center>五、IP数据报</center></h2>


<p>IP数据报的首部是<strong>5X4=20Byte</strong>，IP数据报=首部+数据部分</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/2715f2a9ec5836fd26b379f60e89bede.png" alt="img"></p>
<ol>
<li>版本号：4位，0100表示IPV4，0110标志IPV6</li>
<li>首部长度：4位，表示首部的长度，包括可选字段</li>
<li>服务类型：最小时延、最大吞吐量、最高可靠性、最小花费4种，每种占1位</li>
<li>总长度：报头长度+数据部分长度=总长度（16位）最多可以2^16=65536字节</li>
<li>标识：16位，当数据报由于长度超过网络的MTU而必须分片时，根据分片中的标识字段是否相同判断这些分片是否同一个数据报的分片，以此来进行分片的重组。通常每发送一份报文它的值就会加 1。</li>
<li>标志：3位，只有2位有意义。第二位MF(More Fragment)位1表示后面还有‘’分片”的数据报，为0表示已到最后一个数据报；第三位DF(Don’t Fragment)为1意思是“不能分片”。只有当DF=0时才允许分片。</li>
<li>偏移：13 位，在接收方进行数据报重组时用来标识分片的顺序。</li>
<li>生存时间：8 位，用于设置数据报可以经过的最多的路由器个数。TTL 的初始值由源主机设置（通常为 32 或 64），每经过一个处理它的路由器，TTL 值减 1。如果一个数据报的 TTL 值被减至 0，它将被丢弃。</li>
<li>协议：8 位，用来标识是哪个协议向 IP 传送数据。ICMP 为 1，IGMP 为 2，TCP 为 6，UDP 为 17，GRE 为 47，ESP 为 50。</li>
<li>首部校验和：根据 IP 首部计算的校验和码。</li>
<li>源 IP 和目的 IP ：数据报头还会包含该数据报的发送方 IP 和接收方 IP。</li>
<li>选项：是数据报中的一个可变长、可选的信息，不常用，多用于安全、军事等领域。</li>
</ol>
<h2><center>六、IP的地址的分类</center></h2>


<p>IP的地址分成4类ipv4地址占4个字节(32位)</p>
<p>A B C D E四类网络地址</p>
<p><img src="https://img-blog.csdnimg.cn/20190705095636130.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3NzMyODI5,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>例如：192.168.1.100</p>
<p>​       网络号：区分不同的网络(局域网)</p>
<p>​       主机号：区分同一个网络下不同的主机</p>
<p>A类地址：要求网络号占一个字节，主机号占3个字节，并且要求网络号(8位二进制)必须是0开头</p>
<p>​          0xxxxxxx.xxxxxxxx.xxxxxxxx.xxxxxxxx</p>
<p>​          网络号 0–127</p>
<p>​          主机号 1—254.254.254</p>
<p>B类地址：要求网络号占两个字节，主机号占2个字节，并且要求网络号(16位二进制)必须是10开头 </p>
<p>​          10xxxxxx.xxxxxxxx.xxxxxxxx.xxxxxxxx</p>
<p>​          网络号 128.0–191.255</p>
<p>C类地址：要求网络号占三个字节，主机号占1个字节，并且要求网络号(24位二进制)必须是110开头 </p>
<p>​          110xxxxx.xxxxxxxx.xxxxxxxx.xxxxxxxx</p>
<p>​          网络号 192.0.0–223.255.255</p>
<p>D类地址：组播专用地址，不区分网络号和主机号，必须是1110开头 </p>
<p>​          1110xxxx.xxxxxxxx.xxxxxxxx.xxxxxxxx</p>
<p>E类IP地址<br>          以“llll0”开始，为将来使用保留。240.0.0.0到255.255.255.254，255.255.255.255用于广播地址。</p>
<pre><code>     1111xxxx.xxxxxxxx.xxxxxxxx.xxxxxxxx</code></pre>
<p>下图IP地址就是个C类地址</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/2f0727056a801fda7b41c5e91468300b.png" alt="img"></p>
<h2><center>七、ping和traceroute程序</center></h2>


<p>ping程序和traceroute都是基于ICMP协议的工具。</p>
<p>用ping可以检测两台主机是否连，下图就是我用Ubuntu跟Windows各自ping的信息。ping 命令会返回一个 TTL 值，我们可以使用它来判断目标的操作系统类型。常见操作系统缺省 TTL 值如下:</p>
<ul>
<li>UNIX TTL: 255；</li>
<li>Linux TTL: 64；</li>
<li>WINDOWS 95/98 TTL: 32；</li>
<li>Windows NT 4.0/2000/XP/2003/7/8/10 TTL：128。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/img_convert/928c629178fece852b6e06e39a50a114.png" alt="img"></p>
<p>traceroute 程序是用来侦测主机到目的主机之间所经路由情况的重要工具。</p>
<p>1、Linux需要安装traceroute才能进行侦测。</p>
<p>2、Windows用tracert进行侦测，下图是先经过我笔记本WiFi连接的192.168.1.1的路由，再经过一系列的路由最终到达谷歌的8.8.8.8</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/b4e2bc1104c637aa244b37cc9b111bf4.png" alt="img"></p>
<h2><center>UDP</center></h2>


<p>UDP （User Datagram Protocol）协议与TCP协议一样用于处理数据包，在OSI模型中，两者都位于传输层，处于IP协议的上一层。</p>
<p>它的主要特点有：</p>
<ul>
<li><p>UDP 是<strong>无连接的</strong>，发送数据之前不需要建立连接(而 TCP 需要)，减少了开销和时延。</p>
</li>
<li><p>UDP尽最大努力交付，不保证交付可靠性，因此主机不需要维护复杂的连接状态；。</p>
</li>
<li><p>UDP 是<strong>面向报文的</strong>，对于从应用层交付下来的 IP 数据报</p>
</li>
<li><p>UDP的<strong>首部开销小</strong>，只有8个字节，它比TCP的20个字节的首部要短。</p>
</li>
<li><p>UDP 没有拥塞控制，出现网络拥塞时发送方也不会降低发送速率。这种特性对某些实时应用是很重要的，比如 IP 电话，视频会议等，它们允许拥塞时丢失一些数据，因为如果不抛弃这些数据，极可能造成时延的累积。</p>
</li>
<li><p>UDP 支持一对一、一对多、多对一和多对多的交互通信。</p>
<center>UDP报文


</li>
</ul>
<p>  UDP 数据报可分为两部分：UDP 报头和数据部分。其中数据部分是应用层交付下来的数据。UDP 报头总共 8 字节（2字节源端口、2字节目的端口、2字节长度、2字节校验和）<img src="https://img-blog.csdnimg.cn/img_convert/04ca6942f4e76f171914e09a0c6fe28f.png" alt="img"></p>
  <h2><center>九、TCP</center></h2>


<p>  TCP（Transmission Control Protocol）是一种面向连接的、可靠的、基于字节流的传输层通信协议。</p>
<p>  它的主要特点有：</p>
<ul>
<li><p><strong>面向字节流</strong>；</p>
</li>
<li><p><strong>面向连接</strong>；</p>
</li>
<li><p><strong>可靠通信方式</strong>，无差错、不丢失、不重复、按顺序。；</p>
</li>
<li><p>TCP 连接是 点对点 的，一条 TCP 连接只能连接两个端点。</p>
</li>
<li><p>UDP 支持一对一、一对多、多对一和多对多的交互通信。</p>
<center>TCP报文


</li>
</ul>
<p>  TCP 数据报可分为两部分：TCP 报头和数据部分。其中数据部分是应用层交付下来的数据。TCP 报文段的报头有前 20 字节的固定部分</p>
<p>  <img src="https://img-blog.csdnimg.cn/img_convert/f064d9790614de8bb71c8628b9400c2e.png" alt="img"></p>
<p>  各字段的功能：</p>
<ol>
<li>源端口：2字节</li>
<li>目的端口：2字节</li>
<li>序号：4字节，范围0~2^32-1，报头中的序号字段值则指的是本报文段数据的第一个字节的序号。</li>
<li>确认号：4字节，期望收到下个<strong>报文段</strong>的第一个数据字节的序号</li>
<li>数据偏移：4位,TCP报文段的报头长度，20字节+选项字段</li>
<li>保留：6位（URG、ACK确认、PSH推送、RST复位、SYN同步、FIN终止）</li>
<li>窗口：2字节，指自己的接收窗口大小</li>
<li>校验和：2字节，用于校验数据在传输中是否出错</li>
<li>紧急指针：2字节，当保留字段的URG=1有效</li>
<li>选项：长度可变，最长40字节</li>
</ol>
<p>如果你觉得文章还不错，记得”<strong>点赞关注</strong>“</p>
<p>关注我的微信公众号【 <strong>加班猿</strong> 】可以获取更多内容</p>
<p><img src="https://img-blog.csdnimg.cn/202010151010560.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3ODI0MzU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/10/03/TCP%20IP%E5%9F%BA%E7%A1%80/" data-id="ckhvya4zt000qbglrfs7vei2j" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TCP-IP/" rel="tag">TCP/IP</a></li></ul>

    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Qt/">Qt</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8D%95%E7%89%87%E6%9C%BA/">单片机</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/">网络通信</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP-IP/" rel="tag">TCP/IP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UI/" rel="tag">UI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/work/" rel="tag">work</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%BB%E7%BB%93/" rel="tag">总结</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%A9%B1%E5%8A%A8/" rel="tag">驱动</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/TCP-IP/" style="font-size: 10px;">TCP/IP</a> <a href="/tags/UI/" style="font-size: 20px;">UI</a> <a href="/tags/work/" style="font-size: 10px;">work</a> <a href="/tags/%E6%80%BB%E7%BB%93/" style="font-size: 15px;">总结</a> <a href="/tags/%E9%A9%B1%E5%8A%A8/" style="font-size: 10px;">驱动</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/11/10/Git%E8%80%81%E9%B8%9F%E6%9F%A5%E8%AF%A2%E6%89%8B%E5%86%8C/">Git老鸟查询手册</a>
          </li>
        
          <li>
            <a href="/2020/11/04/Qt%E4%B8%AD%E7%9A%84TCP%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BA%92%E5%8F%91%E6%B6%88%E6%81%AF/">Qt中的TCP服务端和客户端互发消息</a>
          </li>
        
          <li>
            <a href="/2020/11/01/Qt%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E8%AE%A1%E7%AE%97%E5%99%A8/">Qt实现一个简单的计算器</a>
          </li>
        
          <li>
            <a href="/2020/11/01/Qt%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9B%BE%E6%A0%87%E5%8A%9F%E8%83%BD/">Qt实现自定义图标功能</a>
          </li>
        
          <li>
            <a href="/2020/11/01/Qt%E6%97%A0%E8%BE%B9%E6%A1%86%E7%AA%97%E5%8F%A3%E6%8B%96%E6%8B%BD%E5%92%8C%E9%98%B4%E5%BD%B1/">Qt无边框窗口拖拽和阴影</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 hackett<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>